<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>ckb-next: src/ckb-daemon/led.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ckb-128.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ckb-next
   &#160;<span id="projectnumber">beta-v0.2.7 at branch all-mine</span>
   </div>
   <div id="projectbrief">ckb-next driver for corsair devices</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('led_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">led.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="includes_8h_source.html">includes.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="device_8h_source.html">device.h</a>&quot;</code><br/>
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for led.h:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h__incl.png" border="0" usemap="#src_2ckb-daemon_2led_8h" alt=""/></div>
<map name="src_2ckb-daemon_2led_8h" id="src_2ckb-daemon_2led_8h">
<area shape="rect" id="node2" href="includes_8h.html" title="includes.h" alt="" coords="833,155,914,181"/><area shape="rect" id="node27" href="device_8h.html" title="device.h" alt="" coords="1168,80,1238,107"/><area shape="rect" id="node3" href="os_8h.html" title="os.h" alt="" coords="382,453,428,480"/><area shape="rect" id="node24" href="structures_8h.html" title="structures.h" alt="" coords="1478,229,1568,256"/><area shape="rect" id="node25" href="daemon_2keymap_8h.html" title="keymap.h" alt="" coords="1484,304,1562,331"/><area shape="rect" id="node26" href="keymap__mac_8h.html" title="keymap_mac.h" alt="" coords="754,379,864,405"/></map>
</div>
</div><div class="textblock"><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> This graph shows which files directly or indirectly include this file:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h__dep__incl.png" border="0" usemap="#src_2ckb-daemon_2led_8hdep" alt=""/></div>
<map name="src_2ckb-daemon_2led_8hdep" id="src_2ckb-daemon_2led_8hdep">
<area shape="rect" id="node2" href="command_8c.html" title="src/ckb&#45;daemon/command.c" alt="" coords="5,88,192,115"/><area shape="rect" id="node3" href="device__vtable_8c.html" title="src/ckb&#45;daemon/device\l_vtable.c" alt="" coords="216,81,373,122"/><area shape="rect" id="node4" href="devnode_8c.html" title="src/ckb&#45;daemon/devnode.c" alt="" coords="397,88,576,115"/><area shape="rect" id="node5" href="led_8c.html" title="src/ckb&#45;daemon/led.c" alt="" coords="600,88,747,115"/><area shape="rect" id="node6" href="led__keyboard_8c.html" title="src/ckb&#45;daemon/led\l_keyboard.c" alt="" coords="771,81,905,122"/><area shape="rect" id="node7" href="led__mouse_8c.html" title="src/ckb&#45;daemon/led\l_mouse.c" alt="" coords="931,81,1065,122"/><area shape="rect" id="node8" href="ckb-daemon_2main_8c.html" title="src/ckb&#45;daemon/main.c" alt="" coords="1091,88,1249,115"/><area shape="rect" id="node9" href="notify_8c.html" title="src/ckb&#45;daemon/notify.c" alt="" coords="1275,88,1437,115"/><area shape="rect" id="node10" href="profile_8c.html" title="src/ckb&#45;daemon/profile.c" alt="" coords="1461,88,1625,115"/><area shape="rect" id="node11" href="profile__keyboard_8c.html" title="src/ckb&#45;daemon/profile\l_keyboard.c" alt="" coords="1651,81,1804,122"/><area shape="rect" id="node12" href="profile__mouse_8c.html" title="src/ckb&#45;daemon/profile\l_mouse.c" alt="" coords="1829,81,1983,122"/><area shape="rect" id="node13" href="usb_8c.html" title="src/ckb&#45;daemon/usb.c" alt="" coords="2009,88,2159,115"/></map>
</div>
</div>
<p><a href="led_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac93a454c8a0dcb5d68145876fcea4348"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#ac93a454c8a0dcb5d68145876fcea4348">updatergb_kb</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, int force)</td></tr>
<tr class="separator:ac93a454c8a0dcb5d68145876fcea4348"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ce4572649dc96fbff076a765f4a8ddd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#a8ce4572649dc96fbff076a765f4a8ddd">updatergb_mouse</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, int force)</td></tr>
<tr class="separator:a8ce4572649dc96fbff076a765f4a8ddd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8009a607c4c46e41dd64f8490b1582d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#aa8009a607c4c46e41dd64f8490b1582d">savergb_kb</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, <a class="el" href="structures_8h.html#structlighting">lighting</a> *light, int mode)</td></tr>
<tr class="separator:aa8009a607c4c46e41dd64f8490b1582d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accf371f84a8aecacae0143edc399885e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#accf371f84a8aecacae0143edc399885e">savergb_mouse</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, <a class="el" href="structures_8h.html#structlighting">lighting</a> *light, int mode)</td></tr>
<tr class="separator:accf371f84a8aecacae0143edc399885e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05cf9e0967ce8cbb2a51f0120b10365e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#a05cf9e0967ce8cbb2a51f0120b10365e">loadrgb_kb</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, <a class="el" href="structures_8h.html#structlighting">lighting</a> *light, int mode)</td></tr>
<tr class="separator:a05cf9e0967ce8cbb2a51f0120b10365e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa08791d06c846b7b66bc0697cda6cd53"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#aa08791d06c846b7b66bc0697cda6cd53">loadrgb_mouse</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, <a class="el" href="structures_8h.html#structlighting">lighting</a> *light, int mode)</td></tr>
<tr class="separator:aa08791d06c846b7b66bc0697cda6cd53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61bbab0cdb67df911571f98dfbf531e3"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#a61bbab0cdb67df911571f98dfbf531e3">printrgb</a> (const <a class="el" href="structures_8h.html#structlighting">lighting</a> *light, const <a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb)</td></tr>
<tr class="separator:a61bbab0cdb67df911571f98dfbf531e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afafa629d3eb83d9eaf4d1451f8c8a822"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#afafa629d3eb83d9eaf4d1451f8c8a822">cmd_rgb</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, <a class="el" href="structures_8h.html#structusbmode">usbmode</a> *mode, int dummy, int keyindex, const char *code)</td></tr>
<tr class="separator:afafa629d3eb83d9eaf4d1451f8c8a822"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a357e2fd6e5fdf90a128d586befd9148b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#a357e2fd6e5fdf90a128d586befd9148b">cmd_ioff</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, <a class="el" href="structures_8h.html#structusbmode">usbmode</a> *mode, int dummy1, int dummy2, const char *led)</td></tr>
<tr class="separator:a357e2fd6e5fdf90a128d586befd9148b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaae7e5a91b6be4d792848f2de17cdfea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#aaae7e5a91b6be4d792848f2de17cdfea">cmd_ion</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, <a class="el" href="structures_8h.html#structusbmode">usbmode</a> *mode, int dummy1, int dummy2, const char *led)</td></tr>
<tr class="separator:aaae7e5a91b6be4d792848f2de17cdfea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eadbd56d224b15470e93a3f75f2a1ab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#a7eadbd56d224b15470e93a3f75f2a1ab">cmd_iauto</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, <a class="el" href="structures_8h.html#structusbmode">usbmode</a> *mode, int dummy1, int dummy2, const char *led)</td></tr>
<tr class="separator:a7eadbd56d224b15470e93a3f75f2a1ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae981d4fb6374f5752bf50af6866de8d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led_8h.html#ae981d4fb6374f5752bf50af6866de8d7">cmd_inotify</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, <a class="el" href="structures_8h.html#structusbmode">usbmode</a> *mode, int nnumber, int dummy, const char *led)</td></tr>
<tr class="separator:ae981d4fb6374f5752bf50af6866de8d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a7eadbd56d224b15470e93a3f75f2a1ab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cmd_iauto </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbmode">usbmode</a> *&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dummy1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dummy2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>led</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="led_8c_source.html#l00054">54</a> of file <a class="el" href="led_8c_source.html">led.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00093">usbmode::ioff</a>, <a class="el" href="structures_8h_source.html#l00093">usbmode::ion</a>, <a class="el" href="led_8c_source.html#l00025">iselect()</a>, and <a class="el" href="structures_8h_source.html#l00180">usbdevice::vtable</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                                                                                     {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> bits = <a class="code" href="led_8c.html#a638c6503f2e7af80babe827bd79156aa">iselect</a>(led);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">// Remove the bits from both ioff and ion</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    mode-&gt;<a class="code" href="structures_8h.html#a9fb9fb7dcfef5bf001034a73ae349b2c">ioff</a> &amp;= ~bits;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    mode-&gt;<a class="code" href="structures_8h.html#a66827675394b4aa9cc927d5bb0037d2a">ion</a> &amp;= ~bits;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    kb-&gt;<a class="code" href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">vtable</a>-&gt;updateindicators(kb, 0);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_a66827675394b4aa9cc927d5bb0037d2a"><div class="ttname"><a href="structures_8h.html#a66827675394b4aa9cc927d5bb0037d2a">usbmode::ion</a></div><div class="ttdeci">uchar ion</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00093">structures.h:93</a></div></div>
<div class="ttc" id="structures_8h_html_a9fb9fb7dcfef5bf001034a73ae349b2c"><div class="ttname"><a href="structures_8h.html#a9fb9fb7dcfef5bf001034a73ae349b2c">usbmode::ioff</a></div><div class="ttdeci">uchar ioff</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00093">structures.h:93</a></div></div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="structures_8h_html_a3ad960bd68547aca1f870fac1138023b"><div class="ttname"><a href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">usbdevice::vtable</a></div><div class="ttdeci">const union devcmd * vtable</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00180">structures.h:180</a></div></div>
<div class="ttc" id="led_8c_html_a638c6503f2e7af80babe827bd79156aa"><div class="ttname"><a href="led_8c.html#a638c6503f2e7af80babe827bd79156aa">iselect</a></div><div class="ttdeci">static uchar iselect(const char *led)</div><div class="ttdef"><b>Definition:</b> <a href="led_8c_source.html#l00025">led.c:25</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_a7eadbd56d224b15470e93a3f75f2a1ab_cgraph.png" border="0" usemap="#led_8h_a7eadbd56d224b15470e93a3f75f2a1ab_cgraph" alt=""/></div>
<map name="led_8h_a7eadbd56d224b15470e93a3f75f2a1ab_cgraph" id="led_8h_a7eadbd56d224b15470e93a3f75f2a1ab_cgraph">
<area shape="rect" id="node2" href="led_8c.html#a638c6503f2e7af80babe827bd79156aa" title="iselect" alt="" coords="137,5,197,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae981d4fb6374f5752bf50af6866de8d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cmd_inotify </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbmode">usbmode</a> *&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nnumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dummy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>led</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="led_8c_source.html#l00062">62</a> of file <a class="el" href="led_8c_source.html">led.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00095">usbmode::inotify</a>, and <a class="el" href="led_8c_source.html#l00025">iselect()</a>.</p>
<div class="fragment"><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                                                                                       {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> bits = <a class="code" href="led_8c.html#a638c6503f2e7af80babe827bd79156aa">iselect</a>(led);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">if</span>(strstr(led, <span class="stringliteral">&quot;:off&quot;</span>))</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="comment">// Turn notifications for these bits off</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        mode-&gt;<a class="code" href="structures_8h.html#ad3c04481b7b8608af885d01fcc64a6a5">inotify</a>[nnumber] &amp;= ~bits;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="comment">// Turn notifications for these bits on</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        mode-&gt;<a class="code" href="structures_8h.html#ad3c04481b7b8608af885d01fcc64a6a5">inotify</a>[nnumber] |= bits;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="structures_8h_html_ad3c04481b7b8608af885d01fcc64a6a5"><div class="ttname"><a href="structures_8h.html#ad3c04481b7b8608af885d01fcc64a6a5">usbmode::inotify</a></div><div class="ttdeci">uchar inotify[10]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00095">structures.h:95</a></div></div>
<div class="ttc" id="led_8c_html_a638c6503f2e7af80babe827bd79156aa"><div class="ttname"><a href="led_8c.html#a638c6503f2e7af80babe827bd79156aa">iselect</a></div><div class="ttdeci">static uchar iselect(const char *led)</div><div class="ttdef"><b>Definition:</b> <a href="led_8c_source.html#l00025">led.c:25</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_ae981d4fb6374f5752bf50af6866de8d7_cgraph.png" border="0" usemap="#led_8h_ae981d4fb6374f5752bf50af6866de8d7_cgraph" alt=""/></div>
<map name="led_8h_ae981d4fb6374f5752bf50af6866de8d7_cgraph" id="led_8h_ae981d4fb6374f5752bf50af6866de8d7_cgraph">
<area shape="rect" id="node2" href="led_8c.html#a638c6503f2e7af80babe827bd79156aa" title="iselect" alt="" coords="145,5,205,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a357e2fd6e5fdf90a128d586befd9148b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cmd_ioff </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbmode">usbmode</a> *&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dummy1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dummy2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>led</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="led_8c_source.html#l00038">38</a> of file <a class="el" href="led_8c_source.html">led.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00093">usbmode::ioff</a>, <a class="el" href="structures_8h_source.html#l00093">usbmode::ion</a>, <a class="el" href="led_8c_source.html#l00025">iselect()</a>, and <a class="el" href="structures_8h_source.html#l00180">usbdevice::vtable</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                                                                                    {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> bits = <a class="code" href="led_8c.html#a638c6503f2e7af80babe827bd79156aa">iselect</a>(led);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// Add the bits to ioff, remove them from ion</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    mode-&gt;<a class="code" href="structures_8h.html#a9fb9fb7dcfef5bf001034a73ae349b2c">ioff</a> |= bits;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    mode-&gt;<a class="code" href="structures_8h.html#a66827675394b4aa9cc927d5bb0037d2a">ion</a> &amp;= ~bits;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    kb-&gt;<a class="code" href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">vtable</a>-&gt;updateindicators(kb, 0);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_a66827675394b4aa9cc927d5bb0037d2a"><div class="ttname"><a href="structures_8h.html#a66827675394b4aa9cc927d5bb0037d2a">usbmode::ion</a></div><div class="ttdeci">uchar ion</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00093">structures.h:93</a></div></div>
<div class="ttc" id="structures_8h_html_a9fb9fb7dcfef5bf001034a73ae349b2c"><div class="ttname"><a href="structures_8h.html#a9fb9fb7dcfef5bf001034a73ae349b2c">usbmode::ioff</a></div><div class="ttdeci">uchar ioff</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00093">structures.h:93</a></div></div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="structures_8h_html_a3ad960bd68547aca1f870fac1138023b"><div class="ttname"><a href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">usbdevice::vtable</a></div><div class="ttdeci">const union devcmd * vtable</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00180">structures.h:180</a></div></div>
<div class="ttc" id="led_8c_html_a638c6503f2e7af80babe827bd79156aa"><div class="ttname"><a href="led_8c.html#a638c6503f2e7af80babe827bd79156aa">iselect</a></div><div class="ttdeci">static uchar iselect(const char *led)</div><div class="ttdef"><b>Definition:</b> <a href="led_8c_source.html#l00025">led.c:25</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_a357e2fd6e5fdf90a128d586befd9148b_cgraph.png" border="0" usemap="#led_8h_a357e2fd6e5fdf90a128d586befd9148b_cgraph" alt=""/></div>
<map name="led_8h_a357e2fd6e5fdf90a128d586befd9148b_cgraph" id="led_8h_a357e2fd6e5fdf90a128d586befd9148b_cgraph">
<area shape="rect" id="node2" href="led_8c.html#a638c6503f2e7af80babe827bd79156aa" title="iselect" alt="" coords="126,5,186,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aaae7e5a91b6be4d792848f2de17cdfea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cmd_ion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbmode">usbmode</a> *&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dummy1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dummy2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>led</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="led_8c_source.html#l00046">46</a> of file <a class="el" href="led_8c_source.html">led.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00093">usbmode::ioff</a>, <a class="el" href="structures_8h_source.html#l00093">usbmode::ion</a>, <a class="el" href="led_8c_source.html#l00025">iselect()</a>, and <a class="el" href="structures_8h_source.html#l00180">usbdevice::vtable</a>.</p>
<div class="fragment"><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                                                                                   {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> bits = <a class="code" href="led_8c.html#a638c6503f2e7af80babe827bd79156aa">iselect</a>(led);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// Remove the bits from ioff, add them to ion</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    mode-&gt;<a class="code" href="structures_8h.html#a9fb9fb7dcfef5bf001034a73ae349b2c">ioff</a> &amp;= ~bits;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    mode-&gt;<a class="code" href="structures_8h.html#a66827675394b4aa9cc927d5bb0037d2a">ion</a> |= bits;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    kb-&gt;<a class="code" href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">vtable</a>-&gt;updateindicators(kb, 0);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_a66827675394b4aa9cc927d5bb0037d2a"><div class="ttname"><a href="structures_8h.html#a66827675394b4aa9cc927d5bb0037d2a">usbmode::ion</a></div><div class="ttdeci">uchar ion</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00093">structures.h:93</a></div></div>
<div class="ttc" id="structures_8h_html_a9fb9fb7dcfef5bf001034a73ae349b2c"><div class="ttname"><a href="structures_8h.html#a9fb9fb7dcfef5bf001034a73ae349b2c">usbmode::ioff</a></div><div class="ttdeci">uchar ioff</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00093">structures.h:93</a></div></div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="structures_8h_html_a3ad960bd68547aca1f870fac1138023b"><div class="ttname"><a href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">usbdevice::vtable</a></div><div class="ttdeci">const union devcmd * vtable</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00180">structures.h:180</a></div></div>
<div class="ttc" id="led_8c_html_a638c6503f2e7af80babe827bd79156aa"><div class="ttname"><a href="led_8c.html#a638c6503f2e7af80babe827bd79156aa">iselect</a></div><div class="ttdeci">static uchar iselect(const char *led)</div><div class="ttdef"><b>Definition:</b> <a href="led_8c_source.html#l00025">led.c:25</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_aaae7e5a91b6be4d792848f2de17cdfea_cgraph.png" border="0" usemap="#led_8h_aaae7e5a91b6be4d792848f2de17cdfea_cgraph" alt=""/></div>
<map name="led_8h_aaae7e5a91b6be4d792848f2de17cdfea_cgraph" id="led_8h_aaae7e5a91b6be4d792848f2de17cdfea_cgraph">
<area shape="rect" id="node2" href="led_8c.html#a638c6503f2e7af80babe827bd79156aa" title="iselect" alt="" coords="126,5,186,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afafa629d3eb83d9eaf4d1451f8c8a822"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cmd_rgb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbmode">usbmode</a> *&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dummy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>keyindex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>code</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="led_8c_source.html#l00006">6</a> of file <a class="el" href="led_8c_source.html">led.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00076">lighting::b</a>, <a class="el" href="structures_8h_source.html#l00075">lighting::g</a>, <a class="el" href="keymap_8c_source.html#l00005">keymap</a>, <a class="el" href="daemon_2keymap_8h_source.html#l00051">key::led</a>, <a class="el" href="structures_8h_source.html#l00084">usbmode::light</a>, <a class="el" href="structures_8h_source.html#l00074">lighting::r</a>, and <a class="el" href="structures_8h_source.html#l00078">lighting::sidelight</a>.</p>
<div class="fragment"><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;                                                                                     {</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="keywordtype">int</span> index = <a class="code" href="keymap_8c.html#a5972a715b26e6b792acc53ad946e1fbb">keymap</a>[keyindex].<a class="code" href="daemon_2keymap_8h.html#adfb7efb615d23c01a629dbf1f0aa83c4">led</a>;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    <span class="keywordflow">if</span>(index &lt; 0) {</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        <span class="keywordflow">if</span> (index == -2){     <span class="comment">// Process strafe sidelights</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;            <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> sideshine;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;            <span class="keywordflow">if</span> (sscanf(code, <span class="stringliteral">&quot;%2hhx&quot;</span>,&amp;sideshine)) <span class="comment">// monochromatic</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                mode-&gt;<a class="code" href="structures_8h.html#a4adb0b5a770a32ee4db36dca49398ce9">light</a>.<a class="code" href="structures_8h.html#a761a7cf0b0943ecba869358267c54028">sidelight</a> = sideshine;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        }</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    }</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> r, g, b;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <span class="keywordflow">if</span>(sscanf(code, <span class="stringliteral">&quot;%2hhx%2hhx%2hhx&quot;</span>, &amp;r, &amp;g, &amp;b) == 3){</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        mode-&gt;<a class="code" href="structures_8h.html#a4adb0b5a770a32ee4db36dca49398ce9">light</a>.<a class="code" href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">r</a>[index] = r;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        mode-&gt;<a class="code" href="structures_8h.html#a4adb0b5a770a32ee4db36dca49398ce9">light</a>.<a class="code" href="structures_8h.html#aef072a169d12aabf02985bd659103244">g</a>[index] = g;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        mode-&gt;<a class="code" href="structures_8h.html#a4adb0b5a770a32ee4db36dca49398ce9">light</a>.<a class="code" href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">b</a>[index] = b;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    }</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_a761a7cf0b0943ecba869358267c54028"><div class="ttname"><a href="structures_8h.html#a761a7cf0b0943ecba869358267c54028">lighting::sidelight</a></div><div class="ttdeci">uchar sidelight</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00078">structures.h:78</a></div></div>
<div class="ttc" id="structures_8h_html_abeb581d1f9790ac0dc97bd177546586e"><div class="ttname"><a href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">lighting::b</a></div><div class="ttdeci">uchar b[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00076">structures.h:76</a></div></div>
<div class="ttc" id="daemon_2keymap_8h_html_adfb7efb615d23c01a629dbf1f0aa83c4"><div class="ttname"><a href="daemon_2keymap_8h.html#adfb7efb615d23c01a629dbf1f0aa83c4">key::led</a></div><div class="ttdeci">short led</div><div class="ttdef"><b>Definition:</b> <a href="daemon_2keymap_8h_source.html#l00051">keymap.h:51</a></div></div>
<div class="ttc" id="structures_8h_html_a4adb0b5a770a32ee4db36dca49398ce9"><div class="ttname"><a href="structures_8h.html#a4adb0b5a770a32ee4db36dca49398ce9">usbmode::light</a></div><div class="ttdeci">lighting light</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00084">structures.h:84</a></div></div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="structures_8h_html_aef072a169d12aabf02985bd659103244"><div class="ttname"><a href="structures_8h.html#aef072a169d12aabf02985bd659103244">lighting::g</a></div><div class="ttdeci">uchar g[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00075">structures.h:75</a></div></div>
<div class="ttc" id="structures_8h_html_a58f2fbe1709465a5258292e8c8421f58"><div class="ttname"><a href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">lighting::r</a></div><div class="ttdeci">uchar r[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00074">structures.h:74</a></div></div>
<div class="ttc" id="keymap_8c_html_a5972a715b26e6b792acc53ad946e1fbb"><div class="ttname"><a href="keymap_8c.html#a5972a715b26e6b792acc53ad946e1fbb">keymap</a></div><div class="ttdeci">const key keymap[(((152+3+12)+25)+11)]</div><div class="ttdef"><b>Definition:</b> <a href="keymap_8c_source.html#l00005">keymap.c:5</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a05cf9e0967ce8cbb2a51f0120b10365e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int loadrgb_kb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structlighting">lighting</a> *&#160;</td>
          <td class="paramname"><em>light</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Since Firmware Version 2.05 for K95RGB the answers for getting the stored color-maps from the hardware has changed a bit. So comparing for the correct answer cannot validate against the cmd, and has to be done against a third map. Up to now we know, that K70RGB Pro has firmware version 2.04 and havin the problem also. So we have to determine in the most inner loop the firmware version and type of KB to select the correct compare-table.</p>
<p>Read colors </p>
<pre class="fragment">                                              &gt; That is the old comparison method: you get back what you sent.
</pre><p> Normally a firmware version &gt;= 2.05 runs with the new compare array. Up to now there is a 2.04 running in K70 RGB Lux with the same behavior. </p>

<p>Definition at line <a class="el" href="led__keyboard_8c_source.html#l00181">181</a> of file <a class="el" href="led__keyboard_8c_source.html">led_keyboard.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00076">lighting::b</a>, <a class="el" href="includes_8h_source.html#l00050">ckb_err</a>, <a class="el" href="structures_8h_source.html#l00239">usbdevice::fwversion</a>, <a class="el" href="structures_8h_source.html#l00075">lighting::g</a>, <a class="el" href="structures_8h_source.html#l00176">MSG_SIZE</a>, <a class="el" href="daemon_2keymap_8h_source.html#l00024">N_KEYS_HW</a>, <a class="el" href="firmware__special_8h_source.html#l00018">P_K70_LUX_NRGB</a>, <a class="el" href="structures_8h_source.html#l00237">usbdevice::product</a>, <a class="el" href="structures_8h_source.html#l00074">lighting::r</a>, <a class="el" href="usb_8h_source.html#l00254">usbrecv</a>, and <a class="el" href="usb_8h_source.html#l00237">usbsend</a>.</p>

<p>Referenced by <a class="el" href="profile__keyboard_8c_source.html#l00005">hwloadmode()</a>.</p>
<div class="fragment"><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                                        {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">if</span>(kb-&gt;<a class="code" href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">fwversion</a> &gt;= 0x0120){</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> data_pkt[12][<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            { 0x0e, 0x14, 0x03, 0x01, 0x01, mode + 1, 0x01 },</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            { 0xff, 0x01, 60, 0 },</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            { 0xff, 0x02, 60, 0 },</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            { 0xff, 0x03, 24, 0 },</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            { 0x0e, 0x14, 0x03, 0x01, 0x01, mode + 1, 0x02 },</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            { 0xff, 0x01, 60, 0 },</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            { 0xff, 0x02, 60, 0 },</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            { 0xff, 0x03, 24, 0 },</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            { 0x0e, 0x14, 0x03, 0x01, 0x01, mode + 1, 0x03 },</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            { 0xff, 0x01, 60, 0 },</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            { 0xff, 0x02, 60, 0 },</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            { 0xff, 0x03, 24, 0 },</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        };</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> in_pkt[4][<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            { 0x0e, 0x14, 0x03, 0x01 },</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            { 0xff, 0x01, 60, 0 },</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            { 0xff, 0x02, 60, 0 },</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            { 0xff, 0x03, 24, 0 },</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        };</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> cmp_pkt[4][4] = {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            { 0x0e, 0x14, 0x03, 0x01 },</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            { 0x0e, 0xff, 0x01, 60 },</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            { 0x0e, 0xff, 0x02, 60 },</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            { 0x0e, 0xff, 0x03, 24 },</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        };</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>* colors[3] = { light-&gt;<a class="code" href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">r</a>, light-&gt;<a class="code" href="structures_8h.html#aef072a169d12aabf02985bd659103244">g</a>, light-&gt;<a class="code" href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">b</a> };</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> clr = 0; clr &lt; 3; clr++){</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 4; i++){</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a80241296ff114704b355cd6081d2ff2e">usbrecv</a>(kb, data_pkt[i + clr * 4], in_pkt[i]))</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>* comparePacket = data_pkt[i + clr * 4];   </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="keywordflow">if</span> ((kb-&gt;<a class="code" href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">fwversion</a> &gt;= 0x205) || ((kb-&gt;<a class="code" href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">fwversion</a> &gt;= 0x204) &amp;&amp; (kb-&gt;<a class="code" href="structures_8h.html#a045b6c91e3f04e54f25d39da9bda105b">product</a> == <a class="code" href="firmware__special_8h.html#aa0f89f20ca96ad159330a8d071a45352">P_K70_LUX_NRGB</a>))) {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                    comparePacket = cmp_pkt[i];</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                <span class="keywordflow">if</span> (memcmp(in_pkt[i], comparePacket, 4)) {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                    <a class="code" href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a>(<span class="stringliteral">&quot;Bad input header\n&quot;</span>);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                    <a class="code" href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a>(<span class="stringliteral">&quot;color = %d, i = %d, mode = %d\nOutput (Request): %2.2x %2.2x %2.2x %2.2x\nInput(Reply): %2.2x %2.2x %2.2x %2.2x %2.2x %2.2x %2.2x %2.2x\n&quot;</span>, clr, i, mode,</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                        comparePacket[0], comparePacket[1], comparePacket[2], comparePacket[3],</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                        in_pkt[i][0], in_pkt[i][1], in_pkt[i][2], in_pkt[i][3], in_pkt[i][4], in_pkt[i][5], in_pkt[i][6], in_pkt[i][7]);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                    in_pkt[2][0] = 0x99;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    in_pkt[2][1] = 0x99;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                    in_pkt[2][2] = 0x99;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    in_pkt[2][3] = 0x99;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    <a class="code" href="usb_8h.html#a80241296ff114704b355cd6081d2ff2e">usbrecv</a>(kb, in_pkt[2], in_pkt[2]); <span class="comment">// just to find it in the wireshark log</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="comment">// Copy colors to lighting. in_pkt[0] is irrelevant.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            memcpy(colors[clr], in_pkt[1] + 4, 60);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            memcpy(colors[clr] + 60, in_pkt[2] + 4, 60);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            memcpy(colors[clr] + 120, in_pkt[3] + 4, 24);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> data_pkt[5][<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            { 0x0e, 0x14, 0x02, 0x01, 0x01, mode + 1, 0 },</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            { 0xff, 0x01, 60, 0 },</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            { 0xff, 0x02, 60, 0 },</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            { 0xff, 0x03, 60, 0 },</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            { 0xff, 0x04, 36, 0 },</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        };</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> in_pkt[4][<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            { 0xff, 0x01, 60, 0 },</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            { 0xff, 0x02, 60, 0 },</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            { 0xff, 0x03, 60, 0 },</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            { 0xff, 0x04, 36, 0 },</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        };</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="comment">// Write initial packet</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, data_pkt[0], 1))</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="comment">// Read colors</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; 5; i++){</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a80241296ff114704b355cd6081d2ff2e">usbrecv</a>(kb, data_pkt[i],in_pkt[i - 1]))</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <span class="keywordflow">if</span>(memcmp(in_pkt[i - 1], data_pkt[i], 4)){</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                <a class="code" href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a>(<span class="stringliteral">&quot;Bad input header\n&quot;</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="comment">// Copy the data back to the mode</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        uint8_t mr[<a class="code" href="daemon_2keymap_8h.html#a8da11aae2aeac140b30ec9bc334bead3">N_KEYS_HW</a> / 2], mg[<a class="code" href="daemon_2keymap_8h.html#a8da11aae2aeac140b30ec9bc334bead3">N_KEYS_HW</a> / 2], mb[<a class="code" href="daemon_2keymap_8h.html#a8da11aae2aeac140b30ec9bc334bead3">N_KEYS_HW</a> / 2];</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        memcpy(mr,      in_pkt[0] +  4, 60);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        memcpy(mr + 60, in_pkt[1] +  4, 12);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        memcpy(mg,      in_pkt[1] + 16, 48);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        memcpy(mg + 48, in_pkt[2] +  4, 24);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        memcpy(mb,      in_pkt[2] + 28, 36);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        memcpy(mb + 36, in_pkt[3] +  4, 36);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="comment">// Unpack LED data to 8bpc format</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="daemon_2keymap_8h.html#a8da11aae2aeac140b30ec9bc334bead3">N_KEYS_HW</a>; i++){</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="keywordtype">int</span>     i_2 = i / 2;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            uint8_t r, g, b;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="comment">// 3-bit intensities stored in alternate nybbles.</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="keywordflow">if</span> (i &amp; 1) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                r = 7 - (mr[i_2] &gt;&gt; 4);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                g = 7 - (mg[i_2] &gt;&gt; 4);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                b = 7 - (mb[i_2] &gt;&gt; 4);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                r = 7 - (mr[i_2] &amp; 0x0F);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                g = 7 - (mg[i_2] &amp; 0x0F);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                b = 7 - (mb[i_2] &amp; 0x0F);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="comment">// Scale 3-bit values up to 8 bits.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            light-&gt;<a class="code" href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">r</a>[i] = r &lt;&lt; 5 | r &lt;&lt; 2 | r &gt;&gt; 1;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            light-&gt;<a class="code" href="structures_8h.html#aef072a169d12aabf02985bd659103244">g</a>[i] = g &lt;&lt; 5 | g &lt;&lt; 2 | g &gt;&gt; 1;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            light-&gt;<a class="code" href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">b</a>[i] = b &lt;&lt; 5 | b &lt;&lt; 2 | b &gt;&gt; 1;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_ad4d025ecf1bdbf8b244ca688df8e478d"><div class="ttname"><a href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a></div><div class="ttdeci">#define MSG_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00176">structures.h:176</a></div></div>
<div class="ttc" id="structures_8h_html_abeb581d1f9790ac0dc97bd177546586e"><div class="ttname"><a href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">lighting::b</a></div><div class="ttdeci">uchar b[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00076">structures.h:76</a></div></div>
<div class="ttc" id="includes_8h_html_a8312a1a42e03986afb7c76557f4d3e25"><div class="ttname"><a href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a></div><div class="ttdeci">#define ckb_err(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00050">includes.h:50</a></div></div>
<div class="ttc" id="structures_8h_html_a47e0bd130899bcf5acdef059f2970ac7"><div class="ttname"><a href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">usbdevice::fwversion</a></div><div class="ttdeci">ushort fwversion</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00239">structures.h:239</a></div></div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="daemon_2keymap_8h_html_a8da11aae2aeac140b30ec9bc334bead3"><div class="ttname"><a href="daemon_2keymap_8h.html#a8da11aae2aeac140b30ec9bc334bead3">N_KEYS_HW</a></div><div class="ttdeci">#define N_KEYS_HW</div><div class="ttdef"><b>Definition:</b> <a href="daemon_2keymap_8h_source.html#l00024">keymap.h:24</a></div></div>
<div class="ttc" id="structures_8h_html_a045b6c91e3f04e54f25d39da9bda105b"><div class="ttname"><a href="structures_8h.html#a045b6c91e3f04e54f25d39da9bda105b">usbdevice::product</a></div><div class="ttdeci">short product</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00237">structures.h:237</a></div></div>
<div class="ttc" id="structures_8h_html_aef072a169d12aabf02985bd659103244"><div class="ttname"><a href="structures_8h.html#aef072a169d12aabf02985bd659103244">lighting::g</a></div><div class="ttdeci">uchar g[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00075">structures.h:75</a></div></div>
<div class="ttc" id="usb_8h_html_a80241296ff114704b355cd6081d2ff2e"><div class="ttname"><a href="usb_8h.html#a80241296ff114704b355cd6081d2ff2e">usbrecv</a></div><div class="ttdeci">#define usbrecv(kb, out_msg, in_msg)</div><div class="ttdoc">usbrecv macro is used to wrap _usbrecv() with debugging information (file and lineno) ...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00254">usb.h:254</a></div></div>
<div class="ttc" id="structures_8h_html_a58f2fbe1709465a5258292e8c8421f58"><div class="ttname"><a href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">lighting::r</a></div><div class="ttdeci">uchar r[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00074">structures.h:74</a></div></div>
<div class="ttc" id="firmware__special_8h_html_aa0f89f20ca96ad159330a8d071a45352"><div class="ttname"><a href="firmware__special_8h.html#aa0f89f20ca96ad159330a8d071a45352">P_K70_LUX_NRGB</a></div><div class="ttdeci">#define P_K70_LUX_NRGB</div><div class="ttdoc">Enter the Product ID of your device you want to handle with special treatment. </div><div class="ttdef"><b>Definition:</b> <a href="firmware__special_8h_source.html#l00018">firmware_special.h:18</a></div></div>
<div class="ttc" id="usb_8h_html_a5eaa2b8ffe9e62747454c74b19876819"><div class="ttname"><a href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a></div><div class="ttdeci">#define usbsend(kb, messages, count)</div><div class="ttdoc">usbsend macro is used to wrap _usbsend() with debugging information (file and lineno) ...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00237">usb.h:237</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_a05cf9e0967ce8cbb2a51f0120b10365e_icgraph.png" border="0" usemap="#led_8h_a05cf9e0967ce8cbb2a51f0120b10365e_icgraph" alt=""/></div>
<map name="led_8h_a05cf9e0967ce8cbb2a51f0120b10365e_icgraph" id="led_8h_a05cf9e0967ce8cbb2a51f0120b10365e_icgraph">
<area shape="rect" id="node2" href="profile__keyboard_8c.html#ab7d53e61dda826ebc069bad9a3dfebeb" title="hwloadmode" alt="" coords="139,5,234,32"/><area shape="rect" id="node3" href="profile__keyboard_8c.html#af29251c9a86a00c27c777924fcb894e2" title="cmd_hwload_kb" alt="" coords="283,5,399,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa08791d06c846b7b66bc0697cda6cd53"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int loadrgb_mouse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structlighting">lighting</a> *&#160;</td>
          <td class="paramname"><em>light</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="led__mouse_8c_source.html#l00081">81</a> of file <a class="el" href="led__mouse_8c_source.html">led_mouse.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00076">lighting::b</a>, <a class="el" href="includes_8h_source.html#l00050">ckb_err</a>, <a class="el" href="structures_8h_source.html#l00075">lighting::g</a>, <a class="el" href="usb_8h_source.html#l00093">IS_SABRE</a>, <a class="el" href="usb_8h_source.html#l00099">IS_SCIMITAR</a>, <a class="el" href="daemon_2keymap_8h_source.html#l00043">LED_DPI</a>, <a class="el" href="daemon_2keymap_8h_source.html#l00039">LED_MOUSE</a>, <a class="el" href="structures_8h_source.html#l00176">MSG_SIZE</a>, <a class="el" href="structures_8h_source.html#l00074">lighting::r</a>, and <a class="el" href="usb_8h_source.html#l00254">usbrecv</a>.</p>

<p>Referenced by <a class="el" href="profile__mouse_8c_source.html#l00006">cmd_hwload_mouse()</a>.</p>
<div class="fragment"><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                                           {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> data_pkt[<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = { 0x0e, 0x13, 0x10, 1, 0 };</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> in_pkt[<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = { 0 };</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// Load each RGB zone</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">int</span> zonecount = <a class="code" href="usb_8h.html#a42d0504a482944df6fe7cbdb06c0851b">IS_SCIMITAR</a>(kb) ? 4 : <a class="code" href="usb_8h.html#a42deb465caa31f803a16306986cd6bbe">IS_SABRE</a>(kb) ? 3 : 2;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; zonecount; i++){</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a80241296ff114704b355cd6081d2ff2e">usbrecv</a>(kb, data_pkt, in_pkt))</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">if</span>(memcmp(in_pkt, data_pkt, 4)){</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <a class="code" href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a>(<span class="stringliteral">&quot;Bad input header\n&quot;</span>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">return</span> -2;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="comment">// Copy data</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordtype">int</span> led = <a class="code" href="daemon_2keymap_8h.html#ac4f7d9dce5248992866a0f2e23fe8200">LED_MOUSE</a> + i;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span>(led &gt;= <a class="code" href="daemon_2keymap_8h.html#a651d575ebe5d00bbe17ae5fd9dbf41f8">LED_DPI</a>)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            led++;          <span class="comment">// Skip DPI light</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        light-&gt;<a class="code" href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">r</a>[led] = in_pkt[4];</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        light-&gt;<a class="code" href="structures_8h.html#aef072a169d12aabf02985bd659103244">g</a>[led] = in_pkt[5];</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        light-&gt;<a class="code" href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">b</a>[led] = in_pkt[6];</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment">// Set packet for next zone</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        data_pkt[2]++;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_ad4d025ecf1bdbf8b244ca688df8e478d"><div class="ttname"><a href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a></div><div class="ttdeci">#define MSG_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00176">structures.h:176</a></div></div>
<div class="ttc" id="structures_8h_html_abeb581d1f9790ac0dc97bd177546586e"><div class="ttname"><a href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">lighting::b</a></div><div class="ttdeci">uchar b[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00076">structures.h:76</a></div></div>
<div class="ttc" id="daemon_2keymap_8h_html_ac4f7d9dce5248992866a0f2e23fe8200"><div class="ttname"><a href="daemon_2keymap_8h.html#ac4f7d9dce5248992866a0f2e23fe8200">LED_MOUSE</a></div><div class="ttdeci">#define LED_MOUSE</div><div class="ttdef"><b>Definition:</b> <a href="daemon_2keymap_8h_source.html#l00039">keymap.h:39</a></div></div>
<div class="ttc" id="usb_8h_html_a42d0504a482944df6fe7cbdb06c0851b"><div class="ttname"><a href="usb_8h.html#a42d0504a482944df6fe7cbdb06c0851b">IS_SCIMITAR</a></div><div class="ttdeci">#define IS_SCIMITAR(kb)</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00099">usb.h:99</a></div></div>
<div class="ttc" id="includes_8h_html_a8312a1a42e03986afb7c76557f4d3e25"><div class="ttname"><a href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a></div><div class="ttdeci">#define ckb_err(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00050">includes.h:50</a></div></div>
<div class="ttc" id="usb_8h_html_a42deb465caa31f803a16306986cd6bbe"><div class="ttname"><a href="usb_8h.html#a42deb465caa31f803a16306986cd6bbe">IS_SABRE</a></div><div class="ttdeci">#define IS_SABRE(kb)</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00093">usb.h:93</a></div></div>
<div class="ttc" id="daemon_2keymap_8h_html_a651d575ebe5d00bbe17ae5fd9dbf41f8"><div class="ttname"><a href="daemon_2keymap_8h.html#a651d575ebe5d00bbe17ae5fd9dbf41f8">LED_DPI</a></div><div class="ttdeci">#define LED_DPI</div><div class="ttdef"><b>Definition:</b> <a href="daemon_2keymap_8h_source.html#l00043">keymap.h:43</a></div></div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="structures_8h_html_aef072a169d12aabf02985bd659103244"><div class="ttname"><a href="structures_8h.html#aef072a169d12aabf02985bd659103244">lighting::g</a></div><div class="ttdeci">uchar g[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00075">structures.h:75</a></div></div>
<div class="ttc" id="usb_8h_html_a80241296ff114704b355cd6081d2ff2e"><div class="ttname"><a href="usb_8h.html#a80241296ff114704b355cd6081d2ff2e">usbrecv</a></div><div class="ttdeci">#define usbrecv(kb, out_msg, in_msg)</div><div class="ttdoc">usbrecv macro is used to wrap _usbrecv() with debugging information (file and lineno) ...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00254">usb.h:254</a></div></div>
<div class="ttc" id="structures_8h_html_a58f2fbe1709465a5258292e8c8421f58"><div class="ttname"><a href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">lighting::r</a></div><div class="ttdeci">uchar r[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00074">structures.h:74</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_aa08791d06c846b7b66bc0697cda6cd53_icgraph.png" border="0" usemap="#led_8h_aa08791d06c846b7b66bc0697cda6cd53_icgraph" alt=""/></div>
<map name="led_8h_aa08791d06c846b7b66bc0697cda6cd53_icgraph" id="led_8h_aa08791d06c846b7b66bc0697cda6cd53_icgraph">
<area shape="rect" id="node2" href="profile__mouse_8c.html#aa6ac4a39b39a8094bfc6d2c4ced5fbe8" title="cmd_hwload_mouse" alt="" coords="165,5,307,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a61bbab0cdb67df911571f98dfbf531e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* printrgb </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structures_8h.html#structlighting">lighting</a> *&#160;</td>
          <td class="paramname"><em>light</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="led_8c_source.html#l00102">102</a> of file <a class="el" href="led_8c_source.html">led.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00076">lighting::b</a>, <a class="el" href="structures_8h_source.html#l00075">lighting::g</a>, <a class="el" href="led_8c_source.html#l00073">has_key()</a>, <a class="el" href="keymap_8c_source.html#l00005">keymap</a>, <a class="el" href="daemon_2keymap_8h_source.html#l00051">key::led</a>, <a class="el" href="daemon_2keymap_8h_source.html#l00045">N_KEYS_EXTENDED</a>, <a class="el" href="daemon_2keymap_8h_source.html#l00050">key::name</a>, and <a class="el" href="structures_8h_source.html#l00074">lighting::r</a>.</p>

<p>Referenced by <a class="el" href="notify_8c_source.html#l00090">_cmd_get()</a>.</p>
<div class="fragment"><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                                                          {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> r[<a class="code" href="daemon_2keymap_8h.html#ae1b7aad208a3aca184f7ea6f4bb8643c">N_KEYS_EXTENDED</a>], g[<a class="code" href="daemon_2keymap_8h.html#ae1b7aad208a3aca184f7ea6f4bb8643c">N_KEYS_EXTENDED</a>], b[<a class="code" href="daemon_2keymap_8h.html#ae1b7aad208a3aca184f7ea6f4bb8643c">N_KEYS_EXTENDED</a>];</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keyword">const</span> <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>* mr = light-&gt;<a class="code" href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">r</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keyword">const</span> <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>* mg = light-&gt;<a class="code" href="structures_8h.html#aef072a169d12aabf02985bd659103244">g</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keyword">const</span> <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>* mb = light-&gt;<a class="code" href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">b</a>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="daemon_2keymap_8h.html#ae1b7aad208a3aca184f7ea6f4bb8643c">N_KEYS_EXTENDED</a>; i++){</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="comment">// Translate the key index to an RGB index using the key map</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordtype">int</span> k = <a class="code" href="keymap_8c.html#a5972a715b26e6b792acc53ad946e1fbb">keymap</a>[i].<a class="code" href="daemon_2keymap_8h.html#adfb7efb615d23c01a629dbf1f0aa83c4">led</a>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">if</span>(k &lt; 0)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        r[i] = mr[k];</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        g[i] = mg[k];</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        b[i] = mb[k];</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// Make a buffer to track key names and to filter out duplicates</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordtype">char</span> names[<a class="code" href="daemon_2keymap_8h.html#ae1b7aad208a3aca184f7ea6f4bb8643c">N_KEYS_EXTENDED</a>][11];</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="daemon_2keymap_8h.html#ae1b7aad208a3aca184f7ea6f4bb8643c">N_KEYS_EXTENDED</a>; i++){</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* name = <a class="code" href="keymap_8c.html#a5972a715b26e6b792acc53ad946e1fbb">keymap</a>[i].<a class="code" href="daemon_2keymap_8h.html#aaa2ca200a4bd86567f53851153b045af">name</a>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="keymap_8c.html#a5972a715b26e6b792acc53ad946e1fbb">keymap</a>[i].led &lt; 0 || !<a class="code" href="led_8c.html#a97b59f7ad581a5fdd8e2becec0b7725b">has_key</a>(name, kb))</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            names[i][0] = 0;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            strncpy(names[i], name, 11);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// Check to make sure these aren&#39;t all the same color</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">int</span> same = 1;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; <a class="code" href="daemon_2keymap_8h.html#ae1b7aad208a3aca184f7ea6f4bb8643c">N_KEYS_EXTENDED</a>; i++){</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">if</span>(!names[i][0])</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span>(r[i] != r[0] || g[i] != g[0] || b[i] != b[0]){</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            same = 0;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// If they are, just output that color</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">if</span>(same){</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordtype">char</span>* buffer = malloc(7);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        snprintf(buffer, 7, <span class="stringliteral">&quot;%02x%02x%02x&quot;</span>, r[0], g[0], b[0]);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">return</span> buffer;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> BUFFER_LEN = 4096;    <span class="comment">// Should be more than enough to fit all keys</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordtype">char</span>* buffer = malloc(BUFFER_LEN);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordtype">int</span> length = 0;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="daemon_2keymap_8h.html#ae1b7aad208a3aca184f7ea6f4bb8643c">N_KEYS_EXTENDED</a>; i++){</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">if</span>(!names[i][0])</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment">// Print the key name</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordtype">int</span> newlen = 0;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        snprintf(buffer + length, BUFFER_LEN - length, length == 0 ? <span class="stringliteral">&quot;%s%n&quot;</span> : <span class="stringliteral">&quot; %s%n&quot;</span>, names[i], &amp;newlen);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        length += newlen;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="comment">// Look ahead to see if any other keys have this color. If so, print them here as well.</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> kr = r[i], kg = g[i], kb = b[i];</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = i + 1; j &lt; <a class="code" href="daemon_2keymap_8h.html#ae1b7aad208a3aca184f7ea6f4bb8643c">N_KEYS_EXTENDED</a>; j++){</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordflow">if</span>(!names[j][0])</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">if</span>(r[j] != kr || g[j] != kg || b[j] != kb)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            snprintf(buffer + length, BUFFER_LEN - length, <span class="stringliteral">&quot;,%s%n&quot;</span>, names[j], &amp;newlen);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            length += newlen;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="comment">// Erase the key&#39;s name so it won&#39;t get printed later</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            names[j][0] = 0;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="comment">// Print the color</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        snprintf(buffer + length, BUFFER_LEN - length, <span class="stringliteral">&quot;:%02x%02x%02x%n&quot;</span>, kr, kg, kb, &amp;newlen);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        length += newlen;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">return</span> buffer;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;}</div>
<div class="ttc" id="led_8c_html_a97b59f7ad581a5fdd8e2becec0b7725b"><div class="ttname"><a href="led_8c.html#a97b59f7ad581a5fdd8e2becec0b7725b">has_key</a></div><div class="ttdeci">static int has_key(const char *name, const usbdevice *kb)</div><div class="ttdef"><b>Definition:</b> <a href="led_8c_source.html#l00073">led.c:73</a></div></div>
<div class="ttc" id="structures_8h_html_abeb581d1f9790ac0dc97bd177546586e"><div class="ttname"><a href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">lighting::b</a></div><div class="ttdeci">uchar b[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00076">structures.h:76</a></div></div>
<div class="ttc" id="daemon_2keymap_8h_html_adfb7efb615d23c01a629dbf1f0aa83c4"><div class="ttname"><a href="daemon_2keymap_8h.html#adfb7efb615d23c01a629dbf1f0aa83c4">key::led</a></div><div class="ttdeci">short led</div><div class="ttdef"><b>Definition:</b> <a href="daemon_2keymap_8h_source.html#l00051">keymap.h:51</a></div></div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="daemon_2keymap_8h_html_aaa2ca200a4bd86567f53851153b045af"><div class="ttname"><a href="daemon_2keymap_8h.html#aaa2ca200a4bd86567f53851153b045af">key::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="daemon_2keymap_8h_source.html#l00050">keymap.h:50</a></div></div>
<div class="ttc" id="structures_8h_html_aef072a169d12aabf02985bd659103244"><div class="ttname"><a href="structures_8h.html#aef072a169d12aabf02985bd659103244">lighting::g</a></div><div class="ttdeci">uchar g[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00075">structures.h:75</a></div></div>
<div class="ttc" id="structures_8h_html_a58f2fbe1709465a5258292e8c8421f58"><div class="ttname"><a href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">lighting::r</a></div><div class="ttdeci">uchar r[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00074">structures.h:74</a></div></div>
<div class="ttc" id="daemon_2keymap_8h_html_ae1b7aad208a3aca184f7ea6f4bb8643c"><div class="ttname"><a href="daemon_2keymap_8h.html#ae1b7aad208a3aca184f7ea6f4bb8643c">N_KEYS_EXTENDED</a></div><div class="ttdeci">#define N_KEYS_EXTENDED</div><div class="ttdef"><b>Definition:</b> <a href="daemon_2keymap_8h_source.html#l00045">keymap.h:45</a></div></div>
<div class="ttc" id="keymap_8c_html_a5972a715b26e6b792acc53ad946e1fbb"><div class="ttname"><a href="keymap_8c.html#a5972a715b26e6b792acc53ad946e1fbb">keymap</a></div><div class="ttdeci">const key keymap[(((152+3+12)+25)+11)]</div><div class="ttdef"><b>Definition:</b> <a href="keymap_8c_source.html#l00005">keymap.c:5</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_a61bbab0cdb67df911571f98dfbf531e3_cgraph.png" border="0" usemap="#led_8h_a61bbab0cdb67df911571f98dfbf531e3_cgraph" alt=""/></div>
<map name="led_8h_a61bbab0cdb67df911571f98dfbf531e3_cgraph" id="led_8h_a61bbab0cdb67df911571f98dfbf531e3_cgraph">
<area shape="rect" id="node2" href="led_8c.html#a97b59f7ad581a5fdd8e2becec0b7725b" title="has_key" alt="" coords="121,5,191,32"/></map>
</div>
</p>

<p><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_a61bbab0cdb67df911571f98dfbf531e3_icgraph.png" border="0" usemap="#led_8h_a61bbab0cdb67df911571f98dfbf531e3_icgraph" alt=""/></div>
<map name="led_8h_a61bbab0cdb67df911571f98dfbf531e3_icgraph" id="led_8h_a61bbab0cdb67df911571f98dfbf531e3_icgraph">
<area shape="rect" id="node2" href="notify_8c.html#a43f4edf3463eff4979c3ad361ca40306" title="_cmd_get" alt="" coords="121,5,199,32"/><area shape="rect" id="node3" href="notify_8h.html#a49d278b14d646bfbd4b466b0fff80aae" title="cmd_get" alt="" coords="248,5,320,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa8009a607c4c46e41dd64f8490b1582d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int savergb_kb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structlighting">lighting</a> *&#160;</td>
          <td class="paramname"><em>light</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="led__keyboard_8c_source.html#l00139">139</a> of file <a class="el" href="led__keyboard_8c_source.html">led_keyboard.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00249">usbdevice::dither</a>, <a class="el" href="structures_8h_source.html#l00239">usbdevice::fwversion</a>, <a class="el" href="usb_8h_source.html#l00077">IS_STRAFE</a>, <a class="el" href="led__keyboard_8c_source.html#l00036">makergb_512()</a>, <a class="el" href="led__keyboard_8c_source.html#l00056">makergb_full()</a>, <a class="el" href="structures_8h_source.html#l00176">MSG_SIZE</a>, <a class="el" href="led__keyboard_8c_source.html#l00024">ordered8to3()</a>, <a class="el" href="led__keyboard_8c_source.html#l00032">quantize8to3()</a>, and <a class="el" href="usb_8h_source.html#l00237">usbsend</a>.</p>

<p>Referenced by <a class="el" href="profile__keyboard_8c_source.html#l00057">cmd_hwsave_kb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                                        {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span>(kb-&gt;<a class="code" href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">fwversion</a> &gt;= 0x0120){</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> data_pkt[12][<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="comment">// Red</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            { 0x7f, 0x01, 60, 0 },</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            { 0x7f, 0x02, 60, 0 },</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            { 0x7f, 0x03, 24, 0 },</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            { 0x07, 0x14, 0x03, 0x01, 0x01, mode + 1, 0x01 },</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="comment">// Green</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            { 0x7f, 0x01, 60, 0 },</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            { 0x7f, 0x02, 60, 0 },</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            { 0x7f, 0x03, 24, 0 },</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            { 0x07, 0x14, 0x03, 0x01, 0x01, mode + 1, 0x02 },</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <span class="comment">// Blue</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            { 0x7f, 0x01, 60, 0 },</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            { 0x7f, 0x02, 60, 0 },</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            { 0x7f, 0x03, 24, 0 },</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            { 0x07, 0x14, 0x03, 0x01, 0x01, mode + 1, 0x03 }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        };</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <a class="code" href="led__keyboard_8c.html#aa2518c44d1de14ec9852cc768f4e19f8">makergb_full</a>(light, data_pkt);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, data_pkt[0], 12))</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="usb_8h.html#a934f88a3315f982a29c851cd8293155f">IS_STRAFE</a>(kb)){ <span class="comment">// end save</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> save_end_pkt[<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = { 0x07, 0x14, 0x04, 0x01, 0x01 };</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, save_end_pkt, 1))</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> data_pkt[5][<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            { 0x7f, 0x01, 60, 0 },</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            { 0x7f, 0x02, 60, 0 },</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            { 0x7f, 0x03, 60, 0 },</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            { 0x7f, 0x04, 36, 0 },</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            { 0x07, 0x14, 0x02, 0x00, 0x01, mode + 1 }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        };</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <a class="code" href="led__keyboard_8c.html#ad37b49215ddbb5fdfcbc185bee256b28">makergb_512</a>(light, data_pkt, kb-&gt;<a class="code" href="structures_8h.html#ac001911d43498f4165bfc7cdd5024d39">dither</a> ? <a class="code" href="led__keyboard_8c.html#a384276467a5331b5c6d134c00476b8a3">ordered8to3</a> : <a class="code" href="led__keyboard_8c.html#abb9b4e916b13b54ab23b4b5ace4e293d">quantize8to3</a>);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, data_pkt[0], 5))</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_ad4d025ecf1bdbf8b244ca688df8e478d"><div class="ttname"><a href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a></div><div class="ttdeci">#define MSG_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00176">structures.h:176</a></div></div>
<div class="ttc" id="led__keyboard_8c_html_abb9b4e916b13b54ab23b4b5ace4e293d"><div class="ttname"><a href="led__keyboard_8c.html#abb9b4e916b13b54ab23b4b5ace4e293d">quantize8to3</a></div><div class="ttdeci">static uchar quantize8to3(int index, uchar value)</div><div class="ttdef"><b>Definition:</b> <a href="led__keyboard_8c_source.html#l00032">led_keyboard.c:32</a></div></div>
<div class="ttc" id="structures_8h_html_a47e0bd130899bcf5acdef059f2970ac7"><div class="ttname"><a href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">usbdevice::fwversion</a></div><div class="ttdeci">ushort fwversion</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00239">structures.h:239</a></div></div>
<div class="ttc" id="structures_8h_html_ac001911d43498f4165bfc7cdd5024d39"><div class="ttname"><a href="structures_8h.html#ac001911d43498f4165bfc7cdd5024d39">usbdevice::dither</a></div><div class="ttdeci">char dither</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00249">structures.h:249</a></div></div>
<div class="ttc" id="led__keyboard_8c_html_aa2518c44d1de14ec9852cc768f4e19f8"><div class="ttname"><a href="led__keyboard_8c.html#aa2518c44d1de14ec9852cc768f4e19f8">makergb_full</a></div><div class="ttdeci">static void makergb_full(const lighting *light, uchar data_pkt[12][64])</div><div class="ttdef"><b>Definition:</b> <a href="led__keyboard_8c_source.html#l00056">led_keyboard.c:56</a></div></div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="led__keyboard_8c_html_a384276467a5331b5c6d134c00476b8a3"><div class="ttname"><a href="led__keyboard_8c.html#a384276467a5331b5c6d134c00476b8a3">ordered8to3</a></div><div class="ttdeci">static uchar ordered8to3(int index, uchar value)</div><div class="ttdef"><b>Definition:</b> <a href="led__keyboard_8c_source.html#l00024">led_keyboard.c:24</a></div></div>
<div class="ttc" id="usb_8h_html_a934f88a3315f982a29c851cd8293155f"><div class="ttname"><a href="usb_8h.html#a934f88a3315f982a29c851cd8293155f">IS_STRAFE</a></div><div class="ttdeci">#define IS_STRAFE(kb)</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00077">usb.h:77</a></div></div>
<div class="ttc" id="led__keyboard_8c_html_ad37b49215ddbb5fdfcbc185bee256b28"><div class="ttname"><a href="led__keyboard_8c.html#ad37b49215ddbb5fdfcbc185bee256b28">makergb_512</a></div><div class="ttdeci">static void makergb_512(const lighting *light, uchar data_pkt[5][64], uchar(*ditherfn)(int, uchar))</div><div class="ttdef"><b>Definition:</b> <a href="led__keyboard_8c_source.html#l00036">led_keyboard.c:36</a></div></div>
<div class="ttc" id="usb_8h_html_a5eaa2b8ffe9e62747454c74b19876819"><div class="ttname"><a href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a></div><div class="ttdeci">#define usbsend(kb, messages, count)</div><div class="ttdoc">usbsend macro is used to wrap _usbsend() with debugging information (file and lineno) ...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00237">usb.h:237</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_aa8009a607c4c46e41dd64f8490b1582d_cgraph.png" border="0" usemap="#led_8h_aa8009a607c4c46e41dd64f8490b1582d_cgraph" alt=""/></div>
<map name="led_8h_aa8009a607c4c46e41dd64f8490b1582d_cgraph" id="led_8h_aa8009a607c4c46e41dd64f8490b1582d_cgraph">
<area shape="rect" id="node2" href="led__keyboard_8c.html#ad37b49215ddbb5fdfcbc185bee256b28" title="makergb_512" alt="" coords="145,5,245,32"/><area shape="rect" id="node3" href="led__keyboard_8c.html#aa2518c44d1de14ec9852cc768f4e19f8" title="makergb_full" alt="" coords="147,56,243,83"/><area shape="rect" id="node4" href="led__keyboard_8c.html#a384276467a5331b5c6d134c00476b8a3" title="ordered8to3" alt="" coords="149,107,240,133"/><area shape="rect" id="node5" href="led__keyboard_8c.html#abb9b4e916b13b54ab23b4b5ace4e293d" title="quantize8to3" alt="" coords="147,157,243,184"/></map>
</div>
</p>

<p><div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_aa8009a607c4c46e41dd64f8490b1582d_icgraph.png" border="0" usemap="#led_8h_aa8009a607c4c46e41dd64f8490b1582d_icgraph" alt=""/></div>
<map name="led_8h_aa8009a607c4c46e41dd64f8490b1582d_icgraph" id="led_8h_aa8009a607c4c46e41dd64f8490b1582d_icgraph">
<area shape="rect" id="node2" href="profile__keyboard_8c.html#a0fb79af80f15adc4b2b923d5b5774b76" title="cmd_hwsave_kb" alt="" coords="144,5,264,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="accf371f84a8aecacae0143edc399885e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int savergb_mouse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structlighting">lighting</a> *&#160;</td>
          <td class="paramname"><em>light</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="led__mouse_8c_source.html#l00062">62</a> of file <a class="el" href="led__mouse_8c_source.html">led_mouse.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00076">lighting::b</a>, <a class="el" href="structures_8h_source.html#l00075">lighting::g</a>, <a class="el" href="usb_8h_source.html#l00093">IS_SABRE</a>, <a class="el" href="usb_8h_source.html#l00099">IS_SCIMITAR</a>, <a class="el" href="daemon_2keymap_8h_source.html#l00043">LED_DPI</a>, <a class="el" href="daemon_2keymap_8h_source.html#l00039">LED_MOUSE</a>, <a class="el" href="structures_8h_source.html#l00176">MSG_SIZE</a>, <a class="el" href="structures_8h_source.html#l00074">lighting::r</a>, and <a class="el" href="usb_8h_source.html#l00237">usbsend</a>.</p>

<p>Referenced by <a class="el" href="profile__mouse_8c_source.html#l00050">cmd_hwsave_mouse()</a>.</p>
<div class="fragment"><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                                                           {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> data_pkt[<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = { 0x07, 0x13, 0x10, 1, 0 };</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// Save each RGB zone, minus the DPI light which is sent in the DPI packets</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">int</span> zonecount = <a class="code" href="usb_8h.html#a42d0504a482944df6fe7cbdb06c0851b">IS_SCIMITAR</a>(kb) ? 4 : <a class="code" href="usb_8h.html#a42deb465caa31f803a16306986cd6bbe">IS_SABRE</a>(kb) ? 3 : 2;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; zonecount; i++){</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordtype">int</span> led = <a class="code" href="daemon_2keymap_8h.html#ac4f7d9dce5248992866a0f2e23fe8200">LED_MOUSE</a> + i;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">if</span>(led &gt;= <a class="code" href="daemon_2keymap_8h.html#a651d575ebe5d00bbe17ae5fd9dbf41f8">LED_DPI</a>)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            led++;          <span class="comment">// Skip DPI light</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        data_pkt[4] = light-&gt;<a class="code" href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">r</a>[led];</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        data_pkt[5] = light-&gt;<a class="code" href="structures_8h.html#aef072a169d12aabf02985bd659103244">g</a>[led];</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        data_pkt[6] = light-&gt;<a class="code" href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">b</a>[led];</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, data_pkt, 1))</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="comment">// Set packet for next zone</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        data_pkt[2]++;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_ad4d025ecf1bdbf8b244ca688df8e478d"><div class="ttname"><a href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a></div><div class="ttdeci">#define MSG_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00176">structures.h:176</a></div></div>
<div class="ttc" id="structures_8h_html_abeb581d1f9790ac0dc97bd177546586e"><div class="ttname"><a href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">lighting::b</a></div><div class="ttdeci">uchar b[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00076">structures.h:76</a></div></div>
<div class="ttc" id="daemon_2keymap_8h_html_ac4f7d9dce5248992866a0f2e23fe8200"><div class="ttname"><a href="daemon_2keymap_8h.html#ac4f7d9dce5248992866a0f2e23fe8200">LED_MOUSE</a></div><div class="ttdeci">#define LED_MOUSE</div><div class="ttdef"><b>Definition:</b> <a href="daemon_2keymap_8h_source.html#l00039">keymap.h:39</a></div></div>
<div class="ttc" id="usb_8h_html_a42d0504a482944df6fe7cbdb06c0851b"><div class="ttname"><a href="usb_8h.html#a42d0504a482944df6fe7cbdb06c0851b">IS_SCIMITAR</a></div><div class="ttdeci">#define IS_SCIMITAR(kb)</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00099">usb.h:99</a></div></div>
<div class="ttc" id="usb_8h_html_a42deb465caa31f803a16306986cd6bbe"><div class="ttname"><a href="usb_8h.html#a42deb465caa31f803a16306986cd6bbe">IS_SABRE</a></div><div class="ttdeci">#define IS_SABRE(kb)</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00093">usb.h:93</a></div></div>
<div class="ttc" id="daemon_2keymap_8h_html_a651d575ebe5d00bbe17ae5fd9dbf41f8"><div class="ttname"><a href="daemon_2keymap_8h.html#a651d575ebe5d00bbe17ae5fd9dbf41f8">LED_DPI</a></div><div class="ttdeci">#define LED_DPI</div><div class="ttdef"><b>Definition:</b> <a href="daemon_2keymap_8h_source.html#l00043">keymap.h:43</a></div></div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="structures_8h_html_aef072a169d12aabf02985bd659103244"><div class="ttname"><a href="structures_8h.html#aef072a169d12aabf02985bd659103244">lighting::g</a></div><div class="ttdeci">uchar g[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00075">structures.h:75</a></div></div>
<div class="ttc" id="structures_8h_html_a58f2fbe1709465a5258292e8c8421f58"><div class="ttname"><a href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">lighting::r</a></div><div class="ttdeci">uchar r[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00074">structures.h:74</a></div></div>
<div class="ttc" id="usb_8h_html_a5eaa2b8ffe9e62747454c74b19876819"><div class="ttname"><a href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a></div><div class="ttdeci">#define usbsend(kb, messages, count)</div><div class="ttdoc">usbsend macro is used to wrap _usbsend() with debugging information (file and lineno) ...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00237">usb.h:237</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_accf371f84a8aecacae0143edc399885e_icgraph.png" border="0" usemap="#led_8h_accf371f84a8aecacae0143edc399885e_icgraph" alt=""/></div>
<map name="led_8h_accf371f84a8aecacae0143edc399885e_icgraph" id="led_8h_accf371f84a8aecacae0143edc399885e_icgraph">
<area shape="rect" id="node2" href="profile__mouse_8c.html#a6090891cb40a7bb20228c3ca0cb99c37" title="cmd_hwsave_mouse" alt="" coords="169,5,314,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac93a454c8a0dcb5d68145876fcea4348"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int updatergb_kb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>force</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="led__keyboard_8c_source.html#l00077">77</a> of file <a class="el" href="led__keyboard_8c_source.html">led_keyboard.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00231">usbdevice::active</a>, <a class="el" href="structures_8h_source.html#l00105">usbprofile::currentmode</a>, <a class="el" href="structures_8h_source.html#l00249">usbdevice::dither</a>, <a class="el" href="structures_8h_source.html#l00077">lighting::forceupdate</a>, <a class="el" href="usb_8h_source.html#l00136">IS_FULLRANGE</a>, <a class="el" href="structures_8h_source.html#l00107">usbprofile::lastlight</a>, <a class="el" href="structures_8h_source.html#l00084">usbmode::light</a>, <a class="el" href="led__keyboard_8c_source.html#l00036">makergb_512()</a>, <a class="el" href="led__keyboard_8c_source.html#l00056">makergb_full()</a>, <a class="el" href="structures_8h_source.html#l00176">MSG_SIZE</a>, <a class="el" href="led__keyboard_8c_source.html#l00024">ordered8to3()</a>, <a class="el" href="structures_8h_source.html#l00221">usbdevice::profile</a>, <a class="el" href="led__keyboard_8c_source.html#l00032">quantize8to3()</a>, <a class="el" href="led__keyboard_8c_source.html#l00072">rgbcmp()</a>, <a class="el" href="structures_8h_source.html#l00078">lighting::sidelight</a>, and <a class="el" href="usb_8h_source.html#l00237">usbsend</a>.</p>
<div class="fragment"><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                                          {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span>(!kb-&gt;<a class="code" href="structures_8h.html#a8889b6a5d3ce83427377e3a3de947f03">active</a>)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="structures_8h.html#structlighting">lighting</a>* lastlight = &amp;kb-&gt;<a class="code" href="structures_8h.html#a9601fc030cb4b69d9e05997a44a3a89c">profile</a>-&gt;<a class="code" href="structures_8h.html#a51d0b1cc9f728c74e7134095205e3765">lastlight</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="structures_8h.html#structlighting">lighting</a>* newlight = &amp;kb-&gt;<a class="code" href="structures_8h.html#a9601fc030cb4b69d9e05997a44a3a89c">profile</a>-&gt;<a class="code" href="structures_8h.html#a5646d61c7780a87a21b70209396ff605">currentmode</a>-&gt;<a class="code" href="structures_8h.html#a4adb0b5a770a32ee4db36dca49398ce9">light</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// Don&#39;t do anything if the lighting hasn&#39;t changed</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span>(!force &amp;&amp; !lastlight-&gt;<a class="code" href="structures_8h.html#ae593d2a41548d4cc2a3c886caa4a53b2">forceupdate</a> &amp;&amp; !newlight-&gt;<a class="code" href="structures_8h.html#ae593d2a41548d4cc2a3c886caa4a53b2">forceupdate</a></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            &amp;&amp; !<a class="code" href="led__keyboard_8c.html#a26c3f20a1a58c8116d45d3792ce9b923">rgbcmp</a>(lastlight, newlight) &amp;&amp; lastlight-&gt;<a class="code" href="structures_8h.html#a761a7cf0b0943ecba869358267c54028">sidelight</a> == newlight-&gt;<a class="code" href="structures_8h.html#a761a7cf0b0943ecba869358267c54028">sidelight</a>)   <span class="comment">// strafe sidelights</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    lastlight-&gt;<a class="code" href="structures_8h.html#ae593d2a41548d4cc2a3c886caa4a53b2">forceupdate</a> = newlight-&gt;<a class="code" href="structures_8h.html#ae593d2a41548d4cc2a3c886caa4a53b2">forceupdate</a> = 0;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="usb_8h.html#ad1509021d1156508bfd4c6c570987041">IS_FULLRANGE</a>(kb)){</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="comment">// Update strafe sidelights if necessary</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">if</span>(lastlight-&gt;<a class="code" href="structures_8h.html#a761a7cf0b0943ecba869358267c54028">sidelight</a> != newlight-&gt;<a class="code" href="structures_8h.html#a761a7cf0b0943ecba869358267c54028">sidelight</a>) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> data_pkt[2][<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                 { 0x07, 0x05, 0x08, 0x00, 0x00 },</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                 { 0x07, 0x05, 0x02, 0, 0x03 }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;             };</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;             <span class="keywordflow">if</span> (newlight-&gt;<a class="code" href="structures_8h.html#a761a7cf0b0943ecba869358267c54028">sidelight</a>)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                 data_pkt[0][4]=1;    <span class="comment">// turn on</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;             <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, data_pkt[0], 2))</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                 <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment">// 16.8M color lighting works fine on strafe and is the only way it actually works</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> data_pkt[12][<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="comment">// Red</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            { 0x7f, 0x01, 0x3c, 0 },</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            { 0x7f, 0x02, 0x3c, 0 },</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            { 0x7f, 0x03, 0x18, 0 },</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            { 0x07, 0x28, 0x01, 0x03, 0x01, 0},</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="comment">// Green</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            { 0x7f, 0x01, 0x3c, 0 },</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            { 0x7f, 0x02, 0x3c, 0 },</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            { 0x7f, 0x03, 0x18, 0 },</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            { 0x07, 0x28, 0x02, 0x03, 0x01, 0},</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="comment">// Blue</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            { 0x7f, 0x01, 0x3c, 0 },</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            { 0x7f, 0x02, 0x3c, 0 },</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            { 0x7f, 0x03, 0x18, 0 },</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            { 0x07, 0x28, 0x03, 0x03, 0x02, 0}</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        };</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <a class="code" href="led__keyboard_8c.html#aa2518c44d1de14ec9852cc768f4e19f8">makergb_full</a>(newlight, data_pkt);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, data_pkt[0], 12))</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="comment">// On older keyboards it looks flickery and causes lighting glitches, so we don&#39;t use it.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> data_pkt[5][<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            { 0x7f, 0x01, 60, 0 },</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            { 0x7f, 0x02, 60, 0 },</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            { 0x7f, 0x03, 60, 0 },</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            { 0x7f, 0x04, 36, 0 },</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            { 0x07, 0x27, 0x00, 0x00, 0xD8 }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        };</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <a class="code" href="led__keyboard_8c.html#ad37b49215ddbb5fdfcbc185bee256b28">makergb_512</a>(newlight, data_pkt, kb-&gt;<a class="code" href="structures_8h.html#ac001911d43498f4165bfc7cdd5024d39">dither</a> ? <a class="code" href="led__keyboard_8c.html#a384276467a5331b5c6d134c00476b8a3">ordered8to3</a> : <a class="code" href="led__keyboard_8c.html#abb9b4e916b13b54ab23b4b5ace4e293d">quantize8to3</a>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, data_pkt[0], 5))</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    memcpy(lastlight, newlight, <span class="keyword">sizeof</span>(<a class="code" href="structures_8h.html#structlighting">lighting</a>));</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;}</div>
<div class="ttc" id="usb_8h_html_ad1509021d1156508bfd4c6c570987041"><div class="ttname"><a href="usb_8h.html#ad1509021d1156508bfd4c6c570987041">IS_FULLRANGE</a></div><div class="ttdeci">#define IS_FULLRANGE(kb)</div><div class="ttdoc">Full color range (16.8M) vs partial color range (512) </div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00136">usb.h:136</a></div></div>
<div class="ttc" id="structures_8h_html_ad4d025ecf1bdbf8b244ca688df8e478d"><div class="ttname"><a href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a></div><div class="ttdeci">#define MSG_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00176">structures.h:176</a></div></div>
<div class="ttc" id="structures_8h_html_a761a7cf0b0943ecba869358267c54028"><div class="ttname"><a href="structures_8h.html#a761a7cf0b0943ecba869358267c54028">lighting::sidelight</a></div><div class="ttdeci">uchar sidelight</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00078">structures.h:78</a></div></div>
<div class="ttc" id="structures_8h_html_a51d0b1cc9f728c74e7134095205e3765"><div class="ttname"><a href="structures_8h.html#a51d0b1cc9f728c74e7134095205e3765">usbprofile::lastlight</a></div><div class="ttdeci">lighting lastlight</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00107">structures.h:107</a></div></div>
<div class="ttc" id="structures_8h_html_a9601fc030cb4b69d9e05997a44a3a89c"><div class="ttname"><a href="structures_8h.html#a9601fc030cb4b69d9e05997a44a3a89c">usbdevice::profile</a></div><div class="ttdeci">usbprofile * profile</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00221">structures.h:221</a></div></div>
<div class="ttc" id="structures_8h_html_a5646d61c7780a87a21b70209396ff605"><div class="ttname"><a href="structures_8h.html#a5646d61c7780a87a21b70209396ff605">usbprofile::currentmode</a></div><div class="ttdeci">usbmode * currentmode</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00105">structures.h:105</a></div></div>
<div class="ttc" id="led__keyboard_8c_html_abb9b4e916b13b54ab23b4b5ace4e293d"><div class="ttname"><a href="led__keyboard_8c.html#abb9b4e916b13b54ab23b4b5ace4e293d">quantize8to3</a></div><div class="ttdeci">static uchar quantize8to3(int index, uchar value)</div><div class="ttdef"><b>Definition:</b> <a href="led__keyboard_8c_source.html#l00032">led_keyboard.c:32</a></div></div>
<div class="ttc" id="structures_8h_html_ac001911d43498f4165bfc7cdd5024d39"><div class="ttname"><a href="structures_8h.html#ac001911d43498f4165bfc7cdd5024d39">usbdevice::dither</a></div><div class="ttdeci">char dither</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00249">structures.h:249</a></div></div>
<div class="ttc" id="structures_8h_html_a8889b6a5d3ce83427377e3a3de947f03"><div class="ttname"><a href="structures_8h.html#a8889b6a5d3ce83427377e3a3de947f03">usbdevice::active</a></div><div class="ttdeci">char active</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00231">structures.h:231</a></div></div>
<div class="ttc" id="structures_8h_html_a4adb0b5a770a32ee4db36dca49398ce9"><div class="ttname"><a href="structures_8h.html#a4adb0b5a770a32ee4db36dca49398ce9">usbmode::light</a></div><div class="ttdeci">lighting light</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00084">structures.h:84</a></div></div>
<div class="ttc" id="led__keyboard_8c_html_aa2518c44d1de14ec9852cc768f4e19f8"><div class="ttname"><a href="led__keyboard_8c.html#aa2518c44d1de14ec9852cc768f4e19f8">makergb_full</a></div><div class="ttdeci">static void makergb_full(const lighting *light, uchar data_pkt[12][64])</div><div class="ttdef"><b>Definition:</b> <a href="led__keyboard_8c_source.html#l00056">led_keyboard.c:56</a></div></div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="led__keyboard_8c_html_a26c3f20a1a58c8116d45d3792ce9b923"><div class="ttname"><a href="led__keyboard_8c.html#a26c3f20a1a58c8116d45d3792ce9b923">rgbcmp</a></div><div class="ttdeci">static int rgbcmp(const lighting *lhs, const lighting *rhs)</div><div class="ttdef"><b>Definition:</b> <a href="led__keyboard_8c_source.html#l00072">led_keyboard.c:72</a></div></div>
<div class="ttc" id="structures_8h_html_ae593d2a41548d4cc2a3c886caa4a53b2"><div class="ttname"><a href="structures_8h.html#ae593d2a41548d4cc2a3c886caa4a53b2">lighting::forceupdate</a></div><div class="ttdeci">uchar forceupdate</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00077">structures.h:77</a></div></div>
<div class="ttc" id="structures_8h_html_structlighting"><div class="ttname"><a href="structures_8h.html#structlighting">lighting</a></div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00073">structures.h:73</a></div></div>
<div class="ttc" id="led__keyboard_8c_html_a384276467a5331b5c6d134c00476b8a3"><div class="ttname"><a href="led__keyboard_8c.html#a384276467a5331b5c6d134c00476b8a3">ordered8to3</a></div><div class="ttdeci">static uchar ordered8to3(int index, uchar value)</div><div class="ttdef"><b>Definition:</b> <a href="led__keyboard_8c_source.html#l00024">led_keyboard.c:24</a></div></div>
<div class="ttc" id="led__keyboard_8c_html_ad37b49215ddbb5fdfcbc185bee256b28"><div class="ttname"><a href="led__keyboard_8c.html#ad37b49215ddbb5fdfcbc185bee256b28">makergb_512</a></div><div class="ttdeci">static void makergb_512(const lighting *light, uchar data_pkt[5][64], uchar(*ditherfn)(int, uchar))</div><div class="ttdef"><b>Definition:</b> <a href="led__keyboard_8c_source.html#l00036">led_keyboard.c:36</a></div></div>
<div class="ttc" id="usb_8h_html_a5eaa2b8ffe9e62747454c74b19876819"><div class="ttname"><a href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a></div><div class="ttdeci">#define usbsend(kb, messages, count)</div><div class="ttdoc">usbsend macro is used to wrap _usbsend() with debugging information (file and lineno) ...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00237">usb.h:237</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_ac93a454c8a0dcb5d68145876fcea4348_cgraph.png" border="0" usemap="#led_8h_ac93a454c8a0dcb5d68145876fcea4348_cgraph" alt=""/></div>
<map name="led_8h_ac93a454c8a0dcb5d68145876fcea4348_cgraph" id="led_8h_ac93a454c8a0dcb5d68145876fcea4348_cgraph">
<area shape="rect" id="node2" href="led__keyboard_8c.html#ad37b49215ddbb5fdfcbc185bee256b28" title="makergb_512" alt="" coords="155,5,255,32"/><area shape="rect" id="node3" href="led__keyboard_8c.html#aa2518c44d1de14ec9852cc768f4e19f8" title="makergb_full" alt="" coords="157,56,253,83"/><area shape="rect" id="node4" href="led__keyboard_8c.html#a384276467a5331b5c6d134c00476b8a3" title="ordered8to3" alt="" coords="160,107,251,133"/><area shape="rect" id="node5" href="led__keyboard_8c.html#abb9b4e916b13b54ab23b4b5ace4e293d" title="quantize8to3" alt="" coords="157,157,253,184"/><area shape="rect" id="node6" href="led__keyboard_8c.html#a26c3f20a1a58c8116d45d3792ce9b923" title="rgbcmp" alt="" coords="173,208,238,235"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8ce4572649dc96fbff076a765f4a8ddd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int updatergb_mouse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>force</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="led__mouse_8c_source.html#l00020">20</a> of file <a class="el" href="led__mouse_8c_source.html">led_mouse.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00231">usbdevice::active</a>, <a class="el" href="structures_8h_source.html#l00076">lighting::b</a>, <a class="el" href="structures_8h_source.html#l00105">usbprofile::currentmode</a>, <a class="el" href="structures_8h_source.html#l00077">lighting::forceupdate</a>, <a class="el" href="structures_8h_source.html#l00075">lighting::g</a>, <a class="el" href="led__mouse_8c_source.html#l00013">isblack()</a>, <a class="el" href="structures_8h_source.html#l00107">usbprofile::lastlight</a>, <a class="el" href="daemon_2keymap_8h_source.html#l00039">LED_MOUSE</a>, <a class="el" href="structures_8h_source.html#l00084">usbmode::light</a>, <a class="el" href="structures_8h_source.html#l00176">MSG_SIZE</a>, <a class="el" href="daemon_2keymap_8h_source.html#l00040">N_MOUSE_ZONES</a>, <a class="el" href="structures_8h_source.html#l00221">usbdevice::profile</a>, <a class="el" href="structures_8h_source.html#l00074">lighting::r</a>, <a class="el" href="led__mouse_8c_source.html#l00007">rgbcmp()</a>, and <a class="el" href="usb_8h_source.html#l00237">usbsend</a>.</p>
<div class="fragment"><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                                             {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="keywordflow">if</span>(!kb-&gt;<a class="code" href="structures_8h.html#a8889b6a5d3ce83427377e3a3de947f03">active</a>)</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <a class="code" href="structures_8h.html#structlighting">lighting</a>* lastlight = &amp;kb-&gt;<a class="code" href="structures_8h.html#a9601fc030cb4b69d9e05997a44a3a89c">profile</a>-&gt;<a class="code" href="structures_8h.html#a51d0b1cc9f728c74e7134095205e3765">lastlight</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <a class="code" href="structures_8h.html#structlighting">lighting</a>* newlight = &amp;kb-&gt;<a class="code" href="structures_8h.html#a9601fc030cb4b69d9e05997a44a3a89c">profile</a>-&gt;<a class="code" href="structures_8h.html#a5646d61c7780a87a21b70209396ff605">currentmode</a>-&gt;<a class="code" href="structures_8h.html#a4adb0b5a770a32ee4db36dca49398ce9">light</a>;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="comment">// Don&#39;t do anything if the lighting hasn&#39;t changed</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordflow">if</span>(!force &amp;&amp; !lastlight-&gt;<a class="code" href="structures_8h.html#ae593d2a41548d4cc2a3c886caa4a53b2">forceupdate</a> &amp;&amp; !newlight-&gt;<a class="code" href="structures_8h.html#ae593d2a41548d4cc2a3c886caa4a53b2">forceupdate</a></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;            &amp;&amp; !<a class="code" href="led__mouse_8c.html#a26c3f20a1a58c8116d45d3792ce9b923">rgbcmp</a>(lastlight, newlight))</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    lastlight-&gt;<a class="code" href="structures_8h.html#ae593d2a41548d4cc2a3c886caa4a53b2">forceupdate</a> = newlight-&gt;<a class="code" href="structures_8h.html#ae593d2a41548d4cc2a3c886caa4a53b2">forceupdate</a> = 0;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// Send the RGB values for each zone to the mouse</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> data_pkt[2][<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>] = {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        { 0x07, 0x22, <a class="code" href="daemon_2keymap_8h.html#a1e78fe78cc88328d9c38f020f3262554">N_MOUSE_ZONES</a>, 0x01, 0 }, <span class="comment">// RGB colors</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        { 0x07, 0x05, 0x02, 0 }                 <span class="comment">// Lighting on/off</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    };</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>* rgb_data = &amp;data_pkt[0][4];</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="daemon_2keymap_8h.html#a1e78fe78cc88328d9c38f020f3262554">N_MOUSE_ZONES</a>; i++){</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        *rgb_data++ = i + 1;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        *rgb_data++ = newlight-&gt;<a class="code" href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">r</a>[<a class="code" href="daemon_2keymap_8h.html#ac4f7d9dce5248992866a0f2e23fe8200">LED_MOUSE</a> + i];</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        *rgb_data++ = newlight-&gt;<a class="code" href="structures_8h.html#aef072a169d12aabf02985bd659103244">g</a>[<a class="code" href="daemon_2keymap_8h.html#ac4f7d9dce5248992866a0f2e23fe8200">LED_MOUSE</a> + i];</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        *rgb_data++ = newlight-&gt;<a class="code" href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">b</a>[<a class="code" href="daemon_2keymap_8h.html#ac4f7d9dce5248992866a0f2e23fe8200">LED_MOUSE</a> + i];</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// Send RGB data</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, data_pkt[0], 1))</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordtype">int</span> was_black = <a class="code" href="led__mouse_8c.html#a2f1c316b6123096bf9a1fd0f97117952">isblack</a>(kb, lastlight), is_black = <a class="code" href="led__mouse_8c.html#a2f1c316b6123096bf9a1fd0f97117952">isblack</a>(kb, newlight);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">if</span>(is_black){</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="comment">// If the lighting is black, send the deactivation packet (M65 only)</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, data_pkt[1], 1))</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(was_black || force){</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="comment">// If the lighting WAS black, or if we&#39;re on forced update, send the activation packet</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        data_pkt[1][4] = 1;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, data_pkt[1], 1))</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    memcpy(lastlight, newlight, <span class="keyword">sizeof</span>(<a class="code" href="structures_8h.html#structlighting">lighting</a>));</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_ad4d025ecf1bdbf8b244ca688df8e478d"><div class="ttname"><a href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a></div><div class="ttdeci">#define MSG_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00176">structures.h:176</a></div></div>
<div class="ttc" id="structures_8h_html_a51d0b1cc9f728c74e7134095205e3765"><div class="ttname"><a href="structures_8h.html#a51d0b1cc9f728c74e7134095205e3765">usbprofile::lastlight</a></div><div class="ttdeci">lighting lastlight</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00107">structures.h:107</a></div></div>
<div class="ttc" id="led__mouse_8c_html_a2f1c316b6123096bf9a1fd0f97117952"><div class="ttname"><a href="led__mouse_8c.html#a2f1c316b6123096bf9a1fd0f97117952">isblack</a></div><div class="ttdeci">static int isblack(const usbdevice *kb, const lighting *light)</div><div class="ttdef"><b>Definition:</b> <a href="led__mouse_8c_source.html#l00013">led_mouse.c:13</a></div></div>
<div class="ttc" id="structures_8h_html_abeb581d1f9790ac0dc97bd177546586e"><div class="ttname"><a href="structures_8h.html#abeb581d1f9790ac0dc97bd177546586e">lighting::b</a></div><div class="ttdeci">uchar b[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00076">structures.h:76</a></div></div>
<div class="ttc" id="structures_8h_html_a9601fc030cb4b69d9e05997a44a3a89c"><div class="ttname"><a href="structures_8h.html#a9601fc030cb4b69d9e05997a44a3a89c">usbdevice::profile</a></div><div class="ttdeci">usbprofile * profile</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00221">structures.h:221</a></div></div>
<div class="ttc" id="daemon_2keymap_8h_html_ac4f7d9dce5248992866a0f2e23fe8200"><div class="ttname"><a href="daemon_2keymap_8h.html#ac4f7d9dce5248992866a0f2e23fe8200">LED_MOUSE</a></div><div class="ttdeci">#define LED_MOUSE</div><div class="ttdef"><b>Definition:</b> <a href="daemon_2keymap_8h_source.html#l00039">keymap.h:39</a></div></div>
<div class="ttc" id="structures_8h_html_a5646d61c7780a87a21b70209396ff605"><div class="ttname"><a href="structures_8h.html#a5646d61c7780a87a21b70209396ff605">usbprofile::currentmode</a></div><div class="ttdeci">usbmode * currentmode</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00105">structures.h:105</a></div></div>
<div class="ttc" id="daemon_2keymap_8h_html_a1e78fe78cc88328d9c38f020f3262554"><div class="ttname"><a href="daemon_2keymap_8h.html#a1e78fe78cc88328d9c38f020f3262554">N_MOUSE_ZONES</a></div><div class="ttdeci">#define N_MOUSE_ZONES</div><div class="ttdef"><b>Definition:</b> <a href="daemon_2keymap_8h_source.html#l00040">keymap.h:40</a></div></div>
<div class="ttc" id="structures_8h_html_a8889b6a5d3ce83427377e3a3de947f03"><div class="ttname"><a href="structures_8h.html#a8889b6a5d3ce83427377e3a3de947f03">usbdevice::active</a></div><div class="ttdeci">char active</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00231">structures.h:231</a></div></div>
<div class="ttc" id="structures_8h_html_a4adb0b5a770a32ee4db36dca49398ce9"><div class="ttname"><a href="structures_8h.html#a4adb0b5a770a32ee4db36dca49398ce9">usbmode::light</a></div><div class="ttdeci">lighting light</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00084">structures.h:84</a></div></div>
<div class="ttc" id="led__mouse_8c_html_a26c3f20a1a58c8116d45d3792ce9b923"><div class="ttname"><a href="led__mouse_8c.html#a26c3f20a1a58c8116d45d3792ce9b923">rgbcmp</a></div><div class="ttdeci">static int rgbcmp(const lighting *lhs, const lighting *rhs)</div><div class="ttdef"><b>Definition:</b> <a href="led__mouse_8c_source.html#l00007">led_mouse.c:7</a></div></div>
<div class="ttc" id="includes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00025">includes.h:25</a></div></div>
<div class="ttc" id="structures_8h_html_ae593d2a41548d4cc2a3c886caa4a53b2"><div class="ttname"><a href="structures_8h.html#ae593d2a41548d4cc2a3c886caa4a53b2">lighting::forceupdate</a></div><div class="ttdeci">uchar forceupdate</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00077">structures.h:77</a></div></div>
<div class="ttc" id="structures_8h_html_aef072a169d12aabf02985bd659103244"><div class="ttname"><a href="structures_8h.html#aef072a169d12aabf02985bd659103244">lighting::g</a></div><div class="ttdeci">uchar g[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00075">structures.h:75</a></div></div>
<div class="ttc" id="structures_8h_html_structlighting"><div class="ttname"><a href="structures_8h.html#structlighting">lighting</a></div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00073">structures.h:73</a></div></div>
<div class="ttc" id="structures_8h_html_a58f2fbe1709465a5258292e8c8421f58"><div class="ttname"><a href="structures_8h.html#a58f2fbe1709465a5258292e8c8421f58">lighting::r</a></div><div class="ttdeci">uchar r[152+11]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00074">structures.h:74</a></div></div>
<div class="ttc" id="usb_8h_html_a5eaa2b8ffe9e62747454c74b19876819"><div class="ttname"><a href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a></div><div class="ttdeci">#define usbsend(kb, messages, count)</div><div class="ttdoc">usbsend macro is used to wrap _usbsend() with debugging information (file and lineno) ...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00237">usb.h:237</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><img src="led_8h_a8ce4572649dc96fbff076a765f4a8ddd_cgraph.png" border="0" usemap="#led_8h_a8ce4572649dc96fbff076a765f4a8ddd_cgraph" alt=""/></div>
<map name="led_8h_a8ce4572649dc96fbff076a765f4a8ddd_cgraph" id="led_8h_a8ce4572649dc96fbff076a765f4a8ddd_cgraph">
<area shape="rect" id="node2" href="led__mouse_8c.html#a2f1c316b6123096bf9a1fd0f97117952" title="isblack" alt="" coords="181,5,243,32"/><area shape="rect" id="node3" href="led__mouse_8c.html#a26c3f20a1a58c8116d45d3792ce9b923" title="rgbcmp" alt="" coords="179,56,245,83"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c663af95b3406af676444e819a47854e.html">ckb-daemon</a></li><li class="navelem"><a class="el" href="led_8h.html">led.h</a></li>
    <li class="footer">Generated on Tue May 16 2017 21:15:25 for ckb-next by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>

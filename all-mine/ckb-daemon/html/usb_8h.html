<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>ckb-next: src/ckb-daemon/usb.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ckb-128.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ckb-next
   &#160;<span id="projectnumber">beta-v0.2.7 at branch all-mine</span>
   </div>
   <div id="projectbrief">ckb-next driver for corsair devices</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('usb_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">usb.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Definitions for using USB interface.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="includes_8h_source.html">includes.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="keymap_8h_source.html">keymap.h</a>&quot;</code><br/>
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for usb.h:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h__incl.png" border="0" usemap="#src_2ckb-daemon_2usb_8h" alt=""/></div>
<map name="src_2ckb-daemon_2usb_8h" id="src_2ckb-daemon_2usb_8h">
<area shape="rect" id="node2" href="includes_8h.html" title="includes.h" alt="" coords="804,80,885,107"/><area shape="rect" id="node25" href="keymap_8h.html" title="keymap.h" alt="" coords="1588,229,1666,256"/><area shape="rect" id="node3" href="os_8h.html" title="os.h" alt="" coords="799,379,845,405"/><area shape="rect" id="node24" href="structures_8h.html" title="structures.h" alt="" coords="1582,155,1673,181"/><area shape="rect" id="node26" href="keymap__mac_8h.html" title="keymap_mac.h" alt="" coords="1170,304,1280,331"/></map>
</div>
</div><div class="textblock"><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> This graph shows which files directly or indirectly include this file:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h__dep__incl.png" border="0" usemap="#src_2ckb-daemon_2usb_8hdep" alt=""/></div>
<map name="src_2ckb-daemon_2usb_8hdep" id="src_2ckb-daemon_2usb_8hdep">
<area shape="rect" id="node2" href="devnode_8h.html" title="src/ckb&#45;daemon/devnode.h" alt="" coords="971,88,1149,115"/><area shape="rect" id="node3" href="command_8c.html" title="src/ckb&#45;daemon/command.c" alt="" coords="5,179,192,205"/><area shape="rect" id="node4" href="device__keyboard_8c.html" title="src/ckb&#45;daemon/device\l_keyboard.c" alt="" coords="421,171,579,213"/><area shape="rect" id="node5" href="device__mouse_8c.html" title="src/ckb&#45;daemon/device\l_mouse.c" alt="" coords="603,171,760,213"/><area shape="rect" id="node7" href="firmware_8c.html" title="src/ckb&#45;daemon/firmware.c" alt="" coords="217,179,396,205"/><area shape="rect" id="node10" href="usb_8c.html" title="src/ckb&#45;daemon/usb.c" alt="" coords="1174,179,1324,205"/><area shape="rect" id="node11" href="usb__linux_8c.html" title="src/ckb&#45;daemon/usb\l_linux.c" alt="" coords="1349,171,1488,213"/><area shape="rect" id="node12" href="usb__mac_8c.html" title="src/ckb&#45;daemon/usb\l_mac.c" alt="" coords="1695,171,1835,213"/><area shape="rect" id="node13" href="device_8c.html" title="src/ckb&#45;daemon/device.c" alt="" coords="1521,88,1689,115"/><area shape="rect" id="node14" href="input_8h.html" title="src/ckb&#45;daemon/input.h" alt="" coords="1338,88,1496,115"/><area shape="rect" id="node20" href="dpi_8c.html" title="src/ckb&#45;daemon/dpi.c" alt="" coords="1764,88,1911,115"/><area shape="rect" id="node21" href="led_8c.html" title="src/ckb&#45;daemon/led.c" alt="" coords="1935,88,2081,115"/><area shape="rect" id="node22" href="led__keyboard_8c.html" title="src/ckb&#45;daemon/led\l_keyboard.c" alt="" coords="2105,81,2240,122"/><area shape="rect" id="node23" href="led__mouse_8c.html" title="src/ckb&#45;daemon/led\l_mouse.c" alt="" coords="2265,81,2400,122"/><area shape="rect" id="node24" href="profile__keyboard_8c.html" title="src/ckb&#45;daemon/profile\l_keyboard.c" alt="" coords="2425,81,2579,122"/><area shape="rect" id="node25" href="profile__mouse_8c.html" title="src/ckb&#45;daemon/profile\l_mouse.c" alt="" coords="2604,81,2757,122"/><area shape="rect" id="node6" href="devnode_8c.html" title="src/ckb&#45;daemon/devnode.c" alt="" coords="971,179,1149,205"/><area shape="rect" id="node8" href="main_8c.html" title="src/ckb&#45;daemon/main.c" alt="" coords="1513,179,1671,205"/><area shape="rect" id="node9" href="notify_8c.html" title="src/ckb&#45;daemon/notify.c" alt="" coords="784,179,947,205"/><area shape="rect" id="node15" href="device__vtable_8c.html" title="src/ckb&#45;daemon/device\l_vtable.c" alt="" coords="2573,171,2731,213"/><area shape="rect" id="node16" href="input_8c.html" title="src/ckb&#45;daemon/input.c" alt="" coords="1859,179,2017,205"/><area shape="rect" id="node17" href="input__linux_8c.html" title="src/ckb&#45;daemon/input\l_linux.c" alt="" coords="2043,171,2189,213"/><area shape="rect" id="node18" href="input__mac_8c.html" title="src/ckb&#45;daemon/input\l_mac.c" alt="" coords="2213,171,2360,213"/><area shape="rect" id="node19" href="profile_8c.html" title="src/ckb&#45;daemon/profile.c" alt="" coords="2384,179,2548,205"/></map>
</div>
</div>
<p><a href="usb_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a2aa27325e30aac7dcec6203d4f11e996"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a>&#160;&#160;&#160;0x1b1c</td></tr>
<tr class="memdesc:a2aa27325e30aac7dcec6203d4f11e996"><td class="mdescLeft">&#160;</td><td class="mdescRight">For the following Defines please see "Detailed Description".  <a href="#a2aa27325e30aac7dcec6203d4f11e996">More...</a><br/></td></tr>
<tr class="separator:a2aa27325e30aac7dcec6203d4f11e996"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a9288dd24752f04930cbf9e673e536c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a0a9288dd24752f04930cbf9e673e536c">V_CORSAIR_STR</a>&#160;&#160;&#160;&quot;1b1c&quot;</td></tr>
<tr class="separator:a0a9288dd24752f04930cbf9e673e536c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affc75c5e028c467b9a294360b8a66a17"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#affc75c5e028c467b9a294360b8a66a17">P_K65</a>&#160;&#160;&#160;0x1b17</td></tr>
<tr class="separator:affc75c5e028c467b9a294360b8a66a17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68ad83cdaab7454132293dba6c28df23"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a68ad83cdaab7454132293dba6c28df23">P_K65_STR</a>&#160;&#160;&#160;&quot;1b17&quot;</td></tr>
<tr class="separator:a68ad83cdaab7454132293dba6c28df23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a300ce7bf9091c9da9ebcb83600f13faa"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a300ce7bf9091c9da9ebcb83600f13faa">P_K65_NRGB</a>&#160;&#160;&#160;0x1b07</td></tr>
<tr class="separator:a300ce7bf9091c9da9ebcb83600f13faa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ef72d2b71461a831ec2971fdb323d45"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a3ef72d2b71461a831ec2971fdb323d45">P_K65_NRGB_STR</a>&#160;&#160;&#160;&quot;1b07&quot;</td></tr>
<tr class="separator:a3ef72d2b71461a831ec2971fdb323d45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a976d0683dbfa2225bf40016d151f70d3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a976d0683dbfa2225bf40016d151f70d3">P_K65_LUX</a>&#160;&#160;&#160;0x1b37</td></tr>
<tr class="separator:a976d0683dbfa2225bf40016d151f70d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87f69e4b896c892cfb5b3ff1410d31ae"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a87f69e4b896c892cfb5b3ff1410d31ae">P_K65_LUX_STR</a>&#160;&#160;&#160;&quot;1b37&quot;</td></tr>
<tr class="separator:a87f69e4b896c892cfb5b3ff1410d31ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6a26ad33235021f82ada9c503e5661a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ae6a26ad33235021f82ada9c503e5661a">P_K65_RFIRE</a>&#160;&#160;&#160;0x1b39</td></tr>
<tr class="separator:ae6a26ad33235021f82ada9c503e5661a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a091ffc6a629d5e7b43678f451899acfc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a091ffc6a629d5e7b43678f451899acfc">P_K65_RFIRE_STR</a>&#160;&#160;&#160;&quot;1b39&quot;</td></tr>
<tr class="separator:a091ffc6a629d5e7b43678f451899acfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2e07011a0423b4667ec133f8b9900f8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ae2e07011a0423b4667ec133f8b9900f8">IS_K65</a>(kb)&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#affc75c5e028c467b9a294360b8a66a17">P_K65</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a300ce7bf9091c9da9ebcb83600f13faa">P_K65_NRGB</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a976d0683dbfa2225bf40016d151f70d3">P_K65_LUX</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#ae6a26ad33235021f82ada9c503e5661a">P_K65_RFIRE</a>))</td></tr>
<tr class="separator:ae2e07011a0423b4667ec133f8b9900f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3133fa57f7b2d7c888ffafeadc4476ab"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a3133fa57f7b2d7c888ffafeadc4476ab">P_K70</a>&#160;&#160;&#160;0x1b13</td></tr>
<tr class="separator:a3133fa57f7b2d7c888ffafeadc4476ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13dedd3d75cdf16040bf21b01e3330cc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a13dedd3d75cdf16040bf21b01e3330cc">P_K70_STR</a>&#160;&#160;&#160;&quot;1b13&quot;</td></tr>
<tr class="separator:a13dedd3d75cdf16040bf21b01e3330cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fea7ba58b4bb6a7def7c380ab695110"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a7fea7ba58b4bb6a7def7c380ab695110">P_K70_NRGB</a>&#160;&#160;&#160;0x1b09</td></tr>
<tr class="separator:a7fea7ba58b4bb6a7def7c380ab695110"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89947cd3ff1f3f098f5a64322d36964c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a89947cd3ff1f3f098f5a64322d36964c">P_K70_NRGB_STR</a>&#160;&#160;&#160;&quot;1b09&quot;</td></tr>
<tr class="separator:a89947cd3ff1f3f098f5a64322d36964c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fc42f14fec81381ff8251ca6a85b363"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a3fc42f14fec81381ff8251ca6a85b363">P_K70_LUX</a>&#160;&#160;&#160;0x1b33</td></tr>
<tr class="separator:a3fc42f14fec81381ff8251ca6a85b363"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a325a794b2e7b06929d5fb9010963fd3f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a325a794b2e7b06929d5fb9010963fd3f">P_K70_LUX_STR</a>&#160;&#160;&#160;&quot;1b33&quot;</td></tr>
<tr class="separator:a325a794b2e7b06929d5fb9010963fd3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0f89f20ca96ad159330a8d071a45352"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#aa0f89f20ca96ad159330a8d071a45352">P_K70_LUX_NRGB</a>&#160;&#160;&#160;0x1b36</td></tr>
<tr class="separator:aa0f89f20ca96ad159330a8d071a45352"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7015272c146f31745446a996c60d583c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a7015272c146f31745446a996c60d583c">P_K70_LUX_NRGB_STR</a>&#160;&#160;&#160;&quot;1b36&quot;</td></tr>
<tr class="separator:a7015272c146f31745446a996c60d583c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07e80868f8a95b9f8a2e85636833d45d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a07e80868f8a95b9f8a2e85636833d45d">P_K70_RFIRE</a>&#160;&#160;&#160;0x1b38</td></tr>
<tr class="separator:a07e80868f8a95b9f8a2e85636833d45d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad25e62c8bb5fdff82918c21a4f376d48"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ad25e62c8bb5fdff82918c21a4f376d48">P_K70_RFIRE_STR</a>&#160;&#160;&#160;&quot;1b38&quot;</td></tr>
<tr class="separator:ad25e62c8bb5fdff82918c21a4f376d48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb58ca12d172afdf2b5469266c0c9af8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#abb58ca12d172afdf2b5469266c0c9af8">P_K70_RFIRE_NRGB</a>&#160;&#160;&#160;0x1b3a</td></tr>
<tr class="separator:abb58ca12d172afdf2b5469266c0c9af8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b910905c1d5863c63d862e63f6e01aa"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a4b910905c1d5863c63d862e63f6e01aa">P_K70_RFIRE_NRGB_STR</a>&#160;&#160;&#160;&quot;1b3a&quot;</td></tr>
<tr class="separator:a4b910905c1d5863c63d862e63f6e01aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a370c092dd98743625b5a2fe4a30cd07f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a370c092dd98743625b5a2fe4a30cd07f">IS_K70</a>(kb)&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#a3133fa57f7b2d7c888ffafeadc4476ab">P_K70</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a7fea7ba58b4bb6a7def7c380ab695110">P_K70_NRGB</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a07e80868f8a95b9f8a2e85636833d45d">P_K70_RFIRE</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#abb58ca12d172afdf2b5469266c0c9af8">P_K70_RFIRE_NRGB</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a3fc42f14fec81381ff8251ca6a85b363">P_K70_LUX</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#aa0f89f20ca96ad159330a8d071a45352">P_K70_LUX_NRGB</a>))</td></tr>
<tr class="separator:a370c092dd98743625b5a2fe4a30cd07f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f5e9b029c7eec8f6c491d73f0499bb5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a5f5e9b029c7eec8f6c491d73f0499bb5">P_K95</a>&#160;&#160;&#160;0x1b11</td></tr>
<tr class="separator:a5f5e9b029c7eec8f6c491d73f0499bb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acae31fb041a4c3e8d202bb31a0f9969b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#acae31fb041a4c3e8d202bb31a0f9969b">P_K95_STR</a>&#160;&#160;&#160;&quot;1b11&quot;</td></tr>
<tr class="separator:acae31fb041a4c3e8d202bb31a0f9969b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8d1cf4b55023aae2b72ee607e214f84"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ae8d1cf4b55023aae2b72ee607e214f84">P_K95_NRGB</a>&#160;&#160;&#160;0x1b08</td></tr>
<tr class="separator:ae8d1cf4b55023aae2b72ee607e214f84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d081ee7bfcd59217ef49bc01b42dae7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a0d081ee7bfcd59217ef49bc01b42dae7">P_K95_NRGB_STR</a>&#160;&#160;&#160;&quot;1b08&quot;</td></tr>
<tr class="separator:a0d081ee7bfcd59217ef49bc01b42dae7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab034dbd57f7ab5666729ce7e27d3e0b9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ab034dbd57f7ab5666729ce7e27d3e0b9">P_K95_PLATINUM</a>&#160;&#160;&#160;0x1b2d</td></tr>
<tr class="separator:ab034dbd57f7ab5666729ce7e27d3e0b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a0b61c9e8124b0a0d86fd7a099e49d4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a4a0b61c9e8124b0a0d86fd7a099e49d4">P_K95_PLATINUM_STR</a>&#160;&#160;&#160;&quot;1b2d&quot;</td></tr>
<tr class="separator:a4a0b61c9e8124b0a0d86fd7a099e49d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af612b6b5e489ef9dd625458ba57af521"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#af612b6b5e489ef9dd625458ba57af521">IS_K95</a>(kb)&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#a5f5e9b029c7eec8f6c491d73f0499bb5">P_K95</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#ae8d1cf4b55023aae2b72ee607e214f84">P_K95_NRGB</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#ab034dbd57f7ab5666729ce7e27d3e0b9">P_K95_PLATINUM</a>))</td></tr>
<tr class="separator:af612b6b5e489ef9dd625458ba57af521"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26adb1ffc39cb46e583a236b14af9ace"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a26adb1ffc39cb46e583a236b14af9ace">P_STRAFE</a>&#160;&#160;&#160;0x1b20</td></tr>
<tr class="separator:a26adb1ffc39cb46e583a236b14af9ace"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d186f9f8f273b0bc614cf0232540f1a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a0d186f9f8f273b0bc614cf0232540f1a">P_STRAFE_STR</a>&#160;&#160;&#160;&quot;1b20&quot;</td></tr>
<tr class="separator:a0d186f9f8f273b0bc614cf0232540f1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e6f75a59f49265384d17e5d65b054e0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a3e6f75a59f49265384d17e5d65b054e0">P_STRAFE_NRGB</a>&#160;&#160;&#160;0x1b15</td></tr>
<tr class="separator:a3e6f75a59f49265384d17e5d65b054e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada53df20c5479953f8bc3247a9f17fdf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ada53df20c5479953f8bc3247a9f17fdf">P_STRAFE_NRGB_STR</a>&#160;&#160;&#160;&quot;1b15&quot;</td></tr>
<tr class="separator:ada53df20c5479953f8bc3247a9f17fdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a934f88a3315f982a29c851cd8293155f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a934f88a3315f982a29c851cd8293155f">IS_STRAFE</a>(kb)&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#a26adb1ffc39cb46e583a236b14af9ace">P_STRAFE</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a3e6f75a59f49265384d17e5d65b054e0">P_STRAFE_NRGB</a>))</td></tr>
<tr class="separator:a934f88a3315f982a29c851cd8293155f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26cd43fb89a7329b7043cb962a12383b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a26cd43fb89a7329b7043cb962a12383b">P_M65</a>&#160;&#160;&#160;0x1b12</td></tr>
<tr class="separator:a26cd43fb89a7329b7043cb962a12383b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af97629330c65c7e9d3e796b098496766"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#af97629330c65c7e9d3e796b098496766">P_M65_STR</a>&#160;&#160;&#160;&quot;1b12&quot;</td></tr>
<tr class="separator:af97629330c65c7e9d3e796b098496766"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a427ec77ae3e03646e7ac0a66516d39cb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a427ec77ae3e03646e7ac0a66516d39cb">P_M65_PRO</a>&#160;&#160;&#160;0x1b2e</td></tr>
<tr class="separator:a427ec77ae3e03646e7ac0a66516d39cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a721620c5d76259244098e17305d9cb2b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a721620c5d76259244098e17305d9cb2b">P_M65_PRO_STR</a>&#160;&#160;&#160;&quot;1b2e&quot;</td></tr>
<tr class="separator:a721620c5d76259244098e17305d9cb2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44b001c544766f8e216932d5bf9a34df"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a44b001c544766f8e216932d5bf9a34df">IS_M65</a>(kb)&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#a26cd43fb89a7329b7043cb962a12383b">P_M65</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a427ec77ae3e03646e7ac0a66516d39cb">P_M65_PRO</a>))</td></tr>
<tr class="separator:a44b001c544766f8e216932d5bf9a34df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0aa0f45f25df01bcee4abc96455e1138"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a0aa0f45f25df01bcee4abc96455e1138">P_SABRE_O</a>&#160;&#160;&#160;0x1b14  /* optical */</td></tr>
<tr class="separator:a0aa0f45f25df01bcee4abc96455e1138"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af88eeff90e15ec183cf4e041c53ee40b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#af88eeff90e15ec183cf4e041c53ee40b">P_SABRE_O_STR</a>&#160;&#160;&#160;&quot;1b14&quot;</td></tr>
<tr class="separator:af88eeff90e15ec183cf4e041c53ee40b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73e75008beef075e40fa5195d9c70bfe"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a73e75008beef075e40fa5195d9c70bfe">P_SABRE_L</a>&#160;&#160;&#160;0x1b19  /* laser */</td></tr>
<tr class="separator:a73e75008beef075e40fa5195d9c70bfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec47a7a2fe154b99305b835843bffa29"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#aec47a7a2fe154b99305b835843bffa29">P_SABRE_L_STR</a>&#160;&#160;&#160;&quot;1b19&quot;</td></tr>
<tr class="separator:aec47a7a2fe154b99305b835843bffa29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b8bcefef6848c2e7889ecda124c8192"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a5b8bcefef6848c2e7889ecda124c8192">P_SABRE_N</a>&#160;&#160;&#160;0x1b2f  /* new? */</td></tr>
<tr class="separator:a5b8bcefef6848c2e7889ecda124c8192"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac190fd16809d56ec78db173421097bcb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ac190fd16809d56ec78db173421097bcb">P_SABRE_N_STR</a>&#160;&#160;&#160;&quot;1b2f&quot;</td></tr>
<tr class="separator:ac190fd16809d56ec78db173421097bcb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a294da39a7f6b6d23ff74b170b9423b4e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a294da39a7f6b6d23ff74b170b9423b4e">P_SABRE_O2</a>&#160;&#160;&#160;0x1b32 /* Observed on a CH-9000111-EU model SABRE */</td></tr>
<tr class="separator:a294da39a7f6b6d23ff74b170b9423b4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a164b951b9f4aa4473c0780201447de2b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a164b951b9f4aa4473c0780201447de2b">P_SABRE_O2_STR</a>&#160;&#160;&#160;&quot;1b32&quot;</td></tr>
<tr class="separator:a164b951b9f4aa4473c0780201447de2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42deb465caa31f803a16306986cd6bbe"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a42deb465caa31f803a16306986cd6bbe">IS_SABRE</a>(kb)&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#a0aa0f45f25df01bcee4abc96455e1138">P_SABRE_O</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a73e75008beef075e40fa5195d9c70bfe">P_SABRE_L</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a5b8bcefef6848c2e7889ecda124c8192">P_SABRE_N</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a294da39a7f6b6d23ff74b170b9423b4e">P_SABRE_O2</a>))</td></tr>
<tr class="separator:a42deb465caa31f803a16306986cd6bbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8ce90b65c8c9756870acd26a24054fc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#af8ce90b65c8c9756870acd26a24054fc">P_SCIMITAR</a>&#160;&#160;&#160;0x1b1e</td></tr>
<tr class="separator:af8ce90b65c8c9756870acd26a24054fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ca8f2f007234fe5c79794bead6b74d0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a4ca8f2f007234fe5c79794bead6b74d0">P_SCIMITAR_STR</a>&#160;&#160;&#160;&quot;1b1e&quot;</td></tr>
<tr class="separator:a4ca8f2f007234fe5c79794bead6b74d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab76215820c9c39d5438ed28b4e8d8110"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ab76215820c9c39d5438ed28b4e8d8110">P_SCIMITAR_PRO</a>&#160;&#160;&#160;0x1b3e</td></tr>
<tr class="separator:ab76215820c9c39d5438ed28b4e8d8110"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67316b233c0f7fca0b77a70a0bbb9c81"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a67316b233c0f7fca0b77a70a0bbb9c81">P_SCIMITAR_PRO_STR</a>&#160;&#160;&#160;&quot;1b3e&quot;</td></tr>
<tr class="separator:a67316b233c0f7fca0b77a70a0bbb9c81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42d0504a482944df6fe7cbdb06c0851b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a42d0504a482944df6fe7cbdb06c0851b">IS_SCIMITAR</a>(kb)&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#af8ce90b65c8c9756870acd26a24054fc">P_SCIMITAR</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#ab76215820c9c39d5438ed28b4e8d8110">P_SCIMITAR_PRO</a>))</td></tr>
<tr class="separator:a42d0504a482944df6fe7cbdb06c0851b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8fdd4551fc9bedbcef101983ef0ef93"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ab8fdd4551fc9bedbcef101983ef0ef93">IS_RGB</a>(vendor, product)&#160;&#160;&#160;((vendor) == (<a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a>) &amp;&amp; (product) != (<a class="el" href="usb_8h.html#a300ce7bf9091c9da9ebcb83600f13faa">P_K65_NRGB</a>) &amp;&amp; (product) != (<a class="el" href="usb_8h.html#a7fea7ba58b4bb6a7def7c380ab695110">P_K70_NRGB</a>) &amp;&amp; (product) != (<a class="el" href="usb_8h.html#ae8d1cf4b55023aae2b72ee607e214f84">P_K95_NRGB</a>))</td></tr>
<tr class="memdesc:ab8fdd4551fc9bedbcef101983ef0ef93"><td class="mdescLeft">&#160;</td><td class="mdescRight">RGB vs non-RGB test (note: non-RGB Strafe is still considered "RGB" in that it shares the same protocol. The difference is denoted with the "monochrome" feature).  <a href="#ab8fdd4551fc9bedbcef101983ef0ef93">More...</a><br/></td></tr>
<tr class="separator:ab8fdd4551fc9bedbcef101983ef0ef93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9b83f9844f5498d707b7ac7ebf37933"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ae9b83f9844f5498d707b7ac7ebf37933">IS_MONOCHROME</a>(vendor, product)&#160;&#160;&#160;((vendor) == (<a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a>) &amp;&amp; (product) == (<a class="el" href="usb_8h.html#a3e6f75a59f49265384d17e5d65b054e0">P_STRAFE_NRGB</a>))</td></tr>
<tr class="memdesc:ae9b83f9844f5498d707b7ac7ebf37933"><td class="mdescLeft">&#160;</td><td class="mdescRight">The difference between non RGB and monochrome is, that monochrome has lights, but just in one color. nonRGB has no lights. Change this if new <b>monochrome</b> devices are added.  <a href="#ae9b83f9844f5498d707b7ac7ebf37933">More...</a><br/></td></tr>
<tr class="separator:ae9b83f9844f5498d707b7ac7ebf37933"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad52d5bb523bfdb33da00fba52d95f7c1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ad52d5bb523bfdb33da00fba52d95f7c1">IS_RGB_DEV</a>(kb)&#160;&#160;&#160;<a class="el" href="usb_8h.html#ab8fdd4551fc9bedbcef101983ef0ef93">IS_RGB</a>((kb)-&gt;vendor, (kb)-&gt;product)</td></tr>
<tr class="memdesc:ad52d5bb523bfdb33da00fba52d95f7c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">For calling with a usbdevice*, vendor and product are extracted and <a class="el" href="usb_8h.html#ab8fdd4551fc9bedbcef101983ef0ef93" title="RGB vs non-RGB test (note: non-RGB Strafe is still considered &quot;RGB&quot; in that it shares the same protoc...">IS_RGB()</a> is returned.  <a href="#ad52d5bb523bfdb33da00fba52d95f7c1">More...</a><br/></td></tr>
<tr class="separator:ad52d5bb523bfdb33da00fba52d95f7c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6a318e53d5738f518114c9b87a59905"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#af6a318e53d5738f518114c9b87a59905">IS_MONOCHROME_DEV</a>(kb)&#160;&#160;&#160;<a class="el" href="usb_8h.html#ae9b83f9844f5498d707b7ac7ebf37933">IS_MONOCHROME</a>((kb)-&gt;vendor, (kb)-&gt;product)</td></tr>
<tr class="memdesc:af6a318e53d5738f518114c9b87a59905"><td class="mdescLeft">&#160;</td><td class="mdescRight">For calling with a usbdevice*, vendor and product are extracted and <a class="el" href="usb_8h.html#ae9b83f9844f5498d707b7ac7ebf37933" title="The difference between non RGB and monochrome is, that monochrome has lights, but just in one color...">IS_MONOCHROME()</a> is returned.  <a href="#af6a318e53d5738f518114c9b87a59905">More...</a><br/></td></tr>
<tr class="separator:af6a318e53d5738f518114c9b87a59905"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1509021d1156508bfd4c6c570987041"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ad1509021d1156508bfd4c6c570987041">IS_FULLRANGE</a>(kb)&#160;&#160;&#160;(<a class="el" href="usb_8h.html#ab8fdd4551fc9bedbcef101983ef0ef93">IS_RGB</a>((kb)-&gt;vendor, (kb)-&gt;product) &amp;&amp; (kb)-&gt;product != <a class="el" href="usb_8h.html#affc75c5e028c467b9a294360b8a66a17">P_K65</a> &amp;&amp; (kb)-&gt;product != <a class="el" href="usb_8h.html#a3133fa57f7b2d7c888ffafeadc4476ab">P_K70</a> &amp;&amp; (kb)-&gt;product != <a class="el" href="usb_8h.html#a5f5e9b029c7eec8f6c491d73f0499bb5">P_K95</a>)</td></tr>
<tr class="memdesc:ad1509021d1156508bfd4c6c570987041"><td class="mdescLeft">&#160;</td><td class="mdescRight">Full color range (16.8M) vs partial color range (512)  <a href="#ad1509021d1156508bfd4c6c570987041">More...</a><br/></td></tr>
<tr class="separator:ad1509021d1156508bfd4c6c570987041"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9aa1b86ddc13dc886bb403fda7c72ee7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a9aa1b86ddc13dc886bb403fda7c72ee7">IS_MOUSE</a>(vendor, product)&#160;&#160;&#160;((vendor) == (<a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a>) &amp;&amp; ((product) == (<a class="el" href="usb_8h.html#a26cd43fb89a7329b7043cb962a12383b">P_M65</a>) || (product) == (<a class="el" href="usb_8h.html#a427ec77ae3e03646e7ac0a66516d39cb">P_M65_PRO</a>) || (product) == (<a class="el" href="usb_8h.html#a0aa0f45f25df01bcee4abc96455e1138">P_SABRE_O</a>) || (product) == (<a class="el" href="usb_8h.html#a73e75008beef075e40fa5195d9c70bfe">P_SABRE_L</a>) || (product) == (<a class="el" href="usb_8h.html#a5b8bcefef6848c2e7889ecda124c8192">P_SABRE_N</a>) || (product) == (<a class="el" href="usb_8h.html#af8ce90b65c8c9756870acd26a24054fc">P_SCIMITAR</a>) || (product) == (<a class="el" href="usb_8h.html#ab76215820c9c39d5438ed28b4e8d8110">P_SCIMITAR_PRO</a>) || (product) == (<a class="el" href="usb_8h.html#a294da39a7f6b6d23ff74b170b9423b4e">P_SABRE_O2</a>)))</td></tr>
<tr class="memdesc:a9aa1b86ddc13dc886bb403fda7c72ee7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mouse vs keyboard test.  <a href="#a9aa1b86ddc13dc886bb403fda7c72ee7">More...</a><br/></td></tr>
<tr class="separator:a9aa1b86ddc13dc886bb403fda7c72ee7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e24dcd96662e477474671d345a84414"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a0e24dcd96662e477474671d345a84414">IS_MOUSE_DEV</a>(kb)&#160;&#160;&#160;<a class="el" href="usb_8h.html#a9aa1b86ddc13dc886bb403fda7c72ee7">IS_MOUSE</a>((kb)-&gt;vendor, (kb)-&gt;product)</td></tr>
<tr class="memdesc:a0e24dcd96662e477474671d345a84414"><td class="mdescLeft">&#160;</td><td class="mdescRight">For calling with a usbdevice*, vendor and product are extracted and <a class="el" href="usb_8h.html#a9aa1b86ddc13dc886bb403fda7c72ee7" title="Mouse vs keyboard test. ">IS_MOUSE()</a> is returned.  <a href="#a0e24dcd96662e477474671d345a84414">More...</a><br/></td></tr>
<tr class="separator:a0e24dcd96662e477474671d345a84414"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73130b0fe3277a0fd9481eceb4f0e483"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a73130b0fe3277a0fd9481eceb4f0e483">DELAY_SHORT</a>(kb)&#160;&#160;&#160;usleep((int)(kb)-&gt;usbdelay * 1000)</td></tr>
<tr class="memdesc:a73130b0fe3277a0fd9481eceb4f0e483"><td class="mdescLeft">&#160;</td><td class="mdescRight">USB delays for when the keyboards get picky about timing That was the original comment, but it is used anytime. The short delay is used before any send or receive.  <a href="#a73130b0fe3277a0fd9481eceb4f0e483">More...</a><br/></td></tr>
<tr class="separator:a73130b0fe3277a0fd9481eceb4f0e483"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff3be8eafb827438a28c97b8f9d2ddcc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#aff3be8eafb827438a28c97b8f9d2ddcc">DELAY_MEDIUM</a>(kb)&#160;&#160;&#160;usleep((int)(kb)-&gt;usbdelay * 10000)</td></tr>
<tr class="memdesc:aff3be8eafb827438a28c97b8f9d2ddcc"><td class="mdescLeft">&#160;</td><td class="mdescRight">the medium delay is used after sending a command before waiting for the answer.  <a href="#aff3be8eafb827438a28c97b8f9d2ddcc">More...</a><br/></td></tr>
<tr class="separator:aff3be8eafb827438a28c97b8f9d2ddcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8de6458e3d59d88350ef3e73359c3526"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a8de6458e3d59d88350ef3e73359c3526">DELAY_LONG</a>(kb)&#160;&#160;&#160;usleep(100000)</td></tr>
<tr class="memdesc:a8de6458e3d59d88350ef3e73359c3526"><td class="mdescLeft">&#160;</td><td class="mdescRight">The longest delay takes place where something went wrong (eg when resetting the device)  <a href="#a8de6458e3d59d88350ef3e73359c3526">More...</a><br/></td></tr>
<tr class="separator:a8de6458e3d59d88350ef3e73359c3526"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a099563afe2cc26cafb14b788b03d218e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a099563afe2cc26cafb14b788b03d218e">USB_DELAY_DEFAULT</a>&#160;&#160;&#160;5</td></tr>
<tr class="memdesc:a099563afe2cc26cafb14b788b03d218e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This constant is used to initialize <b>kb-&gt;usbdelay</b>. It is used in many places (see macros above) but often also overwritten to the fixed value of 10. Pure Hacker code.  <a href="#a099563afe2cc26cafb14b788b03d218e">More...</a><br/></td></tr>
<tr class="separator:a099563afe2cc26cafb14b788b03d218e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1550dc55de346b46df8c4b6930613e9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ae1550dc55de346b46df8c4b6930613e9">resetusb</a>(kb)&#160;&#160;&#160;<a class="el" href="usb_8h.html#a9ea008b77417f82b177117dce9a50b48">_resetusb</a>(kb, <a class="el" href="includes_8h.html#aa8cd384afa0df6560f5924e9b321651f">__FILE_NOPATH__</a>, __LINE__)</td></tr>
<tr class="memdesc:ae1550dc55de346b46df8c4b6930613e9"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="usb_8h.html#ae1550dc55de346b46df8c4b6930613e9" title="resetusb() is just a macro to call _resetusb() with debuggin constants (file, lineno) ...">resetusb()</a> is just a macro to call <a class="el" href="usb_8h.html#a9ea008b77417f82b177117dce9a50b48" title="_resetusb Reset a USB device. ">_resetusb()</a> with debuggin constants (file, lineno)  <a href="#ae1550dc55de346b46df8c4b6930613e9">More...</a><br/></td></tr>
<tr class="separator:ae1550dc55de346b46df8c4b6930613e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5eaa2b8ffe9e62747454c74b19876819"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a5eaa2b8ffe9e62747454c74b19876819">usbsend</a>(kb, messages, count)&#160;&#160;&#160;<a class="el" href="usb_8h.html#a992cce1d173047466101113bfff5d7a1">_usbsend</a>(kb, messages, count, <a class="el" href="includes_8h.html#aa8cd384afa0df6560f5924e9b321651f">__FILE_NOPATH__</a>, __LINE__)</td></tr>
<tr class="memdesc:a5eaa2b8ffe9e62747454c74b19876819"><td class="mdescLeft">&#160;</td><td class="mdescRight">usbsend macro is used to wrap <a class="el" href="usb_8h.html#a992cce1d173047466101113bfff5d7a1" title="_usbsend send a logical message completely to the given device ">_usbsend()</a> with debugging information (file and lineno)  <a href="#a5eaa2b8ffe9e62747454c74b19876819">More...</a><br/></td></tr>
<tr class="separator:a5eaa2b8ffe9e62747454c74b19876819"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80241296ff114704b355cd6081d2ff2e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a80241296ff114704b355cd6081d2ff2e">usbrecv</a>(kb, out_msg, in_msg)&#160;&#160;&#160;<a class="el" href="usb_8h.html#a5a548f93d4c1c56910b840cebe88d0c2">_usbrecv</a>(kb, out_msg, in_msg, <a class="el" href="includes_8h.html#aa8cd384afa0df6560f5924e9b321651f">__FILE_NOPATH__</a>, __LINE__)</td></tr>
<tr class="memdesc:a80241296ff114704b355cd6081d2ff2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">usbrecv macro is used to wrap <a class="el" href="usb_8h.html#a5a548f93d4c1c56910b840cebe88d0c2" title="_usbrecv Request data from a USB device by first sending an output packet and then reading the respon...">_usbrecv()</a> with debugging information (file and lineno)  <a href="#a80241296ff114704b355cd6081d2ff2e">More...</a><br/></td></tr>
<tr class="separator:a80241296ff114704b355cd6081d2ff2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefc95e6120686dff0e06bba32ca21ad1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#aefc95e6120686dff0e06bba32ca21ad1">nk95cmd</a>(kb, command)&#160;&#160;&#160;<a class="el" href="usb__linux_8c.html#a3da2cab9cd88ea517d39888fe2159734">_nk95cmd</a>(kb, (command) &gt;&gt; 16 &amp; 0xFF, (command) &amp; 0xFFFF, __FILE_NOPATH__, __LINE__)</td></tr>
<tr class="memdesc:aefc95e6120686dff0e06bba32ca21ad1"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="usb_8h.html#aefc95e6120686dff0e06bba32ca21ad1" title="nk95cmd() macro is used to wrap _nk95cmd() with debugging information (file and lineno). the command structure is different:   Just the bits 23..16 are used as bits 7..0 for bRequest   Bits 15..0 are used as wValue ">nk95cmd()</a> macro is used to wrap <a class="el" href="usb_8h.html#a3da2cab9cd88ea517d39888fe2159734" title="_nk95cmd If we control a non RGB keyboard, set the keyboard via ioctl with usbdevfs_ctrltransfer ...">_nk95cmd()</a> with debugging information (file and lineno). the command structure is different: <br/>
 Just the bits 23..16 are used as bits 7..0 for bRequest <br/>
 Bits 15..0 are used as wValue  <a href="#aefc95e6120686dff0e06bba32ca21ad1">More...</a><br/></td></tr>
<tr class="separator:aefc95e6120686dff0e06bba32ca21ad1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9078f1b51a13f9710904c08826d57097"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a9078f1b51a13f9710904c08826d57097">NK95_HWOFF</a>&#160;&#160;&#160;0x020030</td></tr>
<tr class="memdesc:a9078f1b51a13f9710904c08826d57097"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hardware-specific commands for the K95 nonRGB,.  <a href="#a9078f1b51a13f9710904c08826d57097">More...</a><br/></td></tr>
<tr class="separator:a9078f1b51a13f9710904c08826d57097"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4d21ffe463251f15ed249be2531d8c7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#af4d21ffe463251f15ed249be2531d8c7">NK95_HWON</a>&#160;&#160;&#160;0x020001</td></tr>
<tr class="memdesc:af4d21ffe463251f15ed249be2531d8c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hardware playback on.  <a href="#af4d21ffe463251f15ed249be2531d8c7">More...</a><br/></td></tr>
<tr class="separator:af4d21ffe463251f15ed249be2531d8c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7897e304126f1b024206ea3001d377d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ae7897e304126f1b024206ea3001d377d">NK95_M1</a>&#160;&#160;&#160;0x140001</td></tr>
<tr class="memdesc:ae7897e304126f1b024206ea3001d377d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Switch to mode 1.  <a href="#ae7897e304126f1b024206ea3001d377d">More...</a><br/></td></tr>
<tr class="separator:ae7897e304126f1b024206ea3001d377d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87e33091f2020d26471856c43195d970"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a87e33091f2020d26471856c43195d970">NK95_M2</a>&#160;&#160;&#160;0x140002</td></tr>
<tr class="memdesc:a87e33091f2020d26471856c43195d970"><td class="mdescLeft">&#160;</td><td class="mdescRight">Switch to mode 2.  <a href="#a87e33091f2020d26471856c43195d970">More...</a><br/></td></tr>
<tr class="separator:a87e33091f2020d26471856c43195d970"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa072888ddb1a257e739edb3655500bc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#aaa072888ddb1a257e739edb3655500bc">NK95_M3</a>&#160;&#160;&#160;0x140003</td></tr>
<tr class="memdesc:aaa072888ddb1a257e739edb3655500bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Switch to mode 3.  <a href="#aaa072888ddb1a257e739edb3655500bc">More...</a><br/></td></tr>
<tr class="separator:aaa072888ddb1a257e739edb3655500bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8e6389e8183a834fedb6ed317dd26f94"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a8e6389e8183a834fedb6ed317dd26f94">vendor_str</a> (short vendor)</td></tr>
<tr class="memdesc:a8e6389e8183a834fedb6ed317dd26f94"><td class="mdescLeft">&#160;</td><td class="mdescRight">uncomment the following Define to see USB packets sent to the device  <a href="#a8e6389e8183a834fedb6ed317dd26f94">More...</a><br/></td></tr>
<tr class="separator:a8e6389e8183a834fedb6ed317dd26f94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af87f830e031d8f63d2d1c3fc14fdad20"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#af87f830e031d8f63d2d1c3fc14fdad20">product_str</a> (short product)</td></tr>
<tr class="memdesc:af87f830e031d8f63d2d1c3fc14fdad20"><td class="mdescLeft">&#160;</td><td class="mdescRight">product_str returns a condensed view on what type of device we have.  <a href="#af87f830e031d8f63d2d1c3fc14fdad20">More...</a><br/></td></tr>
<tr class="separator:af87f830e031d8f63d2d1c3fc14fdad20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0859efad3739abe2ec61af4f3bb983ff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a0859efad3739abe2ec61af4f3bb983ff">usbmain</a> ()</td></tr>
<tr class="memdesc:a0859efad3739abe2ec61af4f3bb983ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the USB main loop. Returns program exit code when finished.  <a href="#a0859efad3739abe2ec61af4f3bb983ff">More...</a><br/></td></tr>
<tr class="separator:a0859efad3739abe2ec61af4f3bb983ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41aa3e13beb593c91a5410200b4dd8d2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a41aa3e13beb593c91a5410200b4dd8d2">usbkill</a> ()</td></tr>
<tr class="memdesc:a41aa3e13beb593c91a5410200b4dd8d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop the USB system.  <a href="#a41aa3e13beb593c91a5410200b4dd8d2">More...</a><br/></td></tr>
<tr class="separator:a41aa3e13beb593c91a5410200b4dd8d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ab9d61dd894466125283465201161cd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a1ab9d61dd894466125283465201161cd">setupusb</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb)</td></tr>
<tr class="memdesc:a1ab9d61dd894466125283465201161cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">setupusb starts a thread with kb as parameter and <a class="el" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . ">_setupusb()</a> as entrypoint.  <a href="#a1ab9d61dd894466125283465201161cd">More...</a><br/></td></tr>
<tr class="separator:a1ab9d61dd894466125283465201161cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39442715182933b93172de60cdb66e8f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a39442715182933b93172de60cdb66e8f">os_setupusb</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb)</td></tr>
<tr class="memdesc:a39442715182933b93172de60cdb66e8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">os_setupusb OS-specific setup for a specific usb device.  <a href="#a39442715182933b93172de60cdb66e8f">More...</a><br/></td></tr>
<tr class="separator:a39442715182933b93172de60cdb66e8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e5784bfca2e4612f498ce67c7dab275"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a9e5784bfca2e4612f498ce67c7dab275">os_inputmain</a> (void *context)</td></tr>
<tr class="memdesc:a9e5784bfca2e4612f498ce67c7dab275"><td class="mdescLeft">&#160;</td><td class="mdescRight">os_inputmain is run in a separate thread and will be detached from the main thread, so it needs to clean up its own resources.  <a href="#a9e5784bfca2e4612f498ce67c7dab275">More...</a><br/></td></tr>
<tr class="separator:a9e5784bfca2e4612f498ce67c7dab275"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae30a52968bb209e98461f48ffb2ee82f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#ae30a52968bb209e98461f48ffb2ee82f">revertusb</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb)</td></tr>
<tr class="memdesc:ae30a52968bb209e98461f48ffb2ee82f"><td class="mdescLeft">&#160;</td><td class="mdescRight">revertusb sets a given device to inactive (hardware controlled) mode if not a fw-ugrade is indicated  <a href="#ae30a52968bb209e98461f48ffb2ee82f">More...</a><br/></td></tr>
<tr class="separator:ae30a52968bb209e98461f48ffb2ee82f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8732b3ade76da4ae362996232ef95431"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a8732b3ade76da4ae362996232ef95431">closeusb</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb)</td></tr>
<tr class="memdesc:a8732b3ade76da4ae362996232ef95431"><td class="mdescLeft">&#160;</td><td class="mdescRight">closeusb Close a USB device and remove device entry.  <a href="#a8732b3ade76da4ae362996232ef95431">More...</a><br/></td></tr>
<tr class="separator:a8732b3ade76da4ae362996232ef95431"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a62575e9073fae15efb58f24fbfe5b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a6a62575e9073fae15efb58f24fbfe5b8">os_closeusb</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb)</td></tr>
<tr class="memdesc:a6a62575e9073fae15efb58f24fbfe5b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">os_closeusb unclaim it, destroy the udev device and clear data structures at kb  <a href="#a6a62575e9073fae15efb58f24fbfe5b8">More...</a><br/></td></tr>
<tr class="separator:a6a62575e9073fae15efb58f24fbfe5b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ea008b77417f82b177117dce9a50b48"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a9ea008b77417f82b177117dce9a50b48">_resetusb</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, const char *file, int line)</td></tr>
<tr class="memdesc:a9ea008b77417f82b177117dce9a50b48"><td class="mdescLeft">&#160;</td><td class="mdescRight">_resetusb Reset a USB device.  <a href="#a9ea008b77417f82b177117dce9a50b48">More...</a><br/></td></tr>
<tr class="separator:a9ea008b77417f82b177117dce9a50b48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fd9533617cdae390dc65aa4594e33d2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a0fd9533617cdae390dc65aa4594e33d2">os_resetusb</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, const char *file, int line)</td></tr>
<tr class="memdesc:a0fd9533617cdae390dc65aa4594e33d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">os_resetusb is the os specific implementation for resetting usb  <a href="#a0fd9533617cdae390dc65aa4594e33d2">More...</a><br/></td></tr>
<tr class="separator:a0fd9533617cdae390dc65aa4594e33d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a992cce1d173047466101113bfff5d7a1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a992cce1d173047466101113bfff5d7a1">_usbsend</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, const <a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *messages, int count, const char *file, int line)</td></tr>
<tr class="memdesc:a992cce1d173047466101113bfff5d7a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">_usbsend send a logical message completely to the given device  <a href="#a992cce1d173047466101113bfff5d7a1">More...</a><br/></td></tr>
<tr class="separator:a992cce1d173047466101113bfff5d7a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a548f93d4c1c56910b840cebe88d0c2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a5a548f93d4c1c56910b840cebe88d0c2">_usbrecv</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, const <a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *out_msg, <a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *in_msg, const char *file, int line)</td></tr>
<tr class="memdesc:a5a548f93d4c1c56910b840cebe88d0c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">_usbrecv Request data from a USB device by first sending an output packet and then reading the response.  <a href="#a5a548f93d4c1c56910b840cebe88d0c2">More...</a><br/></td></tr>
<tr class="separator:a5a548f93d4c1c56910b840cebe88d0c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e813287cd0ee9c7b665002a929d2894"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894">os_usbsend</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, const <a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *out_msg, int is_recv, const char *file, int line)</td></tr>
<tr class="memdesc:a9e813287cd0ee9c7b665002a929d2894"><td class="mdescLeft">&#160;</td><td class="mdescRight">os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long  <a href="#a9e813287cd0ee9c7b665002a929d2894">More...</a><br/></td></tr>
<tr class="separator:a9e813287cd0ee9c7b665002a929d2894"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5694446920cfae8c887163847312a8f8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a5694446920cfae8c887163847312a8f8">os_usbrecv</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, <a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *in_msg, const char *file, int line)</td></tr>
<tr class="memdesc:a5694446920cfae8c887163847312a8f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">os_usbrecv receives a max MSGSIZE long buffer from usb device  <a href="#a5694446920cfae8c887163847312a8f8">More...</a><br/></td></tr>
<tr class="separator:a5694446920cfae8c887163847312a8f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa51c505c8f442f49ea2d712c61faea2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#afa51c505c8f442f49ea2d712c61faea2">os_sendindicators</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb)</td></tr>
<tr class="memdesc:afa51c505c8f442f49ea2d712c61faea2"><td class="mdescLeft">&#160;</td><td class="mdescRight">os_sendindicators update the indicators for the special keys (Numlock, Capslock and what else?)  <a href="#afa51c505c8f442f49ea2d712c61faea2">More...</a><br/></td></tr>
<tr class="separator:afa51c505c8f442f49ea2d712c61faea2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3da2cab9cd88ea517d39888fe2159734"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a3da2cab9cd88ea517d39888fe2159734">_nk95cmd</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb, <a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> bRequest, <a class="el" href="includes_8h.html#ab95f123a6c9bcfee6a343170ef8c5f69">ushort</a> wValue, const char *file, int line)</td></tr>
<tr class="memdesc:a3da2cab9cd88ea517d39888fe2159734"><td class="mdescLeft">&#160;</td><td class="mdescRight">_nk95cmd If we control a non RGB keyboard, set the keyboard via ioctl with usbdevfs_ctrltransfer  <a href="#a3da2cab9cd88ea517d39888fe2159734">More...</a><br/></td></tr>
<tr class="separator:a3da2cab9cd88ea517d39888fe2159734"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a1c88df5e127732cb63f1a8be180926"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_8h.html#a8a1c88df5e127732cb63f1a8be180926">usb_tryreset</a> (<a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *kb)</td></tr>
<tr class="memdesc:a8a1c88df5e127732cb63f1a8be180926"><td class="mdescLeft">&#160;</td><td class="mdescRight">usb_tryreset does what the name means: Try to reset the usb via <a class="el" href="usb_8h.html#ae1550dc55de346b46df8c4b6930613e9" title="resetusb() is just a macro to call _resetusb() with debuggin constants (file, lineno) ...">resetusb()</a>  <a href="#a8a1c88df5e127732cb63f1a8be180926">More...</a><br/></td></tr>
<tr class="separator:a8a1c88df5e127732cb63f1a8be180926"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Vendor/product codes</p>
<p>The list of defines in the first part of the file describes the various types of equipment from Corsair and summarizes them according to specific characteristics. <br/>
 Each device type is described with two defines:</p>
<ul>
<li>On the one hand the device ID with which the device can be recognized on the USB as a short</li>
<li>and on the other hand the same representation as a string, but without leading "0x".</li>
</ul>
<p>First entry-pair is the Provider ID (vendorID) from Corsair.</p>
<table class="doxtable">
<tr>
<th>Block No. </th><th>contains </th><th>Devices are bundled via  </th></tr>
<tr>
<td>1 </td><td>The first block contains the K65-like keyboards, regardless of their properties (RGB, ...). </td><td>In summary, they can be queried using the macro <a class="el" href="usb_8h.html#ae2e07011a0423b4667ec133f8b9900f8">IS_K65()</a>. </td></tr>
<tr>
<td>2 </td><td>the K70-like Keyboards with all their configuration types </td><td>summarized by <a class="el" href="usb_8h.html#a370c092dd98743625b5a2fe4a30cd07f">IS_K70()</a>. </td></tr>
<tr>
<td>3 </td><td>the K95 series keyboards </td><td>collected with the macro <a class="el" href="usb_8h.html#af612b6b5e489ef9dd625458ba57af521">IS_K95()</a>. </td></tr>
<tr>
<td>4 </td><td>strafe keyboards </td><td><a class="el" href="usb_8h.html#a934f88a3315f982a29c851cd8293155f">IS_STRAFE()</a> </td></tr>
<tr>
<td>5 </td><td>M65 mice with and without RGB </td><td><a class="el" href="usb_8h.html#a44b001c544766f8e216932d5bf9a34df">IS_M65()</a> </td></tr>
<tr>
<td>6 </td><td>The SABRE and HARPOON mice.<br/>
 Maybe this will be divided int two different blocks later because of different nummber of special keys </td><td><a class="el" href="usb_8h.html#a42deb465caa31f803a16306986cd6bbe">IS_SABRE()</a> </td></tr>
<tr>
<td>7 </td><td>The Scimitar mouse devices </td><td><a class="el" href="usb_8h.html#a42d0504a482944df6fe7cbdb06c0851b">IS_SCIMITAR()</a> </td></tr>
</table>

<p>Definition in file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a8de6458e3d59d88350ef3e73359c3526"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DELAY_LONG</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;usleep(100000)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00153">153</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00426">_resetusb()</a>, <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>, <a class="el" href="usb_8c_source.html#l00601">_usbrecv()</a>, <a class="el" href="usb_8c_source.html#l00532">_usbsend()</a>, <a class="el" href="profile__keyboard_8c_source.html#l00016">cmd_hwload_kb()</a>, <a class="el" href="profile__mouse_8c_source.html#l00006">cmd_hwload_mouse()</a>, <a class="el" href="profile__keyboard_8c_source.html#l00057">cmd_hwsave_kb()</a>, and <a class="el" href="profile__mouse_8c_source.html#l00050">cmd_hwsave_mouse()</a>.</p>

</div>
</div>
<a class="anchor" id="aff3be8eafb827438a28c97b8f9d2ddcc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DELAY_MEDIUM</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;usleep((int)(kb)-&gt;usbdelay * 10000)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00150">150</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00601">_usbrecv()</a>, and <a class="el" href="device__keyboard_8c_source.html#l00018">setactive_kb()</a>.</p>

</div>
</div>
<a class="anchor" id="a73130b0fe3277a0fd9481eceb4f0e483"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DELAY_SHORT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;usleep((int)(kb)-&gt;usbdelay * 1000)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00147">147</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00601">_usbrecv()</a>, <a class="el" href="usb_8c_source.html#l00532">_usbsend()</a>, and <a class="el" href="input_8c_source.html#l00152">updateindicators_kb()</a>.</p>

</div>
</div>
<a class="anchor" id="ad1509021d1156508bfd4c6c570987041"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_FULLRANGE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;(<a class="el" href="usb_8h.html#ab8fdd4551fc9bedbcef101983ef0ef93">IS_RGB</a>((kb)-&gt;vendor, (kb)-&gt;product) &amp;&amp; (kb)-&gt;product != <a class="el" href="usb_8h.html#affc75c5e028c467b9a294360b8a66a17">P_K65</a> &amp;&amp; (kb)-&gt;product != <a class="el" href="usb_8h.html#a3133fa57f7b2d7c888ffafeadc4476ab">P_K70</a> &amp;&amp; (kb)-&gt;product != <a class="el" href="usb_8h.html#a5f5e9b029c7eec8f6c491d73f0499bb5">P_K95</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00136">136</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="command_8c_source.html#l00067">readcmd()</a>, and <a class="el" href="led__keyboard_8c_source.html#l00077">updatergb_kb()</a>.</p>

</div>
</div>
<a class="anchor" id="ae2e07011a0423b4667ec133f8b9900f8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_K65</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#affc75c5e028c467b9a294360b8a66a17">P_K65</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a300ce7bf9091c9da9ebcb83600f13faa">P_K65_NRGB</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a976d0683dbfa2225bf40016d151f70d3">P_K65_LUX</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#ae6a26ad33235021f82ada9c503e5661a">P_K65_RFIRE</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00049">49</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="led_8c_source.html#l00073">has_key()</a>.</p>

</div>
</div>
<a class="anchor" id="a370c092dd98743625b5a2fe4a30cd07f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_K70</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#a3133fa57f7b2d7c888ffafeadc4476ab">P_K70</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a7fea7ba58b4bb6a7def7c380ab695110">P_K70_NRGB</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a07e80868f8a95b9f8a2e85636833d45d">P_K70_RFIRE</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#abb58ca12d172afdf2b5469266c0c9af8">P_K70_RFIRE_NRGB</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a3fc42f14fec81381ff8251ca6a85b363">P_K70_LUX</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#aa0f89f20ca96ad159330a8d071a45352">P_K70_LUX_NRGB</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00063">63</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="af612b6b5e489ef9dd625458ba57af521"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_K95</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#a5f5e9b029c7eec8f6c491d73f0499bb5">P_K95</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#ae8d1cf4b55023aae2b72ee607e214f84">P_K95_NRGB</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#ab034dbd57f7ab5666729ce7e27d3e0b9">P_K95_PLATINUM</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00071">71</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="profile__keyboard_8c_source.html#l00016">cmd_hwload_kb()</a>, <a class="el" href="profile__keyboard_8c_source.html#l00057">cmd_hwsave_kb()</a>, and <a class="el" href="led_8c_source.html#l00073">has_key()</a>.</p>

</div>
</div>
<a class="anchor" id="a44b001c544766f8e216932d5bf9a34df"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_M65</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#a26cd43fb89a7329b7043cb962a12383b">P_M65</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a427ec77ae3e03646e7ac0a66516d39cb">P_M65_PRO</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00083">83</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="led__mouse_8c_source.html#l00013">isblack()</a>.</p>

</div>
</div>
<a class="anchor" id="ae9b83f9844f5498d707b7ac7ebf37933"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_MONOCHROME</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">vendor, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">product&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;((vendor) == (<a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a>) &amp;&amp; (product) == (<a class="el" href="usb_8h.html#a3e6f75a59f49265384d17e5d65b054e0">P_STRAFE_NRGB</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00127">127</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>.</p>

</div>
</div>
<a class="anchor" id="af6a318e53d5738f518114c9b87a59905"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_MONOCHROME_DEV</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="usb_8h.html#ae9b83f9844f5498d707b7ac7ebf37933">IS_MONOCHROME</a>((kb)-&gt;vendor, (kb)-&gt;product)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00133">133</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9aa1b86ddc13dc886bb403fda7c72ee7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_MOUSE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">vendor, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">product&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;((vendor) == (<a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a>) &amp;&amp; ((product) == (<a class="el" href="usb_8h.html#a26cd43fb89a7329b7043cb962a12383b">P_M65</a>) || (product) == (<a class="el" href="usb_8h.html#a427ec77ae3e03646e7ac0a66516d39cb">P_M65_PRO</a>) || (product) == (<a class="el" href="usb_8h.html#a0aa0f45f25df01bcee4abc96455e1138">P_SABRE_O</a>) || (product) == (<a class="el" href="usb_8h.html#a73e75008beef075e40fa5195d9c70bfe">P_SABRE_L</a>) || (product) == (<a class="el" href="usb_8h.html#a5b8bcefef6848c2e7889ecda124c8192">P_SABRE_N</a>) || (product) == (<a class="el" href="usb_8h.html#af8ce90b65c8c9756870acd26a24054fc">P_SCIMITAR</a>) || (product) == (<a class="el" href="usb_8h.html#ab76215820c9c39d5438ed28b4e8d8110">P_SCIMITAR_PRO</a>) || (product) == (<a class="el" href="usb_8h.html#a294da39a7f6b6d23ff74b170b9423b4e">P_SABRE_O2</a>)))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00139">139</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>, <a class="el" href="usb_8c_source.html#l00102">get_vtable()</a>, <a class="el" href="led_8c_source.html#l00073">has_key()</a>, and <a class="el" href="usb__linux_8c_source.html#l00234">os_inputmain()</a>.</p>

</div>
</div>
<a class="anchor" id="a0e24dcd96662e477474671d345a84414"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_MOUSE_DEV</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="usb_8h.html#a9aa1b86ddc13dc886bb403fda7c72ee7">IS_MOUSE</a>((kb)-&gt;vendor, (kb)-&gt;product)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00142">142</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="command_8c_source.html#l00067">readcmd()</a>.</p>

</div>
</div>
<a class="anchor" id="ab8fdd4551fc9bedbcef101983ef0ef93"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_RGB</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">vendor, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">product&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;((vendor) == (<a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a>) &amp;&amp; (product) != (<a class="el" href="usb_8h.html#a300ce7bf9091c9da9ebcb83600f13faa">P_K65_NRGB</a>) &amp;&amp; (product) != (<a class="el" href="usb_8h.html#a7fea7ba58b4bb6a7def7c380ab695110">P_K70_NRGB</a>) &amp;&amp; (product) != (<a class="el" href="usb_8h.html#ae8d1cf4b55023aae2b72ee607e214f84">P_K95_NRGB</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00122">122</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>, <a class="el" href="usb_8c_source.html#l00102">get_vtable()</a>, and <a class="el" href="usb__linux_8c_source.html#l00234">os_inputmain()</a>.</p>

</div>
</div>
<a class="anchor" id="ad52d5bb523bfdb33da00fba52d95f7c1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_RGB_DEV</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="usb_8h.html#ab8fdd4551fc9bedbcef101983ef0ef93">IS_RGB</a>((kb)-&gt;vendor, (kb)-&gt;product)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00130">130</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a42deb465caa31f803a16306986cd6bbe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_SABRE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#a0aa0f45f25df01bcee4abc96455e1138">P_SABRE_O</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a73e75008beef075e40fa5195d9c70bfe">P_SABRE_L</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a5b8bcefef6848c2e7889ecda124c8192">P_SABRE_N</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a294da39a7f6b6d23ff74b170b9423b4e">P_SABRE_O2</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00093">93</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="led_8c_source.html#l00073">has_key()</a>, <a class="el" href="led__mouse_8c_source.html#l00081">loadrgb_mouse()</a>, and <a class="el" href="led__mouse_8c_source.html#l00062">savergb_mouse()</a>.</p>

</div>
</div>
<a class="anchor" id="a42d0504a482944df6fe7cbdb06c0851b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_SCIMITAR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#af8ce90b65c8c9756870acd26a24054fc">P_SCIMITAR</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#ab76215820c9c39d5438ed28b4e8d8110">P_SCIMITAR_PRO</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00099">99</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="led_8c_source.html#l00073">has_key()</a>, <a class="el" href="led__mouse_8c_source.html#l00081">loadrgb_mouse()</a>, and <a class="el" href="led__mouse_8c_source.html#l00062">savergb_mouse()</a>.</p>

</div>
</div>
<a class="anchor" id="a934f88a3315f982a29c851cd8293155f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_STRAFE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;((kb)-&gt;vendor == <a class="el" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a> &amp;&amp; ((kb)-&gt;product == <a class="el" href="usb_8h.html#a26adb1ffc39cb46e583a236b14af9ace">P_STRAFE</a> || (kb)-&gt;product == <a class="el" href="usb_8h.html#a3e6f75a59f49265384d17e5d65b054e0">P_STRAFE_NRGB</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00077">77</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="led__keyboard_8c_source.html#l00139">savergb_kb()</a>.</p>

</div>
</div>
<a class="anchor" id="a9078f1b51a13f9710904c08826d57097"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NK95_HWOFF&#160;&#160;&#160;0x020030</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section see"><dt>See Also</dt><dd><a href="http://www.usb.org/developers/docs/usb_20.zip">usb2.0 documentation for details</a>. Set Hardware playback off </dd></dl>

<p>Definition at line <a class="el" href="usb_8h_source.html#l00299">299</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="device__keyboard_8c_source.html#l00009">start_kb_nrgb()</a>.</p>

</div>
</div>
<a class="anchor" id="af4d21ffe463251f15ed249be2531d8c7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NK95_HWON&#160;&#160;&#160;0x020001</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00302">302</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00407">revertusb()</a>.</p>

</div>
</div>
<a class="anchor" id="ae7897e304126f1b024206ea3001d377d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NK95_M1&#160;&#160;&#160;0x140001</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00305">305</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="device__keyboard_8c_source.html#l00120">setmodeindex_nrgb()</a>.</p>

</div>
</div>
<a class="anchor" id="a87e33091f2020d26471856c43195d970"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NK95_M2&#160;&#160;&#160;0x140002</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00308">308</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="device__keyboard_8c_source.html#l00120">setmodeindex_nrgb()</a>.</p>

</div>
</div>
<a class="anchor" id="aaa072888ddb1a257e739edb3655500bc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NK95_M3&#160;&#160;&#160;0x140003</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00311">311</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="device__keyboard_8c_source.html#l00120">setmodeindex_nrgb()</a>.</p>

</div>
</div>
<a class="anchor" id="aefc95e6120686dff0e06bba32ca21ad1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define nk95cmd</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">command&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="usb__linux_8c.html#a3da2cab9cd88ea517d39888fe2159734">_nk95cmd</a>(kb, (command) &gt;&gt; 16 &amp; 0xFF, (command) &amp; 0xFFFF, __FILE_NOPATH__, __LINE__)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00294">294</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00407">revertusb()</a>, <a class="el" href="device__keyboard_8c_source.html#l00120">setmodeindex_nrgb()</a>, and <a class="el" href="device__keyboard_8c_source.html#l00009">start_kb_nrgb()</a>.</p>

</div>
</div>
<a class="anchor" id="affc75c5e028c467b9a294360b8a66a17"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K65&#160;&#160;&#160;0x1b17</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00041">41</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a976d0683dbfa2225bf40016d151f70d3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K65_LUX&#160;&#160;&#160;0x1b37</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00045">45</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a87f69e4b896c892cfb5b3ff1410d31ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K65_LUX_STR&#160;&#160;&#160;&quot;1b37&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00046">46</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a300ce7bf9091c9da9ebcb83600f13faa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K65_NRGB&#160;&#160;&#160;0x1b07</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00043">43</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a3ef72d2b71461a831ec2971fdb323d45"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K65_NRGB_STR&#160;&#160;&#160;&quot;1b07&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00044">44</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae6a26ad33235021f82ada9c503e5661a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K65_RFIRE&#160;&#160;&#160;0x1b39</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00047">47</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a091ffc6a629d5e7b43678f451899acfc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K65_RFIRE_STR&#160;&#160;&#160;&quot;1b39&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00048">48</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a68ad83cdaab7454132293dba6c28df23"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K65_STR&#160;&#160;&#160;&quot;1b17&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00042">42</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3133fa57f7b2d7c888ffafeadc4476ab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70&#160;&#160;&#160;0x1b13</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00051">51</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a3fc42f14fec81381ff8251ca6a85b363"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70_LUX&#160;&#160;&#160;0x1b33</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00055">55</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="aa0f89f20ca96ad159330a8d071a45352"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70_LUX_NRGB&#160;&#160;&#160;0x1b36</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00057">57</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="led__keyboard_8c_source.html#l00181">loadrgb_kb()</a>, and <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a7015272c146f31745446a996c60d583c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70_LUX_NRGB_STR&#160;&#160;&#160;&quot;1b36&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00058">58</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a325a794b2e7b06929d5fb9010963fd3f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70_LUX_STR&#160;&#160;&#160;&quot;1b33&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00056">56</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7fea7ba58b4bb6a7def7c380ab695110"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70_NRGB&#160;&#160;&#160;0x1b09</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00053">53</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a89947cd3ff1f3f098f5a64322d36964c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70_NRGB_STR&#160;&#160;&#160;&quot;1b09&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00054">54</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a07e80868f8a95b9f8a2e85636833d45d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70_RFIRE&#160;&#160;&#160;0x1b38</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00059">59</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="abb58ca12d172afdf2b5469266c0c9af8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70_RFIRE_NRGB&#160;&#160;&#160;0x1b3a</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00061">61</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a4b910905c1d5863c63d862e63f6e01aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70_RFIRE_NRGB_STR&#160;&#160;&#160;&quot;1b3a&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00062">62</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad25e62c8bb5fdff82918c21a4f376d48"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70_RFIRE_STR&#160;&#160;&#160;&quot;1b38&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00060">60</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a13dedd3d75cdf16040bf21b01e3330cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K70_STR&#160;&#160;&#160;&quot;1b13&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00052">52</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5f5e9b029c7eec8f6c491d73f0499bb5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K95&#160;&#160;&#160;0x1b11</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00065">65</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="ae8d1cf4b55023aae2b72ee607e214f84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K95_NRGB&#160;&#160;&#160;0x1b08</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00067">67</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb__linux_8c_source.html#l00189">_nk95cmd()</a>, and <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a0d081ee7bfcd59217ef49bc01b42dae7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K95_NRGB_STR&#160;&#160;&#160;&quot;1b08&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00068">68</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab034dbd57f7ab5666729ce7e27d3e0b9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K95_PLATINUM&#160;&#160;&#160;0x1b2d</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00069">69</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a4a0b61c9e8124b0a0d86fd7a099e49d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K95_PLATINUM_STR&#160;&#160;&#160;&quot;1b2d&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00070">70</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="acae31fb041a4c3e8d202bb31a0f9969b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_K95_STR&#160;&#160;&#160;&quot;1b11&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00066">66</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a26cd43fb89a7329b7043cb962a12383b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_M65&#160;&#160;&#160;0x1b12</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00079">79</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a427ec77ae3e03646e7ac0a66516d39cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_M65_PRO&#160;&#160;&#160;0x1b2e</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00081">81</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a721620c5d76259244098e17305d9cb2b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_M65_PRO_STR&#160;&#160;&#160;&quot;1b2e&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00082">82</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="af97629330c65c7e9d3e796b098496766"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_M65_STR&#160;&#160;&#160;&quot;1b12&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00080">80</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a73e75008beef075e40fa5195d9c70bfe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SABRE_L&#160;&#160;&#160;0x1b19  /* laser */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00087">87</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="aec47a7a2fe154b99305b835843bffa29"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SABRE_L_STR&#160;&#160;&#160;&quot;1b19&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00088">88</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5b8bcefef6848c2e7889ecda124c8192"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SABRE_N&#160;&#160;&#160;0x1b2f  /* new? */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00089">89</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="ac190fd16809d56ec78db173421097bcb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SABRE_N_STR&#160;&#160;&#160;&quot;1b2f&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00090">90</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0aa0f45f25df01bcee4abc96455e1138"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SABRE_O&#160;&#160;&#160;0x1b14  /* optical */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00085">85</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a294da39a7f6b6d23ff74b170b9423b4e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SABRE_O2&#160;&#160;&#160;0x1b32 /* Observed on a CH-9000111-EU model SABRE */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00091">91</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a164b951b9f4aa4473c0780201447de2b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SABRE_O2_STR&#160;&#160;&#160;&quot;1b32&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00092">92</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="af88eeff90e15ec183cf4e041c53ee40b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SABRE_O_STR&#160;&#160;&#160;&quot;1b14&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00086">86</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="af8ce90b65c8c9756870acd26a24054fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SCIMITAR&#160;&#160;&#160;0x1b1e</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00095">95</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="ab76215820c9c39d5438ed28b4e8d8110"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SCIMITAR_PRO&#160;&#160;&#160;0x1b3e</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00097">97</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a67316b233c0f7fca0b77a70a0bbb9c81"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SCIMITAR_PRO_STR&#160;&#160;&#160;&quot;1b3e&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00098">98</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a4ca8f2f007234fe5c79794bead6b74d0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_SCIMITAR_STR&#160;&#160;&#160;&quot;1b1e&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00096">96</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a26adb1ffc39cb46e583a236b14af9ace"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_STRAFE&#160;&#160;&#160;0x1b20</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00073">73</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a3e6f75a59f49265384d17e5d65b054e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_STRAFE_NRGB&#160;&#160;&#160;0x1b15</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00075">75</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00070">product_str()</a>.</p>

</div>
</div>
<a class="anchor" id="ada53df20c5479953f8bc3247a9f17fdf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_STRAFE_NRGB_STR&#160;&#160;&#160;&quot;1b15&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00076">76</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0d186f9f8f273b0bc614cf0232540f1a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_STRAFE_STR&#160;&#160;&#160;&quot;1b20&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00074">74</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae1550dc55de346b46df8c4b6930613e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define resetusb</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="usb_8h.html#a9ea008b77417f82b177117dce9a50b48">_resetusb</a>(kb, <a class="el" href="includes_8h.html#aa8cd384afa0df6560f5924e9b321651f">__FILE_NOPATH__</a>, __LINE__)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00212">212</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00465">usb_tryreset()</a>.</p>

</div>
</div>
<a class="anchor" id="a099563afe2cc26cafb14b788b03d218e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USB_DELAY_DEFAULT&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00158">158</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>, and <a class="el" href="device_8c_source.html#l00078">start_dev()</a>.</p>

</div>
</div>
<a class="anchor" id="a80241296ff114704b355cd6081d2ff2e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define usbrecv</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">out_msg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">in_msg&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="usb_8h.html#a5a548f93d4c1c56910b840cebe88d0c2">_usbrecv</a>(kb, out_msg, in_msg, <a class="el" href="includes_8h.html#aa8cd384afa0df6560f5924e9b321651f">__FILE_NOPATH__</a>, __LINE__)</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
    <tr><td class="paramname">IN]</td><td>out_msg What information does the caller want from the device? </td></tr>
    <tr><td class="paramname">OUT]</td><td>in_msg Here comes the answer; The names represent the usb view, not the view of this function! So INput from usb is OUTput of this function. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="usb_8h_source.html#l00254">254</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="profile__keyboard_8c_source.html#l00016">cmd_hwload_kb()</a>, <a class="el" href="profile__mouse_8c_source.html#l00006">cmd_hwload_mouse()</a>, <a class="el" href="firmware_8c_source.html#l00011">getfwversion()</a>, <a class="el" href="profile__keyboard_8c_source.html#l00005">hwloadmode()</a>, <a class="el" href="dpi_8c_source.html#l00152">loaddpi()</a>, <a class="el" href="led__keyboard_8c_source.html#l00181">loadrgb_kb()</a>, and <a class="el" href="led__mouse_8c_source.html#l00081">loadrgb_mouse()</a>.</p>

</div>
</div>
<a class="anchor" id="a5eaa2b8ffe9e62747454c74b19876819"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define usbsend</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">kb, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">messages, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">count&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="usb_8h.html#a992cce1d173047466101113bfff5d7a1">_usbsend</a>(kb, messages, count, <a class="el" href="includes_8h.html#aa8cd384afa0df6560f5924e9b321651f">__FILE_NOPATH__</a>, __LINE__)</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
    <tr><td class="paramname">IN]</td><td>messages a Pointer to the first byte of the logical message </td></tr>
    <tr><td class="paramname">IN]</td><td>count how many MSG_SIZE buffers is the logical message long? </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="usb_8h_source.html#l00237">237</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="profile__keyboard_8c_source.html#l00057">cmd_hwsave_kb()</a>, <a class="el" href="profile__mouse_8c_source.html#l00050">cmd_hwsave_mouse()</a>, <a class="el" href="device__mouse_8c_source.html#l00052">cmd_pollrate()</a>, <a class="el" href="firmware_8c_source.html#l00055">fwupdate()</a>, <a class="el" href="led__keyboard_8c_source.html#l00181">loadrgb_kb()</a>, <a class="el" href="dpi_8c_source.html#l00124">savedpi()</a>, <a class="el" href="led__keyboard_8c_source.html#l00139">savergb_kb()</a>, <a class="el" href="led__mouse_8c_source.html#l00062">savergb_mouse()</a>, <a class="el" href="device__keyboard_8c_source.html#l00018">setactive_kb()</a>, <a class="el" href="device__mouse_8c_source.html#l00009">setactive_mouse()</a>, <a class="el" href="dpi_8c_source.html#l00089">updatedpi()</a>, <a class="el" href="led__keyboard_8c_source.html#l00077">updatergb_kb()</a>, and <a class="el" href="led__mouse_8c_source.html#l00020">updatergb_mouse()</a>.</p>

</div>
</div>
<a class="anchor" id="a2aa27325e30aac7dcec6203d4f11e996"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define V_CORSAIR&#160;&#160;&#160;0x1b1c</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section warning"><dt>Warning</dt><dd>When adding new devices please update src/ckb/fwupgradedialog.cpp as well. <br/>
 It should contain the same vendor/product IDs for any devices supporting firmware updates. <br/>
 In the same way, all other corresponding files have to be supplemented or modified: Currently known for this are <b><a class="el" href="usb__linux_8c.html">usb_linux.c</a></b> and <b><a class="el" href="usb__mac_8c.html">usb_mac.c</a></b> </dd></dl>

<p>Definition at line <a class="el" href="usb_8h_source.html#l00038">38</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb__linux_8c_source.html#l00683">usb_add_device()</a>, and <a class="el" href="usb_8c_source.html#l00043">vendor_str()</a>.</p>

</div>
</div>
<a class="anchor" id="a0a9288dd24752f04930cbf9e673e536c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define V_CORSAIR_STR&#160;&#160;&#160;&quot;1b1c&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb_8h_source.html#l00039">39</a> of file <a class="el" href="usb_8h_source.html">usb.h</a>.</p>

<p>Referenced by <a class="el" href="usb__linux_8c_source.html#l00735">udev_enum()</a>, and <a class="el" href="usb__linux_8c_source.html#l00683">usb_add_device()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a3da2cab9cd88ea517d39888fe2159734"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _nk95cmd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>&#160;</td>
          <td class="paramname"><em>bRequest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="includes_8h.html#ab95f123a6c9bcfee6a343170ef8c5f69">ushort</a>&#160;</td>
          <td class="paramname"><em>wValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
    <tr><td class="paramname">bRequest</td><td>the byte array with the usb request </td></tr>
    <tr><td class="paramname">wValue</td><td>a usb wValue </td></tr>
    <tr><td class="paramname">file</td><td>for error message </td></tr>
    <tr><td class="paramname">line</td><td>for error message </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 (true) on failure, 0 (false) on success.</dd></dl>
<p>To send control packets to a non RGB non color K95 Keyboard, use this function. Normally it is called via the <a class="el" href="usb_8h.html#aefc95e6120686dff0e06bba32ca21ad1" title="nk95cmd() macro is used to wrap _nk95cmd() with debugging information (file and lineno). the command structure is different:   Just the bits 23..16 are used as bits 7..0 for bRequest   Bits 15..0 are used as wValue ">nk95cmd()</a> macro.</p>
<p>If it is the wrong device for which the function is called, 0 is returned and nothing done. Otherwise a usbdevfs_ctrltransfer structure is filled and an USBDEVFS_CONTROL ioctl() called.</p>
<table class="doxtable">
<tr>
<th>bRequestType </th><th>bRequest </th><th>wValue </th><th>EP </th><th>size </th><th>Timeout </th><th>data  </th></tr>
<tr>
<td>0x40 </td><td>see table below to switch hardware-modus at Keyboard </td><td>wValue </td><td>device </td><td>MSG_SIZE </td><td>5ms </td><td>the message buffer pointer </td></tr>
<tr>
<td>Host to Device, Type=Vendor, Recipient=Device </td><td>bRequest parameter </td><td>given wValue Parameter </td><td>device 0 </td><td>0 data to write </td><td>5000 </td><td>null </td></tr>
</table>
<p>If a 0 or a negative error number is returned by the ioctl, an error message is shown depending on the errno or "No data written" if retval was 0. In either case 1 is returned to indicate the error. If the ioctl returned a value &gt; 0, 0 is returned to indicate no error.</p>
<p>Currently the following combinations for bRequest and wValue are used: </p>
<table class="doxtable">
<tr>
<th>Device </th><th>what it might to do </th><th>constant </th><th>bRequest </th><th>wValue  </th></tr>
<tr>
<td>non RGB Keyboard </td><td>set HW-modus on (leave the ckb driver) </td><td>HWON </td><td>0x0002 </td><td>0x0030 </td></tr>
<tr>
<td>non RGB Keyboard </td><td>set HW-modus off (initialize the ckb driver) </td><td>HWOFF </td><td>0x0002 </td><td>0x0001 </td></tr>
<tr>
<td>non RGB Keyboard </td><td>set light modus M1 in single-color keyboards </td><td>NK95_M1 </td><td>0x0014 </td><td>0x0001 </td></tr>
<tr>
<td>non RGB Keyboard </td><td>set light modus M2 in single-color keyboards </td><td>NK95_M2 </td><td>0x0014 </td><td>0x0002 </td></tr>
<tr>
<td>non RGB Keyboard </td><td>set light modus M3 in single-color keyboards </td><td>NK95_M3 </td><td>0x0014 </td><td>0x0003 </td></tr>
</table>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="usb_8h.html" title="Definitions for using USB interface. ">usb.h</a> </dd></dl>

<p>Definition at line <a class="el" href="usb__linux_8c_source.html#l00189">189</a> of file <a class="el" href="usb__linux_8c_source.html">usb_linux.c</a>.</p>

<p>References <a class="el" href="includes_8h_source.html#l00049">ckb_err_fn</a>, <a class="el" href="structures_8h_source.html#l00187">usbdevice::handle</a>, <a class="el" href="usb_8h_source.html#l00067">P_K95_NRGB</a>, and <a class="el" href="structures_8h_source.html#l00237">usbdevice::product</a>.</p>
<div class="fragment"><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                                                                      {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">if</span>(kb-&gt;<a class="code" href="structures_8h.html#a045b6c91e3f04e54f25d39da9bda105b">product</a> != <a class="code" href="usb_8h.html#ae8d1cf4b55023aae2b72ee607e214f84">P_K95_NRGB</a>)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keyword">struct </span>usbdevfs_ctrltransfer transfer = { 0x40, bRequest, wValue, 0, 0, 5000, 0 };</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordtype">int</span> res = ioctl(kb-&gt;<a class="code" href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">handle</a> - 1, USBDEVFS_CONTROL, &amp;transfer);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span>(res &lt;= 0){</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <a class="code" href="includes_8h.html#a31d8dc974fcd529cb912ca80f05db462">ckb_err_fn</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, file, line, res ? strerror(errno) : <span class="stringliteral">&quot;No data written&quot;</span>);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_a045b6c91e3f04e54f25d39da9bda105b"><div class="ttname"><a href="structures_8h.html#a045b6c91e3f04e54f25d39da9bda105b">usbdevice::product</a></div><div class="ttdeci">short product</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00237">structures.h:237</a></div></div>
<div class="ttc" id="usb_8h_html_ae8d1cf4b55023aae2b72ee607e214f84"><div class="ttname"><a href="usb_8h.html#ae8d1cf4b55023aae2b72ee607e214f84">P_K95_NRGB</a></div><div class="ttdeci">#define P_K95_NRGB</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00067">usb.h:67</a></div></div>
<div class="ttc" id="structures_8h_html_a1e1d8c37298aa076d30ba95dd97465ef"><div class="ttname"><a href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">usbdevice::handle</a></div><div class="ttdeci">int handle</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00187">structures.h:187</a></div></div>
<div class="ttc" id="includes_8h_html_a31d8dc974fcd529cb912ca80f05db462"><div class="ttname"><a href="includes_8h.html#a31d8dc974fcd529cb912ca80f05db462">ckb_err_fn</a></div><div class="ttdeci">#define ckb_err_fn(fmt, file, line, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00049">includes.h:49</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9ea008b77417f82b177117dce9a50b48"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _resetusb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
    <tr><td class="paramname">file</td><td>filename for error messages </td></tr>
    <tr><td class="paramname">line</td><td>line where it is called for error messages </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns 0 on success, -1 if device should be removed</dd></dl>
<p>_resetusb Reset a USB device.</p>
<p>First reset the device via <a class="el" href="usb_8h.html#a0fd9533617cdae390dc65aa4594e33d2" title="os_resetusb is the os specific implementation for resetting usb ">os_resetusb()</a> after a long delay (it may send something to the host). If this worked (retval == 0), give the device another long delay Then perform the initialization via the device specific start() function entry in kb-&gt;vtable and if this is successful also, return the result of the device depenten updatergb() with force=true. </p>

<p>Definition at line <a class="el" href="usb_8c_source.html#l00426">426</a> of file <a class="el" href="usb_8c_source.html">usb.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00231">usbdevice::active</a>, <a class="el" href="usb_8h_source.html#l00153">DELAY_LONG</a>, <a class="el" href="usb__linux_8c_source.html#l00490">os_resetusb()</a>, and <a class="el" href="structures_8h_source.html#l00180">usbdevice::vtable</a>.</p>
<div class="fragment"><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                                                        {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// Perform a USB reset</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <a class="code" href="usb_8h.html#a8de6458e3d59d88350ef3e73359c3526">DELAY_LONG</a>(kb);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordtype">int</span> res = <a class="code" href="usb_8h.html#a0fd9533617cdae390dc65aa4594e33d2">os_resetusb</a>(kb, file, line);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">if</span>(res)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="usb_8h.html#a8de6458e3d59d88350ef3e73359c3526">DELAY_LONG</a>(kb);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">// Re-initialize the device</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">if</span>(kb-&gt;<a class="code" href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">vtable</a>-&gt;start(kb, kb-&gt;<a class="code" href="structures_8h.html#a8889b6a5d3ce83427377e3a3de947f03">active</a>) != 0)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span>(kb-&gt;<a class="code" href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">vtable</a>-&gt;updatergb(kb, 1) != 0)</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;}</div>
<div class="ttc" id="usb_8h_html_a8de6458e3d59d88350ef3e73359c3526"><div class="ttname"><a href="usb_8h.html#a8de6458e3d59d88350ef3e73359c3526">DELAY_LONG</a></div><div class="ttdeci">#define DELAY_LONG(kb)</div><div class="ttdoc">The longest delay takes place where something went wrong (eg when resetting the device) ...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00153">usb.h:153</a></div></div>
<div class="ttc" id="usb_8h_html_a0fd9533617cdae390dc65aa4594e33d2"><div class="ttname"><a href="usb_8h.html#a0fd9533617cdae390dc65aa4594e33d2">os_resetusb</a></div><div class="ttdeci">int os_resetusb(usbdevice *kb, const char *file, int line)</div><div class="ttdoc">os_resetusb is the os specific implementation for resetting usb </div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00490">usb_linux.c:490</a></div></div>
<div class="ttc" id="structures_8h_html_a8889b6a5d3ce83427377e3a3de947f03"><div class="ttname"><a href="structures_8h.html#a8889b6a5d3ce83427377e3a3de947f03">usbdevice::active</a></div><div class="ttdeci">char active</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00231">structures.h:231</a></div></div>
<div class="ttc" id="structures_8h_html_a3ad960bd68547aca1f870fac1138023b"><div class="ttname"><a href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">usbdevice::vtable</a></div><div class="ttdeci">const union devcmd * vtable</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00180">structures.h:180</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a9ea008b77417f82b177117dce9a50b48_cgraph.png" border="0" usemap="#usb_8h_a9ea008b77417f82b177117dce9a50b48_cgraph" alt=""/></div>
<map name="usb_8h_a9ea008b77417f82b177117dce9a50b48_cgraph" id="usb_8h_a9ea008b77417f82b177117dce9a50b48_cgraph">
<area shape="rect" id="node2" href="usb_8h.html#a0fd9533617cdae390dc65aa4594e33d2" title="os_resetusb is the os specific implementation for resetting usb " alt="" coords="133,31,227,57"/><area shape="rect" id="node3" href="usb__linux_8c.html#afe1111f494da4776633be32fecaba44b" title="usbunclaim" alt="" coords="275,5,363,32"/><area shape="rect" id="node4" href="usb__linux_8c.html#a309cab8bf65221b01dc320f247abf626" title="usbclaim" alt="" coords="281,56,356,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5a548f93d4c1c56910b840cebe88d0c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _usbrecv </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>out_msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>in_msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
    <tr><td class="paramname">IN]</td><td>out_msg What information does the caller want from the device? </td></tr>
    <tr><td class="paramname">OUT]</td><td>in_msg Here comes the answer; The names represent the usb view, not the view of this function! So INput from usb is OUTput of this function. </td></tr>
    <tr><td class="paramname">IN]</td><td>file for debugging </td></tr>
    <tr><td class="paramname">IN]</td><td>line for debugging </td></tr>
    <tr><td class="paramname">IN]</td><td>reset_stop global variable is read </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes read or zero on failure.</dd></dl>
<p>_usbrecv Request data from a USB device by first sending an output packet and then reading the response.</p>
<p>To fully understand this, you need to know about usb: All control is at the usb host (the CPU). If the device wants to communicate something to the host, it must wait for the host to ask. The usb protocol defines the cycles and periods in which actions are to be taken.</p>
<p>So in order to receive a data packet from the device, the host must first send a send request. <br/>
 This is done by <a class="el" href="usb_8h.html#a5a548f93d4c1c56910b840cebe88d0c2" title="_usbrecv Request data from a USB device by first sending an output packet and then reading the respon...">_usbrecv()</a> in the first block by sending the MSG_SIZE large data block from <b>out_msg</b> via <a class="el" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long ">os_usbsend()</a> as it is a machine depending implementation. The usb target device is as always determined over kb.</p>
<p>For <a class="el" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long ">os_usbsend()</a> to know that it is a receive request, the <b>is_recv</b> parameter is set to true (1). With this, os_usbsend () generates a control package for the hardware, not a data packet.</p>
<p>If sending of the control package is not successful, a maximum of 5 times the transmission is repeated (including the first attempt). If a non-cancelable error is signaled or the drive is stopped via reset_stop, <a class="el" href="usb_8h.html#a5a548f93d4c1c56910b840cebe88d0c2" title="_usbrecv Request data from a USB device by first sending an output packet and then reading the respon...">_usbrecv()</a> immediately returns 0.</p>
<p>After this, the function waits for the requested response from the device using os_usbrecv ().</p>
<p><a class="el" href="usb_8h.html#a5694446920cfae8c887163847312a8f8" title="os_usbrecv receives a max MSGSIZE long buffer from usb device ">os_usbrecv()</a> returns 0, -1 or something else. <br/>
 Zero signals a serious error which is not treatable and <a class="el" href="usb_8h.html#a5a548f93d4c1c56910b840cebe88d0c2" title="_usbrecv Request data from a USB device by first sending an output packet and then reading the respon...">_usbrecv()</a> also returns 0. <br/>
 -1 means that it is a treatable error - a timeout for example - and therefore the next transfer attempt is started after a long pause (DELAY_LONG) if not reset_stop or the wrong hwload_mode require a termination with a return value of 0.</p>
<p>After 5 attempts, _usbrecv () returns and returns 0 as well as an error message.</p>
<p>When data is received, the number of received bytes is returned. This should always be MSG_SIZE, but <a class="el" href="usb_8h.html#a5694446920cfae8c887163847312a8f8" title="os_usbrecv receives a max MSGSIZE long buffer from usb device ">os_usbrecv()</a> can also return less. It should not be more, because then there would be an unhandled buffer overflow, but it could be less. This would be signaled in os_usbrecv () with a message.</p>
<p>The buffers behind <b>out_msg</b> and <b>in_msg</b> are MSG_SIZE at least (currently 64 Bytes). More is ok but useless, less brings unpredictable behavior. </p>

<p>Definition at line <a class="el" href="usb_8c_source.html#l00601">601</a> of file <a class="el" href="usb_8c_source.html">usb.c</a>.</p>

<p>References <a class="el" href="includes_8h_source.html#l00049">ckb_err_fn</a>, <a class="el" href="usb_8h_source.html#l00153">DELAY_LONG</a>, <a class="el" href="usb_8h_source.html#l00150">DELAY_MEDIUM</a>, <a class="el" href="usb_8h_source.html#l00147">DELAY_SHORT</a>, <a class="el" href="device_8c_source.html#l00007">hwload_mode</a>, <a class="el" href="usb__linux_8c_source.html#l00129">os_usbrecv()</a>, <a class="el" href="usb__linux_8c_source.html#l00068">os_usbsend()</a>, and <a class="el" href="usb_8c_source.html#l00025">reset_stop</a>.</p>
<div class="fragment"><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                                                                                            {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">// Try a maximum of 5 times</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <span class="keywordflow">try</span> = 0; <span class="keywordflow">try</span> &lt; 5; <span class="keywordflow">try</span>++){</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="comment">// Send the output message</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <a class="code" href="usb_8h.html#a73130b0fe3277a0fd9481eceb4f0e483">DELAY_SHORT</a>(kb);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordtype">int</span> res = <a class="code" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894">os_usbsend</a>(kb, out_msg, 1, file, line);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">if</span>(res == 0)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(res == -1){</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            <span class="comment">// Retry on temporary failure</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="usb_8c.html#acfc08dcd9203a7489c1c43362e2ff138">reset_stop</a>)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            <a class="code" href="usb_8h.html#a8de6458e3d59d88350ef3e73359c3526">DELAY_LONG</a>(kb);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="comment">// Wait for the response</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <a class="code" href="usb_8h.html#aff3be8eafb827438a28c97b8f9d2ddcc">DELAY_MEDIUM</a>(kb);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        res = <a class="code" href="usb_8h.html#a5694446920cfae8c887163847312a8f8">os_usbrecv</a>(kb, in_msg, file, line);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordflow">if</span>(res == 0)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(res != -1)</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="usb_8c.html#acfc08dcd9203a7489c1c43362e2ff138">reset_stop</a> || <a class="code" href="usb_8c.html#a94d4a8df060c5f77d94f3656fefe6c32">hwload_mode</a> != 2)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <a class="code" href="usb_8h.html#a8de6458e3d59d88350ef3e73359c3526">DELAY_LONG</a>(kb);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="comment">// Give up</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <a class="code" href="includes_8h.html#a31d8dc974fcd529cb912ca80f05db462">ckb_err_fn</a>(<span class="stringliteral">&quot;Too many send/recv failures. Dropping.\n&quot;</span>, file, line);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;}</div>
<div class="ttc" id="usb_8h_html_aff3be8eafb827438a28c97b8f9d2ddcc"><div class="ttname"><a href="usb_8h.html#aff3be8eafb827438a28c97b8f9d2ddcc">DELAY_MEDIUM</a></div><div class="ttdeci">#define DELAY_MEDIUM(kb)</div><div class="ttdoc">the medium delay is used after sending a command before waiting for the answer. </div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00150">usb.h:150</a></div></div>
<div class="ttc" id="usb_8h_html_a73130b0fe3277a0fd9481eceb4f0e483"><div class="ttname"><a href="usb_8h.html#a73130b0fe3277a0fd9481eceb4f0e483">DELAY_SHORT</a></div><div class="ttdeci">#define DELAY_SHORT(kb)</div><div class="ttdoc">USB delays for when the keyboards get picky about timing That was the original comment, but it is used anytime. The short delay is used before any send or receive. </div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00147">usb.h:147</a></div></div>
<div class="ttc" id="usb_8h_html_a8de6458e3d59d88350ef3e73359c3526"><div class="ttname"><a href="usb_8h.html#a8de6458e3d59d88350ef3e73359c3526">DELAY_LONG</a></div><div class="ttdeci">#define DELAY_LONG(kb)</div><div class="ttdoc">The longest delay takes place where something went wrong (eg when resetting the device) ...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00153">usb.h:153</a></div></div>
<div class="ttc" id="usb_8h_html_a5694446920cfae8c887163847312a8f8"><div class="ttname"><a href="usb_8h.html#a5694446920cfae8c887163847312a8f8">os_usbrecv</a></div><div class="ttdeci">int os_usbrecv(usbdevice *kb, uchar *in_msg, const char *file, int line)</div><div class="ttdoc">os_usbrecv receives a max MSGSIZE long buffer from usb device </div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00129">usb_linux.c:129</a></div></div>
<div class="ttc" id="usb_8c_html_acfc08dcd9203a7489c1c43362e2ff138"><div class="ttname"><a href="usb_8c.html#acfc08dcd9203a7489c1c43362e2ff138">reset_stop</a></div><div class="ttdeci">volatile int reset_stop</div><div class="ttdoc">brief . </div><div class="ttdef"><b>Definition:</b> <a href="usb_8c_source.html#l00025">usb.c:25</a></div></div>
<div class="ttc" id="usb_8c_html_a94d4a8df060c5f77d94f3656fefe6c32"><div class="ttname"><a href="usb_8c.html#a94d4a8df060c5f77d94f3656fefe6c32">hwload_mode</a></div><div class="ttdeci">int hwload_mode</div><div class="ttdoc">hwload_mode is defined in device.c </div><div class="ttdef"><b>Definition:</b> <a href="device_8c_source.html#l00007">device.c:7</a></div></div>
<div class="ttc" id="usb_8h_html_a9e813287cd0ee9c7b665002a929d2894"><div class="ttname"><a href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894">os_usbsend</a></div><div class="ttdeci">int os_usbsend(usbdevice *kb, const uchar *out_msg, int is_recv, const char *file, int line)</div><div class="ttdoc">os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long </div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00068">usb_linux.c:68</a></div></div>
<div class="ttc" id="includes_8h_html_a31d8dc974fcd529cb912ca80f05db462"><div class="ttname"><a href="includes_8h.html#a31d8dc974fcd529cb912ca80f05db462">ckb_err_fn</a></div><div class="ttdeci">#define ckb_err_fn(fmt, file, line, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00049">includes.h:49</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a5a548f93d4c1c56910b840cebe88d0c2_cgraph.png" border="0" usemap="#usb_8h_a5a548f93d4c1c56910b840cebe88d0c2_cgraph" alt=""/></div>
<map name="usb_8h_a5a548f93d4c1c56910b840cebe88d0c2_cgraph" id="usb_8h_a5a548f93d4c1c56910b840cebe88d0c2_cgraph">
<area shape="rect" id="node2" href="usb_8h.html#a5694446920cfae8c887163847312a8f8" title="os_usbrecv receives a max MSGSIZE long buffer from usb device " alt="" coords="130,5,219,32"/><area shape="rect" id="node3" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long " alt="" coords="129,56,221,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a992cce1d173047466101113bfff5d7a1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _usbsend </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>messages</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">IN]</td><td>messages a Pointer to the first byte of the logical message </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">IN]</td><td>count how many MSG_SIZE buffers is the logical message long? </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">IN]</td><td>file for debugging </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">IN]</td><td>line for debugging </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reset_stop</td><td>global variable is read </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of Bytes sent (ideal == count * MSG_SIZE);<br/>
 0 if a block could not be sent and it was not a timeout OR <b>reset_stop</b> was required or <b>hwload_mode</b> is not set to "always"</dd></dl>
<p>_usbsend send a logical message completely to the given device</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd>A lot of different conditions are combined in this code. Don't think, it is good in every combination...</dd></dl>
<p>The main task of _usbsend () is to transfer the complete logical message from the buffer beginning with <em>messages</em> to <b>count * MSG_SIZE</b>. <br/>
 According to usb 2.0 specification, a USB transmits a maximum of 64 byte user data packets. For the transmission of longer messages we need a segmentation. And that is exactly what happens here.</p>
<p>The message is given one by one to <a class="el" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long ">os_usbsend()</a> in MSG_SIZE (= 64) byte large bites. </p>
<dl class="section attention"><dt>Attention</dt><dd>This means that the buffer given as argument must be n * MSG_SIZE Byte long.</dd></dl>
<p>An essential constant parameter which is relevant for <a class="el" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long ">os_usbsend()</a> only is is_recv = 0, which means sending.</p>
<p>Now it gets a little complicated again:</p>
<ul>
<li>If <a class="el" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long ">os_usbsend()</a> returns 0, only zero bytes could be sent in one of the packets, or it was an error (-1 from the systemcall), but not a timeout. How many Bytes were sent in total from earlier calls does not seem to matter, <a class="el" href="usb_8h.html#a992cce1d173047466101113bfff5d7a1" title="_usbsend send a logical message completely to the given device ">_usbsend()</a> returns a total of 0.</li>
<li>Returns <a class="el" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long ">os_usbsend()</a> -1, first check if <b>reset_stop</b> is set globally or (incomprehensible) hwload_mode is not set to "always". In either case, <a class="el" href="usb_8h.html#a992cce1d173047466101113bfff5d7a1" title="_usbsend send a logical message completely to the given device ">_usbsend()</a> returns 0, otherwise it is assumed to be a temporary transfer error and it simply retransmits the physical packet after a long delay.</li>
<li>If the return value of <a class="el" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long ">os_usbsend()</a> was neither 0 nor -1, it specifies the numer of bytes transferred. <br/>
 Here is an information hiding conflict with <a class="el" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long ">os_usbsend()</a> (at least in the Linux version): <br/>
 If <a class="el" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long ">os_usbsend()</a> can not transfer the entire packet, errors are thrown and the number of bytes sent is returned. <a class="el" href="usb_8h.html#a992cce1d173047466101113bfff5d7a1" title="_usbsend send a logical message completely to the given device ">_usbsend()</a> interprets this as well and remembers the total number of bytes transferred in the local variable <b>total_sent</b>. Subsequently, however, transmission is continued with the next complete MSG_SIZE block and not with the first of the possibly missing bytes. <dl class="todo"><dt><b><a class="el" href="todo.html#_todo000010">Todo:</a></b></dt><dd>Check whether this is the same in the macOS variant. It is not dramatic, but if errors occur, it can certainly irritate the devices completely if they receive incomplete data streams. Do we have errors with the messages "Wrote YY bytes (expected 64)" in the system logs? If not, we do not need to look any further.</dd></dl>
</li>
</ul>
<p>When the last packet is transferred, <a class="el" href="usb_8h.html#a992cce1d173047466101113bfff5d7a1" title="_usbsend send a logical message completely to the given device ">_usbsend()</a> returns the effectively counted set of bytes (from <b>total_sent</b>). This at least gives the caller the opportunity to check whether something has been lost in the middle.</p>
<p>A bit strange is the structure of the program: Handling the <b>count</b> MSG_SIZE blocks to be transferred is done in the outer for (...) loop. Repeating the transfer with a treatable error is managed by the inner while(1) loop. <br/>
 This must be considered when reading the code; The "break" on successful block transfer leaves the inner while, not the for (...). </p>

<p>Definition at line <a class="el" href="usb_8c_source.html#l00532">532</a> of file <a class="el" href="usb_8c_source.html">usb.c</a>.</p>

<p>References <a class="el" href="usb_8h_source.html#l00153">DELAY_LONG</a>, <a class="el" href="usb_8h_source.html#l00147">DELAY_SHORT</a>, <a class="el" href="device_8c_source.html#l00007">hwload_mode</a>, <a class="el" href="device_8h_source.html#l00026">mmutex</a>, <a class="el" href="structures_8h_source.html#l00176">MSG_SIZE</a>, <a class="el" href="usb__linux_8c_source.html#l00068">os_usbsend()</a>, and <a class="el" href="usb_8c_source.html#l00025">reset_stop</a>.</p>
<div class="fragment"><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                                                                                         {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordtype">int</span> total_sent = 0;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; count; i++){</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="comment">// Send each message via the OS function</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="keywordflow">while</span>(1){</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            <a class="code" href="usb_8h.html#a73130b0fe3277a0fd9481eceb4f0e483">DELAY_SHORT</a>(kb);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            pthread_mutex_lock(<a class="code" href="device_8h.html#a7c03b451627e1eefc2e17de9da445619">mmutex</a>(kb)); <span class="comment">// Synchonization between macro output and color information</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="keywordtype">int</span> res = <a class="code" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894">os_usbsend</a>(kb, messages + i * <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>, 0, file, line);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            pthread_mutex_unlock(<a class="code" href="device_8h.html#a7c03b451627e1eefc2e17de9da445619">mmutex</a>(kb));</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="keywordflow">if</span>(res == 0)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(res != -1){</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                total_sent += res;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            <span class="comment">// Stop immediately if the program is shutting down or hardware load is set to tryonce</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="usb_8c.html#acfc08dcd9203a7489c1c43362e2ff138">reset_stop</a> || <a class="code" href="usb_8c.html#a94d4a8df060c5f77d94f3656fefe6c32">hwload_mode</a> != 2)</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="comment">// Retry as long as the result is temporary failure</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <a class="code" href="usb_8h.html#a8de6458e3d59d88350ef3e73359c3526">DELAY_LONG</a>(kb);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">return</span> total_sent;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_ad4d025ecf1bdbf8b244ca688df8e478d"><div class="ttname"><a href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a></div><div class="ttdeci">#define MSG_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00176">structures.h:176</a></div></div>
<div class="ttc" id="device_8h_html_a7c03b451627e1eefc2e17de9da445619"><div class="ttname"><a href="device_8h.html#a7c03b451627e1eefc2e17de9da445619">mmutex</a></div><div class="ttdeci">#define mmutex(kb)</div><div class="ttdef"><b>Definition:</b> <a href="device_8h_source.html#l00026">device.h:26</a></div></div>
<div class="ttc" id="usb_8h_html_a73130b0fe3277a0fd9481eceb4f0e483"><div class="ttname"><a href="usb_8h.html#a73130b0fe3277a0fd9481eceb4f0e483">DELAY_SHORT</a></div><div class="ttdeci">#define DELAY_SHORT(kb)</div><div class="ttdoc">USB delays for when the keyboards get picky about timing That was the original comment, but it is used anytime. The short delay is used before any send or receive. </div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00147">usb.h:147</a></div></div>
<div class="ttc" id="usb_8h_html_a8de6458e3d59d88350ef3e73359c3526"><div class="ttname"><a href="usb_8h.html#a8de6458e3d59d88350ef3e73359c3526">DELAY_LONG</a></div><div class="ttdeci">#define DELAY_LONG(kb)</div><div class="ttdoc">The longest delay takes place where something went wrong (eg when resetting the device) ...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00153">usb.h:153</a></div></div>
<div class="ttc" id="usb_8c_html_acfc08dcd9203a7489c1c43362e2ff138"><div class="ttname"><a href="usb_8c.html#acfc08dcd9203a7489c1c43362e2ff138">reset_stop</a></div><div class="ttdeci">volatile int reset_stop</div><div class="ttdoc">brief . </div><div class="ttdef"><b>Definition:</b> <a href="usb_8c_source.html#l00025">usb.c:25</a></div></div>
<div class="ttc" id="usb_8c_html_a94d4a8df060c5f77d94f3656fefe6c32"><div class="ttname"><a href="usb_8c.html#a94d4a8df060c5f77d94f3656fefe6c32">hwload_mode</a></div><div class="ttdeci">int hwload_mode</div><div class="ttdoc">hwload_mode is defined in device.c </div><div class="ttdef"><b>Definition:</b> <a href="device_8c_source.html#l00007">device.c:7</a></div></div>
<div class="ttc" id="usb_8h_html_a9e813287cd0ee9c7b665002a929d2894"><div class="ttname"><a href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894">os_usbsend</a></div><div class="ttdeci">int os_usbsend(usbdevice *kb, const uchar *out_msg, int is_recv, const char *file, int line)</div><div class="ttdoc">os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long </div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00068">usb_linux.c:68</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a992cce1d173047466101113bfff5d7a1_cgraph.png" border="0" usemap="#usb_8h_a992cce1d173047466101113bfff5d7a1_cgraph" alt=""/></div>
<map name="usb_8h_a992cce1d173047466101113bfff5d7a1_cgraph" id="usb_8h_a992cce1d173047466101113bfff5d7a1_cgraph">
<area shape="rect" id="node2" href="usb_8h.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long " alt="" coords="134,5,226,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8732b3ade76da4ae362996232ef95431"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int closeusb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">IN,OUT]</td><td>kb </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns 0 (everytime. No error handling is done!)</dd></dl>
<p>closeusb Close a USB device and remove device entry.</p>
<p>An imutex lock ensures first of all, that no communication is currently running from the viewpoint of the driver to the user input device (ie the virtual driver with which characters or mouse movements are sent from the daemon to the operating system as inputs).</p>
<p>If the <b>kb</b> has an acceptable value = 0, the index of the device is looked for and with this index <a class="el" href="input_8h.html#a44df5105a6a3f2eda5bc39a88201bd1a">os_inputclose()</a> is called. After this no more characters can be sent to the operating system.</p>
<p>Then the connection to the usb device is capped by <a class="el" href="usb_8h.html#a6a62575e9073fae15efb58f24fbfe5b8" title="os_closeusb unclaim it, destroy the udev device and clear data structures at kb ">os_closeusb()</a>. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000011">Todo:</a></b></dt><dd>What is not yet comprehensible is the call to <a class="el" href="devnode_8c.html#a4f2642e0c38280a1516fbe153c9fa18f" title="Update the list of connected devices. ">updateconnected()</a> BEFORE <a class="el" href="usb_8h.html#a6a62575e9073fae15efb58f24fbfe5b8" title="os_closeusb unclaim it, destroy the udev device and clear data structures at kb ">os_closeusb()</a>. Should that be in the other sequence? Or is <a class="el" href="devnode_8c.html#a4f2642e0c38280a1516fbe153c9fa18f" title="Update the list of connected devices. ">updateconnected()</a> not displaying the connected usb devices, but the representation which uinput devices are loaded? Questions about questions ...</dd></dl>
<p>If there is no valid <b>handle</b>, only <a class="el" href="devnode_8c.html#a4f2642e0c38280a1516fbe153c9fa18f" title="Update the list of connected devices. ">updateconnected()</a> is called. We are probably trying to disconnect a connection under construction. Not clear.</p>
<p>The cmd pipe as well as all open notify pipes are deleted via rmdevpath (). <br/>
 This means that nothing can happen to the input path - so the device-specific imutex is unlocked again and remains unlocked.</p>
<p>Also the dmutex is unlocked now, but only to join the thread, which was originally taken under <b>kb-&gt;thread</b> (which started with <a class="el" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . ">_setupusb()</a>) with pthread_join() again. Because of the closed devices that thread would have to quit sometime </p>
<dl class="section see"><dt>See Also</dt><dd>the hack note with <a class="el" href="devnode_8c.html#a8d0aeeebb364608943b78573adb85c7f" title="Remove the dev path for the keyboard at index. Returns 0 on success. ">rmdevpath()</a>)</dd></dl>
<p>As soon as the thread is caught, the dmutex is locked again, which is what I do not understand yet: What other thread can do usb communication now? <br/>
 If the vtabel exists for the given kb (why not? It seems to have race conditions here!!), via the vtable the actually device-specific, but still everywhere identical <a class="el" href="profile_8c.html#a1cc4119abc10fdf812f41fe5eecef439">freeprofile()</a> is called. This frees areas that are no longer needed. Then the <b>usbdevice</b> structure in its array is set to zero completely.</p>
<p>Error handling is rather unusual in <a class="el" href="usb_8h.html#a8732b3ade76da4ae362996232ef95431" title="closeusb Close a USB device and remove device entry. ">closeusb()</a>; Everything works (no matter what the called functions return), and <a class="el" href="usb_8h.html#a8732b3ade76da4ae362996232ef95431" title="closeusb Close a USB device and remove device entry. ">closeusb()</a> always returns zero (success). </p>

<p>Definition at line <a class="el" href="usb_8c_source.html#l00675">675</a> of file <a class="el" href="usb_8c_source.html">usb.c</a>.</p>

<p>References <a class="el" href="includes_8h_source.html#l00056">ckb_info</a>, <a class="el" href="devnode_8c_source.html#l00011">devpath</a>, <a class="el" href="device_8h_source.html#l00018">dmutex</a>, <a class="el" href="structures_8h_source.html#l00187">usbdevice::handle</a>, <a class="el" href="device_8h_source.html#l00022">imutex</a>, <a class="el" href="includes_8h_source.html#l00028">INDEX_OF</a>, <a class="el" href="device_8c_source.html#l00010">keyboard</a>, <a class="el" href="usb__linux_8c_source.html#l00428">os_closeusb()</a>, <a class="el" href="input__linux_8c_source.html#l00076">os_inputclose()</a>, <a class="el" href="devnode_8c_source.html#l00275">rmdevpath()</a>, <a class="el" href="structures_8h_source.html#l00217">usbdevice::thread</a>, <a class="el" href="devnode_8c_source.html#l00081">updateconnected()</a>, and <a class="el" href="structures_8h_source.html#l00180">usbdevice::vtable</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>, <a class="el" href="usb_8c_source.html#l00135">devmain()</a>, <a class="el" href="main_8c_source.html#l00040">quitWithLock()</a>, and <a class="el" href="usb__linux_8c_source.html#l00708">usb_rm_device()</a>.</p>
<div class="fragment"><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                           {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    pthread_mutex_lock(<a class="code" href="device_8h.html#aa87bd893f7d4bd0700cb699c88dd860b">imutex</a>(kb));</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">if</span>(kb-&gt;<a class="code" href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">handle</a>){</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordtype">int</span> index = <a class="code" href="includes_8h.html#ac114b913ed9d0b7cab3b83188f111530">INDEX_OF</a>(kb, <a class="code" href="device_8c.html#a5f2ad0f3998226c000c52c5c375c2661">keyboard</a>);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <a class="code" href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a>(<span class="stringliteral">&quot;Disconnecting %s%d\n&quot;</span>, <a class="code" href="devnode_8c.html#a6bb60389c0bd8be714f8fe2459205c89">devpath</a>, index);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <a class="code" href="input_8h.html#a44df5105a6a3f2eda5bc39a88201bd1a">os_inputclose</a>(kb);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <a class="code" href="devnode_8c.html#a4f2642e0c38280a1516fbe153c9fa18f">updateconnected</a>();</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="comment">// Close USB device</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <a class="code" href="usb_8h.html#a6a62575e9073fae15efb58f24fbfe5b8">os_closeusb</a>(kb);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <a class="code" href="devnode_8c.html#a4f2642e0c38280a1516fbe153c9fa18f">updateconnected</a>();</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <a class="code" href="devnode_8c.html#a8d0aeeebb364608943b78573adb85c7f">rmdevpath</a>(kb);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="comment">// Wait for thread to close</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    pthread_mutex_unlock(<a class="code" href="device_8h.html#aa87bd893f7d4bd0700cb699c88dd860b">imutex</a>(kb));</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    pthread_mutex_unlock(<a class="code" href="device_8h.html#a96bbdd939f65eebc392e07d74e6e6605">dmutex</a>(kb));</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    pthread_join(kb-&gt;<a class="code" href="structures_8h.html#a66ae3ceabd662fd1b7ee8352f303202c">thread</a>, 0);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    pthread_mutex_lock(<a class="code" href="device_8h.html#a96bbdd939f65eebc392e07d74e6e6605">dmutex</a>(kb));</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">// Delete the profile and the control path</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span>(!kb-&gt;<a class="code" href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">vtable</a>)</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    kb-&gt;<a class="code" href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">vtable</a>-&gt;freeprofile(kb);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    memset(kb, 0, <span class="keyword">sizeof</span>(<a class="code" href="structures_8h.html#structusbdevice">usbdevice</a>));</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;}</div>
<div class="ttc" id="device_8c_html_a5f2ad0f3998226c000c52c5c375c2661"><div class="ttname"><a href="device_8c.html#a5f2ad0f3998226c000c52c5c375c2661">keyboard</a></div><div class="ttdeci">usbdevice keyboard[9]</div><div class="ttdoc">remember all usb devices. Needed for closeusb(). </div><div class="ttdef"><b>Definition:</b> <a href="device_8c_source.html#l00010">device.c:10</a></div></div>
<div class="ttc" id="usb_8h_html_a6a62575e9073fae15efb58f24fbfe5b8"><div class="ttname"><a href="usb_8h.html#a6a62575e9073fae15efb58f24fbfe5b8">os_closeusb</a></div><div class="ttdeci">void os_closeusb(usbdevice *kb)</div><div class="ttdoc">os_closeusb unclaim it, destroy the udev device and clear data structures at kb </div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00428">usb_linux.c:428</a></div></div>
<div class="ttc" id="devnode_8c_html_a6bb60389c0bd8be714f8fe2459205c89"><div class="ttname"><a href="devnode_8c.html#a6bb60389c0bd8be714f8fe2459205c89">devpath</a></div><div class="ttdeci">const char *const devpath</div><div class="ttdef"><b>Definition:</b> <a href="devnode_8c_source.html#l00011">devnode.c:11</a></div></div>
<div class="ttc" id="includes_8h_html_af3b6c3fbbe2da20e4058fd83084329a6"><div class="ttname"><a href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a></div><div class="ttdeci">#define ckb_info(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00056">includes.h:56</a></div></div>
<div class="ttc" id="includes_8h_html_ac114b913ed9d0b7cab3b83188f111530"><div class="ttname"><a href="includes_8h.html#ac114b913ed9d0b7cab3b83188f111530">INDEX_OF</a></div><div class="ttdeci">#define INDEX_OF(entry, array)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00028">includes.h:28</a></div></div>
<div class="ttc" id="structures_8h_html_a3ad960bd68547aca1f870fac1138023b"><div class="ttname"><a href="structures_8h.html#a3ad960bd68547aca1f870fac1138023b">usbdevice::vtable</a></div><div class="ttdeci">const union devcmd * vtable</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00180">structures.h:180</a></div></div>
<div class="ttc" id="structures_8h_html_structusbdevice"><div class="ttname"><a href="structures_8h.html#structusbdevice">usbdevice</a></div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00178">structures.h:178</a></div></div>
<div class="ttc" id="device_8h_html_aa87bd893f7d4bd0700cb699c88dd860b"><div class="ttname"><a href="device_8h.html#aa87bd893f7d4bd0700cb699c88dd860b">imutex</a></div><div class="ttdeci">#define imutex(kb)</div><div class="ttdef"><b>Definition:</b> <a href="device_8h_source.html#l00022">device.h:22</a></div></div>
<div class="ttc" id="structures_8h_html_a1e1d8c37298aa076d30ba95dd97465ef"><div class="ttname"><a href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">usbdevice::handle</a></div><div class="ttdeci">int handle</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00187">structures.h:187</a></div></div>
<div class="ttc" id="input_8h_html_a44df5105a6a3f2eda5bc39a88201bd1a"><div class="ttname"><a href="input_8h.html#a44df5105a6a3f2eda5bc39a88201bd1a">os_inputclose</a></div><div class="ttdeci">void os_inputclose(usbdevice *kb)</div><div class="ttdef"><b>Definition:</b> <a href="input__linux_8c_source.html#l00076">input_linux.c:76</a></div></div>
<div class="ttc" id="structures_8h_html_a66ae3ceabd662fd1b7ee8352f303202c"><div class="ttname"><a href="structures_8h.html#a66ae3ceabd662fd1b7ee8352f303202c">usbdevice::thread</a></div><div class="ttdeci">pthread_t thread</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00217">structures.h:217</a></div></div>
<div class="ttc" id="device_8h_html_a96bbdd939f65eebc392e07d74e6e6605"><div class="ttname"><a href="device_8h.html#a96bbdd939f65eebc392e07d74e6e6605">dmutex</a></div><div class="ttdeci">#define dmutex(kb)</div><div class="ttdef"><b>Definition:</b> <a href="device_8h_source.html#l00018">device.h:18</a></div></div>
<div class="ttc" id="devnode_8c_html_a8d0aeeebb364608943b78573adb85c7f"><div class="ttname"><a href="devnode_8c.html#a8d0aeeebb364608943b78573adb85c7f">rmdevpath</a></div><div class="ttdeci">int rmdevpath(usbdevice *kb)</div><div class="ttdoc">Remove the dev path for the keyboard at index. Returns 0 on success. </div><div class="ttdef"><b>Definition:</b> <a href="devnode_8c_source.html#l00275">devnode.c:275</a></div></div>
<div class="ttc" id="devnode_8c_html_a4f2642e0c38280a1516fbe153c9fa18f"><div class="ttname"><a href="devnode_8c.html#a4f2642e0c38280a1516fbe153c9fa18f">updateconnected</a></div><div class="ttdeci">void updateconnected()</div><div class="ttdoc">Update the list of connected devices. </div><div class="ttdef"><b>Definition:</b> <a href="devnode_8c_source.html#l00081">devnode.c:81</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a8732b3ade76da4ae362996232ef95431_cgraph.png" border="0" usemap="#usb_8h_a8732b3ade76da4ae362996232ef95431_cgraph" alt=""/></div>
<map name="usb_8h_a8732b3ade76da4ae362996232ef95431_cgraph" id="usb_8h_a8732b3ade76da4ae362996232ef95431_cgraph">
<area shape="rect" id="node2" href="usb_8h.html#a6a62575e9073fae15efb58f24fbfe5b8" title="os_closeusb unclaim it, destroy the udev device and clear data structures at kb " alt="" coords="142,5,237,32"/><area shape="rect" id="node4" href="input_8h.html#a44df5105a6a3f2eda5bc39a88201bd1a" title="os_inputclose" alt="" coords="138,56,241,83"/><area shape="rect" id="node5" href="devnode_8c.html#a8d0aeeebb364608943b78573adb85c7f" title="Remove the dev path for the keyboard at index. Returns 0 on success. " alt="" coords="148,107,231,133"/><area shape="rect" id="node8" href="devnode_8c.html#a4f2642e0c38280a1516fbe153c9fa18f" title="Update the list of connected devices. " alt="" coords="129,157,250,184"/><area shape="rect" id="node3" href="usb__linux_8c.html#afe1111f494da4776633be32fecaba44b" title="usbunclaim" alt="" coords="319,5,407,32"/><area shape="rect" id="node6" href="devnode_8c.html#a9d97ede033e4f6c6bdd1c66fc82aa15e" title="_rmnotifynode" alt="" coords="311,56,415,83"/><area shape="rect" id="node7" href="devnode_8c.html#aac8f6f936a0ff6c16adc677622b226c4" title="rm_recursive" alt="" coords="314,107,411,133"/><area shape="rect" id="node9" href="devnode_8c.html#acc36eaba5eb854461ab3c0a4d146e9c9" title="_updateconnected Update the list of connected devices. " alt="" coords="299,157,427,184"/></map>
</div>
</p>

<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a8732b3ade76da4ae362996232ef95431_icgraph.png" border="0" usemap="#usb_8h_a8732b3ade76da4ae362996232ef95431_icgraph" alt=""/></div>
<map name="usb_8h_a8732b3ade76da4ae362996232ef95431_icgraph" id="usb_8h_a8732b3ade76da4ae362996232ef95431_icgraph">
<area shape="rect" id="node2" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . " alt="" coords="263,81,345,108"/><area shape="rect" id="node11" href="usb_8c.html#ab8c22b4f7012c6d9fe1a0d5e2a93df65" title="brief . " alt="" coords="129,56,199,83"/><area shape="rect" id="node12" href="main_8c.html#a24a012c29e291fef5fa13f4a07fffd33" title="quitWithLock " alt="" coords="652,157,751,184"/><area shape="rect" id="node15" href="usb__linux_8c.html#adeffaa2b04d01b15c8623255719420ef" title="usb_rm_device find the usb port to remove and close it via closeusb(). " alt="" coords="249,5,359,32"/><area shape="rect" id="node3" href="usb_8h.html#a1ab9d61dd894466125283465201161cd" title="setupusb starts a thread with kb as parameter and _setupusb() as entrypoint. " alt="" coords="408,81,483,108"/><area shape="rect" id="node4" href="usb__linux_8c.html#a3185d6da36c8b0f8b862a8479ae82034" title="usbadd" alt="" coords="531,81,595,108"/><area shape="rect" id="node5" href="usb__linux_8c.html#a50efc8ee0ffcb6f201735d1a3bb08779" title="Add a udev device. Returns 0 if device was recognized/added. " alt="" coords="643,81,759,108"/><area shape="rect" id="node6" href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea" title="udev_enum use the udev_enumerate_add_match_subsystem() to get all you need but only that..." alt="" coords="809,107,898,133"/><area shape="rect" id="node7" href="usb__linux_8c.html#a0859efad3739abe2ec61af4f3bb983ff" title="usbmain" alt="" coords="953,56,1023,83"/><area shape="rect" id="node8" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1077,132,1128,159"/><area shape="rect" id="node9" href="notify_8c.html#ae246359e104d63520158c26329caac80" title="restart" alt="" coords="1176,132,1235,159"/><area shape="rect" id="node10" href="notify_8h.html#a700b520b9eb9a3698af8f8ebf547a9ab" title="cmd_restart" alt="" coords="1283,132,1373,159"/><area shape="rect" id="node13" href="main_8c.html#acd1527386a48875050e637e4bb872f11" title="quit Stop working the daemon. function is called if the daemon received a sigterm In this case..." alt="" coords="832,157,875,184"/><area shape="rect" id="node14" href="main_8c.html#a05f9b9989842b986a26caf9e4c66a4c7" title="sighandler" alt="" coords="947,107,1029,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6a62575e9073fae15efb58f24fbfe5b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void os_closeusb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">IN,OUT]</td><td>kb THE usbdevice*</td></tr>
  </table>
  </dd>
</dl>
<p>os_closeusb unclaim it, destroy the udev device and clear data structures at kb</p>
<p>os_closeusb is the linux specific implementation for closing an active usb port. <br/>
 If a valid handle is given in the kb structure, the usb port is unclaimed (<a class="el" href="usb__linux_8c.html#afe1111f494da4776633be32fecaba44b">usbunclaim()</a>). <br/>
 The device in unrefenced via library function udev_device_unref(). <br/>
 handle, udev and the first char of kbsyspath are cleared to 0 (empty string for kbsyspath). </p>

<p>Definition at line <a class="el" href="usb__linux_8c_source.html#l00428">428</a> of file <a class="el" href="usb__linux_8c_source.html">usb_linux.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00187">usbdevice::handle</a>, <a class="el" href="includes_8h_source.html#l00028">INDEX_OF</a>, <a class="el" href="usb__linux_8c_source.html#l00013">kbsyspath</a>, <a class="el" href="device_8c_source.html#l00010">keyboard</a>, <a class="el" href="structures_8h_source.html#l00186">usbdevice::udev</a>, and <a class="el" href="usb__linux_8c_source.html#l00399">usbunclaim()</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00675">closeusb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                               {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">if</span>(kb-&gt;<a class="code" href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">handle</a>){</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <a class="code" href="usb__linux_8c.html#afe1111f494da4776633be32fecaba44b">usbunclaim</a>(kb, 0);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        close(kb-&gt;<a class="code" href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">handle</a> - 1);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">if</span>(kb-&gt;<a class="code" href="structures_8h.html#a050b6c1c162175c0e9abe16141770460">udev</a>)</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        udev_device_unref(kb-&gt;<a class="code" href="structures_8h.html#a050b6c1c162175c0e9abe16141770460">udev</a>);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    kb-&gt;<a class="code" href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">handle</a> = 0;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    kb-&gt;<a class="code" href="structures_8h.html#a050b6c1c162175c0e9abe16141770460">udev</a> = 0;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <a class="code" href="usb__linux_8c.html#a1b952c601049b156fe39d96473aaca3a">kbsyspath</a>[<a class="code" href="includes_8h.html#ac114b913ed9d0b7cab3b83188f111530">INDEX_OF</a>(kb, <a class="code" href="device_8c.html#a5f2ad0f3998226c000c52c5c375c2661">keyboard</a>)][0] = 0;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;}</div>
<div class="ttc" id="usb__linux_8c_html_a1b952c601049b156fe39d96473aaca3a"><div class="ttname"><a href="usb__linux_8c.html#a1b952c601049b156fe39d96473aaca3a">kbsyspath</a></div><div class="ttdeci">static char kbsyspath[9][FILENAME_MAX]</div><div class="ttdoc">all open usb devices have their system path names here in this array. </div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00013">usb_linux.c:13</a></div></div>
<div class="ttc" id="device_8c_html_a5f2ad0f3998226c000c52c5c375c2661"><div class="ttname"><a href="device_8c.html#a5f2ad0f3998226c000c52c5c375c2661">keyboard</a></div><div class="ttdeci">usbdevice keyboard[9]</div><div class="ttdoc">remember all usb devices. Needed for closeusb(). </div><div class="ttdef"><b>Definition:</b> <a href="device_8c_source.html#l00010">device.c:10</a></div></div>
<div class="ttc" id="usb__linux_8c_html_afe1111f494da4776633be32fecaba44b"><div class="ttname"><a href="usb__linux_8c.html#afe1111f494da4776633be32fecaba44b">usbunclaim</a></div><div class="ttdeci">static int usbunclaim(usbdevice *kb, int resetting)</div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00399">usb_linux.c:399</a></div></div>
<div class="ttc" id="structures_8h_html_a050b6c1c162175c0e9abe16141770460"><div class="ttname"><a href="structures_8h.html#a050b6c1c162175c0e9abe16141770460">usbdevice::udev</a></div><div class="ttdeci">struct udev_device * udev</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00186">structures.h:186</a></div></div>
<div class="ttc" id="includes_8h_html_ac114b913ed9d0b7cab3b83188f111530"><div class="ttname"><a href="includes_8h.html#ac114b913ed9d0b7cab3b83188f111530">INDEX_OF</a></div><div class="ttdeci">#define INDEX_OF(entry, array)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00028">includes.h:28</a></div></div>
<div class="ttc" id="structures_8h_html_a1e1d8c37298aa076d30ba95dd97465ef"><div class="ttname"><a href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">usbdevice::handle</a></div><div class="ttdeci">int handle</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00187">structures.h:187</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a6a62575e9073fae15efb58f24fbfe5b8_cgraph.png" border="0" usemap="#usb_8h_a6a62575e9073fae15efb58f24fbfe5b8_cgraph" alt=""/></div>
<map name="usb_8h_a6a62575e9073fae15efb58f24fbfe5b8_cgraph" id="usb_8h_a6a62575e9073fae15efb58f24fbfe5b8_cgraph">
<area shape="rect" id="node2" href="usb__linux_8c.html#afe1111f494da4776633be32fecaba44b" title="usbunclaim" alt="" coords="149,5,237,32"/></map>
</div>
</p>

<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a6a62575e9073fae15efb58f24fbfe5b8_icgraph.png" border="0" usemap="#usb_8h_a6a62575e9073fae15efb58f24fbfe5b8_icgraph" alt=""/></div>
<map name="usb_8h_a6a62575e9073fae15efb58f24fbfe5b8_icgraph" id="usb_8h_a6a62575e9073fae15efb58f24fbfe5b8_icgraph">
<area shape="rect" id="node2" href="usb_8h.html#a8732b3ade76da4ae362996232ef95431" title="closeusb Close a USB device and remove device entry. " alt="" coords="149,81,224,108"/><area shape="rect" id="node3" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . " alt="" coords="407,81,489,108"/><area shape="rect" id="node12" href="usb_8c.html#ab8c22b4f7012c6d9fe1a0d5e2a93df65" title="brief . " alt="" coords="273,56,343,83"/><area shape="rect" id="node13" href="main_8c.html#a24a012c29e291fef5fa13f4a07fffd33" title="quitWithLock " alt="" coords="796,157,895,184"/><area shape="rect" id="node16" href="usb__linux_8c.html#adeffaa2b04d01b15c8623255719420ef" title="usb_rm_device find the usb port to remove and close it via closeusb(). " alt="" coords="393,5,503,32"/><area shape="rect" id="node4" href="usb_8h.html#a1ab9d61dd894466125283465201161cd" title="setupusb starts a thread with kb as parameter and _setupusb() as entrypoint. " alt="" coords="552,81,627,108"/><area shape="rect" id="node5" href="usb__linux_8c.html#a3185d6da36c8b0f8b862a8479ae82034" title="usbadd" alt="" coords="675,81,739,108"/><area shape="rect" id="node6" href="usb__linux_8c.html#a50efc8ee0ffcb6f201735d1a3bb08779" title="Add a udev device. Returns 0 if device was recognized/added. " alt="" coords="787,81,903,108"/><area shape="rect" id="node7" href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea" title="udev_enum use the udev_enumerate_add_match_subsystem() to get all you need but only that..." alt="" coords="953,107,1042,133"/><area shape="rect" id="node8" href="usb__linux_8c.html#a0859efad3739abe2ec61af4f3bb983ff" title="usbmain" alt="" coords="1097,56,1167,83"/><area shape="rect" id="node9" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1221,132,1272,159"/><area shape="rect" id="node10" href="notify_8c.html#ae246359e104d63520158c26329caac80" title="restart" alt="" coords="1320,132,1379,159"/><area shape="rect" id="node11" href="notify_8h.html#a700b520b9eb9a3698af8f8ebf547a9ab" title="cmd_restart" alt="" coords="1427,132,1517,159"/><area shape="rect" id="node14" href="main_8c.html#acd1527386a48875050e637e4bb872f11" title="quit Stop working the daemon. function is called if the daemon received a sigterm In this case..." alt="" coords="976,157,1019,184"/><area shape="rect" id="node15" href="main_8c.html#a05f9b9989842b986a26caf9e4c66a4c7" title="sighandler" alt="" coords="1091,107,1173,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9e5784bfca2e4612f498ce67c7dab275"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* os_inputmain </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>THE usbdevice* ; Because <a class="el" href="usb_8h.html#a9e5784bfca2e4612f498ce67c7dab275" title="os_inputmain is run in a separate thread and will be detached from the main thread, so it needs to clean up its own resources. ">os_inputmain()</a> is started as a new thread, its formal parameter is named "context". </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>null</dd></dl>
<p>os_inputmain is run in a separate thread and will be detached from the main thread, so it needs to clean up its own resources.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000013">Todo:</a></b></dt><dd>This function is a collection of many tasks. It should be divided into several sub-functions for the sake of greater convenience:</dd></dl>
<ol type="1">
<li>set up an URB (Userspace Ressource Buffer) to communicate with the USBDEVFS_* ioctl()s</li>
<li>perform the ioctl()</li>
<li>interpretate the information got into the URB buffer or handle error situations and retry operation or leave the endless loop</li>
<li>inform the os about the data</li>
<li>loop endless via 2.</li>
<li>if endless loop has gone, deinitalize the interface, free buffers etc.</li>
<li>return null </li>
</ol>
<p>Here the actions in detail:</p>
<p>Monitor input transfers on all endpoints for non-RGB devices For RGB, monitor all but the last, as it's used for input/output</p>
<p>Get an usbdevfs_urb data structure and clear it via memset()</p>
<p>Hopefully the buffer lengths are equal for all devices with congruent types. You can find out the correctness for your device with lsusb &ndash;v or similar on macOS. Currently the following combinations are known and implemented:</p>
<table class="doxtable">
<tr>
<th>device </th><th>detect with macro combination </th><th>endpoint # </th><th>buffer-length  </th></tr>
<tr>
<td>each </td><td>none </td><td>0 </td><td>8 </td></tr>
<tr>
<td>RGB Mouse </td><td>IS_RGB &amp;&amp; IS_MOUSE </td><td>1 </td><td>10 </td></tr>
<tr>
<td>RGB Keyboard </td><td>IS_RGB &amp;&amp; !IS_MOUSE </td><td>1 </td><td>21 </td></tr>
<tr>
<td>RGB Mouse or Keyboard </td><td>IS_RGB </td><td>2 </td><td>MSG_SIZE (64) </td></tr>
<tr>
<td>non RGB Mouse or Keyboard </td><td>!IS_RGB </td><td>1 </td><td>4 </td></tr>
<tr>
<td>non RGB Mouse or Keyboard </td><td>!IS_RGB </td><td>2 </td><td>15 </td></tr>
</table>
<p>Now submit all the URBs via ioctl(USBDEVFS_SUBMITURB) with type USBDEVFS_URB_TYPE_INTERRUPT (the endpoints are defined as type interrupt). Endpoint number is 0x80..0x82 or 0x83, depending on the model.</p>
<p>The userSpaceFS knows the URBs now, so start monitoring input</p>
<p>if the ioctl returns something != 0, let's have a deeper look what happened. Broken devices or shutting down the entire system leads to closing the device and finishing this thread.</p>
<p>If just an EPIPE ocurred, give the device a CLEAR_HALT and resubmit the URB.</p>
<p>A correct REAPURB returns a Pointer to the URB which we now have a closer look into. Lock all following actions with imutex.</p>
<p>Process the input depending on type of device. Interprete the actual size of the URB buffer</p>
<table class="doxtable">
<tr>
<th>device </th><th>detect with macro combination </th><th>seems to be endpoint # </th><th>actual buffer-length </th><th>function called  </th></tr>
<tr>
<td>mouse (RGB and non RGB) </td><td>IS_MOUSE </td><td>nA </td><td>8, 10 or 11 </td><td><a class="el" href="keymap_8c.html#a092f675ff366b5823c73b25f83d513f9">hid_mouse_translate()</a> </td></tr>
<tr>
<td>mouse (RGB and non RGB) </td><td>IS_MOUSE </td><td>nA </td><td>MSG_SIZE (64) </td><td><a class="el" href="keymap_8c.html#a0dc9a16564cc51b35a35d28af1a96fb0">corsair_mousecopy()</a> </td></tr>
<tr>
<td>RGB Keyboard </td><td>IS_RGB &amp;&amp; !IS_MOUSE </td><td>1 </td><td>8 (BIOS Mode) </td><td><a class="el" href="keymap_8c.html#a6f4afd134546237416b271d9cefd2889">hid_kb_translate()</a> </td></tr>
<tr>
<td>RGB Keyboard </td><td>IS_RGB &amp;&amp; !IS_MOUSE </td><td>2 </td><td>5 or 21, KB inactive! </td><td><a class="el" href="keymap_8c.html#a6f4afd134546237416b271d9cefd2889">hid_kb_translate()</a> </td></tr>
<tr>
<td>RGB Keyboard </td><td>IS_RGB &amp;&amp; !IS_MOUSE </td><td>3? </td><td>MSG_SIZE </td><td><a class="el" href="keymap_8c.html#ad39ede76abd657f5123fa331853db017">corsair_kbcopy()</a> </td></tr>
<tr>
<td>non RGB Keyboard </td><td>!IS_RGB &amp;&amp; !IS_MOUSE </td><td>nA </td><td>nA </td><td><a class="el" href="keymap_8c.html#a6f4afd134546237416b271d9cefd2889">hid_kb_translate()</a> </td></tr>
</table>
<p>The input data is transformed and copied to the kb structure. Now give it to the OS and unlock the imutex afterwards.</p>
<p>Re-submit the URB for the next run.</p>
<p>If the endless loop is terminated, clean up by discarding the URBs via ioctl(USBDEVFS_DISCARDURB), free the URB buffers and return a null pointer as thread exit code. </p>

<p>Definition at line <a class="el" href="usb__linux_8c_source.html#l00234">234</a> of file <a class="el" href="usb__linux_8c_source.html">usb_linux.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00231">usbdevice::active</a>, <a class="el" href="includes_8h_source.html#l00050">ckb_err</a>, <a class="el" href="includes_8h_source.html#l00056">ckb_info</a>, <a class="el" href="keymap_8c_source.html#l00394">corsair_kbcopy()</a>, <a class="el" href="keymap_8c_source.html#l00403">corsair_mousecopy()</a>, <a class="el" href="devnode_8c_source.html#l00011">devpath</a>, <a class="el" href="structures_8h_source.html#l00215">usbdevice::epcount</a>, <a class="el" href="structures_8h_source.html#l00187">usbdevice::handle</a>, <a class="el" href="keymap_8c_source.html#l00223">hid_kb_translate()</a>, <a class="el" href="keymap_8c_source.html#l00366">hid_mouse_translate()</a>, <a class="el" href="device_8h_source.html#l00022">imutex</a>, <a class="el" href="includes_8h_source.html#l00028">INDEX_OF</a>, <a class="el" href="structures_8h_source.html#l00245">usbdevice::input</a>, <a class="el" href="input_8c_source.html#l00132">inputupdate()</a>, <a class="el" href="usb_8h_source.html#l00139">IS_MOUSE</a>, <a class="el" href="usb_8h_source.html#l00122">IS_RGB</a>, <a class="el" href="device_8c_source.html#l00010">keyboard</a>, <a class="el" href="structures_8h_source.html#l00130">usbinput::keys</a>, <a class="el" href="structures_8h_source.html#l00176">MSG_SIZE</a>, <a class="el" href="structures_8h_source.html#l00237">usbdevice::product</a>, <a class="el" href="structures_8h_source.html#l00132">usbinput::rel_x</a>, <a class="el" href="structures_8h_source.html#l00132">usbinput::rel_y</a>, and <a class="el" href="structures_8h_source.html#l00237">usbdevice::vendor</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                 {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="structures_8h.html#structusbdevice">usbdevice</a>* kb = context;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordtype">int</span> fd = kb-&gt;<a class="code" href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">handle</a> - 1;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordtype">short</span> vendor = kb-&gt;<a class="code" href="structures_8h.html#a2fa713366249e2fdbb2539e5d65a1439">vendor</a>, product = kb-&gt;<a class="code" href="structures_8h.html#a045b6c91e3f04e54f25d39da9bda105b">product</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">int</span> index = <a class="code" href="includes_8h.html#ac114b913ed9d0b7cab3b83188f111530">INDEX_OF</a>(kb, <a class="code" href="device_8c.html#a5f2ad0f3998226c000c52c5c375c2661">keyboard</a>);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a>(<span class="stringliteral">&quot;Starting input thread for %s%d\n&quot;</span>, <a class="code" href="devnode_8c.html#a6bb60389c0bd8be714f8fe2459205c89">devpath</a>, index);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordtype">int</span> urbcount = <a class="code" href="usb_8h.html#ab8fdd4551fc9bedbcef101983ef0ef93">IS_RGB</a>(vendor, product) ? (kb-&gt;<a class="code" href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">epcount</a> - 1) : kb-&gt;<a class="code" href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">epcount</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    if (urbcount == 0) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <a class="code" href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a>(<span class="stringliteral">&quot;urbcount = 0, so there is nothing to claim in os_inputmain()\n&quot;</span>);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keyword">struct </span>usbdevfs_urb urbs[urbcount];</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    memset(urbs, 0, <span class="keyword">sizeof</span>(urbs));</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    urbs[0].buffer_length = 8;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">if</span>(urbcount &gt; 1 &amp;&amp; <a class="code" href="usb_8h.html#ab8fdd4551fc9bedbcef101983ef0ef93">IS_RGB</a>(vendor, product)) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="usb_8h.html#a9aa1b86ddc13dc886bb403fda7c72ee7">IS_MOUSE</a>(vendor, product))</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            urbs[1].buffer_length = 10;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            urbs[1].buffer_length = 21;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        urbs[2].buffer_length = <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">if</span>(urbcount != 3)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            urbs[urbcount - 1].buffer_length = <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        urbs[1].buffer_length = 4;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        urbs[2].buffer_length = 15;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; urbcount; i++){</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        urbs[i].type = USBDEVFS_URB_TYPE_INTERRUPT;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        urbs[i].endpoint = 0x80 | (i + 1);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        urbs[i].buffer = malloc(urbs[i].buffer_length);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        ioctl(fd, USBDEVFS_SUBMITURB, urbs + i);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">while</span> (1) {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="keyword">struct </span>usbdevfs_urb* urb = 0;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">if</span> (ioctl(fd, USBDEVFS_REAPURB, &amp;urb)){</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="keywordflow">if</span> (errno == ENODEV || errno == ENOENT || errno == ESHUTDOWN)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                <span class="comment">// Stop the thread if the handle closes</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(errno == EPIPE &amp;&amp; urb){</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                ioctl(fd, USBDEVFS_CLEAR_HALT, &amp;urb-&gt;endpoint);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                <span class="comment">// Re-submit the URB</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                <span class="keywordflow">if</span>(urb)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                    ioctl(fd, USBDEVFS_SUBMITURB, urb);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                urb = 0;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">if</span> (urb) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            pthread_mutex_lock(<a class="code" href="device_8h.html#aa87bd893f7d4bd0700cb699c88dd860b">imutex</a>(kb));</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="usb_8h.html#a9aa1b86ddc13dc886bb403fda7c72ee7">IS_MOUSE</a>(vendor, product)){</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                <span class="keywordflow">switch</span>(urb-&gt;actual_length){</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                <span class="keywordflow">case</span> 8:</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <span class="keywordflow">case</span> 10:</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                <span class="keywordflow">case</span> 11:</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                    <span class="comment">// HID mouse input</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                    <a class="code" href="keymap_8c.html#a092f675ff366b5823c73b25f83d513f9">hid_mouse_translate</a>(kb-&gt;<a class="code" href="structures_8h.html#a3dfdb1f843ec3df0f2aeca70ee6f011a">input</a>.<a class="code" href="structures_8h.html#a09eb578ef851df58b6b124d9e6cf1dc0">keys</a>, &amp;kb-&gt;<a class="code" href="structures_8h.html#a3dfdb1f843ec3df0f2aeca70ee6f011a">input</a>.<a class="code" href="structures_8h.html#a67a69269768c4b55dd8fb7f09040c498">rel_x</a>, &amp;kb-&gt;<a class="code" href="structures_8h.html#a3dfdb1f843ec3df0f2aeca70ee6f011a">input</a>.<a class="code" href="structures_8h.html#aaf170cc287147501a64f3ec7131f1df0">rel_y</a>, -(urb-&gt;endpoint &amp; 0xF), urb-&gt;actual_length, urb-&gt;buffer);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>:</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                    <span class="comment">// Corsair mouse input</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                    <a class="code" href="keymap_8c.html#a0dc9a16564cc51b35a35d28af1a96fb0">corsair_mousecopy</a>(kb-&gt;<a class="code" href="structures_8h.html#a3dfdb1f843ec3df0f2aeca70ee6f011a">input</a>.<a class="code" href="structures_8h.html#a09eb578ef851df58b6b124d9e6cf1dc0">keys</a>, -(urb-&gt;endpoint &amp; 0xF), urb-&gt;buffer);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="usb_8h.html#ab8fdd4551fc9bedbcef101983ef0ef93">IS_RGB</a>(vendor, product)){</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                <span class="keywordflow">switch</span>(urb-&gt;actual_length){</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                <span class="keywordflow">case</span> 8:</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                    <span class="comment">// RGB EP 1: 6KRO (BIOS mode) input</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                    <a class="code" href="keymap_8c.html#a6f4afd134546237416b271d9cefd2889">hid_kb_translate</a>(kb-&gt;<a class="code" href="structures_8h.html#a3dfdb1f843ec3df0f2aeca70ee6f011a">input</a>.<a class="code" href="structures_8h.html#a09eb578ef851df58b6b124d9e6cf1dc0">keys</a>, -1, urb-&gt;actual_length, urb-&gt;buffer);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                <span class="keywordflow">case</span> 21:</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                <span class="keywordflow">case</span> 5:</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                    <span class="comment">// RGB EP 2: NKRO (non-BIOS) input. Accept only if keyboard is inactive</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                    <span class="keywordflow">if</span>(!kb-&gt;<a class="code" href="structures_8h.html#a8889b6a5d3ce83427377e3a3de947f03">active</a>)</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                        <a class="code" href="keymap_8c.html#a6f4afd134546237416b271d9cefd2889">hid_kb_translate</a>(kb-&gt;<a class="code" href="structures_8h.html#a3dfdb1f843ec3df0f2aeca70ee6f011a">input</a>.<a class="code" href="structures_8h.html#a09eb578ef851df58b6b124d9e6cf1dc0">keys</a>, -2, urb-&gt;actual_length, urb-&gt;buffer);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>:</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                    <span class="comment">// RGB EP 3: Corsair input</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                    <a class="code" href="keymap_8c.html#ad39ede76abd657f5123fa331853db017">corsair_kbcopy</a>(kb-&gt;<a class="code" href="structures_8h.html#a3dfdb1f843ec3df0f2aeca70ee6f011a">input</a>.<a class="code" href="structures_8h.html#a09eb578ef851df58b6b124d9e6cf1dc0">keys</a>, -(urb-&gt;endpoint &amp; 0xF), urb-&gt;buffer);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                <span class="comment">// Non-RGB input</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <a class="code" href="keymap_8c.html#a6f4afd134546237416b271d9cefd2889">hid_kb_translate</a>(kb-&gt;<a class="code" href="structures_8h.html#a3dfdb1f843ec3df0f2aeca70ee6f011a">input</a>.<a class="code" href="structures_8h.html#a09eb578ef851df58b6b124d9e6cf1dc0">keys</a>, urb-&gt;endpoint &amp; 0xF, urb-&gt;actual_length, urb-&gt;buffer);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            <a class="code" href="input_8c.html#ae360d0b9a764a1d38c5be5464be8b70a">inputupdate</a>(kb);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            pthread_mutex_unlock(<a class="code" href="device_8h.html#aa87bd893f7d4bd0700cb699c88dd860b">imutex</a>(kb));</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            ioctl(fd, USBDEVFS_SUBMITURB, urb);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            urb = 0;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a>(<span class="stringliteral">&quot;Stopping input thread for %s%d\n&quot;</span>, <a class="code" href="devnode_8c.html#a6bb60389c0bd8be714f8fe2459205c89">devpath</a>, index);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; urbcount; i++){</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        ioctl(fd, USBDEVFS_DISCARDURB, urbs + i);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        free(urbs[i].buffer);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_ad4d025ecf1bdbf8b244ca688df8e478d"><div class="ttname"><a href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a></div><div class="ttdeci">#define MSG_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00176">structures.h:176</a></div></div>
<div class="ttc" id="structures_8h_html_a3dfdb1f843ec3df0f2aeca70ee6f011a"><div class="ttname"><a href="structures_8h.html#a3dfdb1f843ec3df0f2aeca70ee6f011a">usbdevice::input</a></div><div class="ttdeci">usbinput input</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00245">structures.h:245</a></div></div>
<div class="ttc" id="includes_8h_html_a8312a1a42e03986afb7c76557f4d3e25"><div class="ttname"><a href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a></div><div class="ttdeci">#define ckb_err(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00050">includes.h:50</a></div></div>
<div class="ttc" id="usb_8h_html_ab8fdd4551fc9bedbcef101983ef0ef93"><div class="ttname"><a href="usb_8h.html#ab8fdd4551fc9bedbcef101983ef0ef93">IS_RGB</a></div><div class="ttdeci">#define IS_RGB(vendor, product)</div><div class="ttdoc">RGB vs non-RGB test (note: non-RGB Strafe is still considered &quot;RGB&quot; in that it shares the same protoc...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00122">usb.h:122</a></div></div>
<div class="ttc" id="device_8c_html_a5f2ad0f3998226c000c52c5c375c2661"><div class="ttname"><a href="device_8c.html#a5f2ad0f3998226c000c52c5c375c2661">keyboard</a></div><div class="ttdeci">usbdevice keyboard[9]</div><div class="ttdoc">remember all usb devices. Needed for closeusb(). </div><div class="ttdef"><b>Definition:</b> <a href="device_8c_source.html#l00010">device.c:10</a></div></div>
<div class="ttc" id="structures_8h_html_a09eb578ef851df58b6b124d9e6cf1dc0"><div class="ttname"><a href="structures_8h.html#a09eb578ef851df58b6b124d9e6cf1dc0">usbinput::keys</a></div><div class="ttdeci">uchar keys[((((152+3+12)+25)+7)/8)]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00130">structures.h:130</a></div></div>
<div class="ttc" id="structures_8h_html_a8889b6a5d3ce83427377e3a3de947f03"><div class="ttname"><a href="structures_8h.html#a8889b6a5d3ce83427377e3a3de947f03">usbdevice::active</a></div><div class="ttdeci">char active</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00231">structures.h:231</a></div></div>
<div class="ttc" id="structures_8h_html_a8d667681cbb0b3741476bf54c01e79b9"><div class="ttname"><a href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">usbdevice::epcount</a></div><div class="ttdeci">int epcount</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00215">structures.h:215</a></div></div>
<div class="ttc" id="input_8c_html_ae360d0b9a764a1d38c5be5464be8b70a"><div class="ttname"><a href="input_8c.html#ae360d0b9a764a1d38c5be5464be8b70a">inputupdate</a></div><div class="ttdeci">void inputupdate(usbdevice *kb)</div><div class="ttdef"><b>Definition:</b> <a href="input_8c_source.html#l00132">input.c:132</a></div></div>
<div class="ttc" id="usb_8h_html_a9aa1b86ddc13dc886bb403fda7c72ee7"><div class="ttname"><a href="usb_8h.html#a9aa1b86ddc13dc886bb403fda7c72ee7">IS_MOUSE</a></div><div class="ttdeci">#define IS_MOUSE(vendor, product)</div><div class="ttdoc">Mouse vs keyboard test. </div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00139">usb.h:139</a></div></div>
<div class="ttc" id="structures_8h_html_a67a69269768c4b55dd8fb7f09040c498"><div class="ttname"><a href="structures_8h.html#a67a69269768c4b55dd8fb7f09040c498">usbinput::rel_x</a></div><div class="ttdeci">short rel_x</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00132">structures.h:132</a></div></div>
<div class="ttc" id="keymap_8c_html_a092f675ff366b5823c73b25f83d513f9"><div class="ttname"><a href="keymap_8c.html#a092f675ff366b5823c73b25f83d513f9">hid_mouse_translate</a></div><div class="ttdeci">void hid_mouse_translate(unsigned char *kbinput, short *xaxis, short *yaxis, int endpoint, int length, const unsigned char *urbinput)</div><div class="ttdef"><b>Definition:</b> <a href="keymap_8c_source.html#l00366">keymap.c:366</a></div></div>
<div class="ttc" id="keymap_8c_html_a0dc9a16564cc51b35a35d28af1a96fb0"><div class="ttname"><a href="keymap_8c.html#a0dc9a16564cc51b35a35d28af1a96fb0">corsair_mousecopy</a></div><div class="ttdeci">void corsair_mousecopy(unsigned char *kbinput, int endpoint, const unsigned char *urbinput)</div><div class="ttdef"><b>Definition:</b> <a href="keymap_8c_source.html#l00403">keymap.c:403</a></div></div>
<div class="ttc" id="devnode_8c_html_a6bb60389c0bd8be714f8fe2459205c89"><div class="ttname"><a href="devnode_8c.html#a6bb60389c0bd8be714f8fe2459205c89">devpath</a></div><div class="ttdeci">const char *const devpath</div><div class="ttdef"><b>Definition:</b> <a href="devnode_8c_source.html#l00011">devnode.c:11</a></div></div>
<div class="ttc" id="includes_8h_html_af3b6c3fbbe2da20e4058fd83084329a6"><div class="ttname"><a href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a></div><div class="ttdeci">#define ckb_info(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00056">includes.h:56</a></div></div>
<div class="ttc" id="structures_8h_html_a045b6c91e3f04e54f25d39da9bda105b"><div class="ttname"><a href="structures_8h.html#a045b6c91e3f04e54f25d39da9bda105b">usbdevice::product</a></div><div class="ttdeci">short product</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00237">structures.h:237</a></div></div>
<div class="ttc" id="includes_8h_html_ac114b913ed9d0b7cab3b83188f111530"><div class="ttname"><a href="includes_8h.html#ac114b913ed9d0b7cab3b83188f111530">INDEX_OF</a></div><div class="ttdeci">#define INDEX_OF(entry, array)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00028">includes.h:28</a></div></div>
<div class="ttc" id="structures_8h_html_aaf170cc287147501a64f3ec7131f1df0"><div class="ttname"><a href="structures_8h.html#aaf170cc287147501a64f3ec7131f1df0">usbinput::rel_y</a></div><div class="ttdeci">short rel_y</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00132">structures.h:132</a></div></div>
<div class="ttc" id="structures_8h_html_structusbdevice"><div class="ttname"><a href="structures_8h.html#structusbdevice">usbdevice</a></div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00178">structures.h:178</a></div></div>
<div class="ttc" id="device_8h_html_aa87bd893f7d4bd0700cb699c88dd860b"><div class="ttname"><a href="device_8h.html#aa87bd893f7d4bd0700cb699c88dd860b">imutex</a></div><div class="ttdeci">#define imutex(kb)</div><div class="ttdef"><b>Definition:</b> <a href="device_8h_source.html#l00022">device.h:22</a></div></div>
<div class="ttc" id="keymap_8c_html_a6f4afd134546237416b271d9cefd2889"><div class="ttname"><a href="keymap_8c.html#a6f4afd134546237416b271d9cefd2889">hid_kb_translate</a></div><div class="ttdeci">void hid_kb_translate(unsigned char *kbinput, int endpoint, int length, const unsigned char *urbinput)</div><div class="ttdef"><b>Definition:</b> <a href="keymap_8c_source.html#l00223">keymap.c:223</a></div></div>
<div class="ttc" id="structures_8h_html_a1e1d8c37298aa076d30ba95dd97465ef"><div class="ttname"><a href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">usbdevice::handle</a></div><div class="ttdeci">int handle</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00187">structures.h:187</a></div></div>
<div class="ttc" id="keymap_8c_html_ad39ede76abd657f5123fa331853db017"><div class="ttname"><a href="keymap_8c.html#ad39ede76abd657f5123fa331853db017">corsair_kbcopy</a></div><div class="ttdeci">void corsair_kbcopy(unsigned char *kbinput, int endpoint, const unsigned char *urbinput)</div><div class="ttdef"><b>Definition:</b> <a href="keymap_8c_source.html#l00394">keymap.c:394</a></div></div>
<div class="ttc" id="structures_8h_html_a2fa713366249e2fdbb2539e5d65a1439"><div class="ttname"><a href="structures_8h.html#a2fa713366249e2fdbb2539e5d65a1439">usbdevice::vendor</a></div><div class="ttdeci">short vendor</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00237">structures.h:237</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a9e5784bfca2e4612f498ce67c7dab275_cgraph.png" border="0" usemap="#usb_8h_a9e5784bfca2e4612f498ce67c7dab275_cgraph" alt=""/></div>
<map name="usb_8h_a9e5784bfca2e4612f498ce67c7dab275_cgraph" id="usb_8h_a9e5784bfca2e4612f498ce67c7dab275_cgraph">
<area shape="rect" id="node2" href="keymap_8c.html#ad39ede76abd657f5123fa331853db017" title="corsair_kbcopy" alt="" coords="169,5,279,32"/><area shape="rect" id="node3" href="keymap_8c.html#a0dc9a16564cc51b35a35d28af1a96fb0" title="corsair_mousecopy" alt="" coords="157,56,291,83"/><area shape="rect" id="node4" href="keymap_8c.html#a6f4afd134546237416b271d9cefd2889" title="hid_kb_translate" alt="" coords="165,107,283,133"/><area shape="rect" id="node5" href="keymap_8c.html#a092f675ff366b5823c73b25f83d513f9" title="hid_mouse_translate" alt="" coords="153,157,295,184"/><area shape="rect" id="node6" href="input_8c.html#ae360d0b9a764a1d38c5be5464be8b70a" title="inputupdate" alt="" coords="179,208,269,235"/><area shape="rect" id="node7" href="input_8c.html#aed8e9842ed5750c1d328c5dc4c1ba2bd" title="inputupdate_keys" alt="" coords="345,183,469,209"/><area shape="rect" id="node13" href="input_8h.html#a9f2cfb2d883ae4a3732047fe3f3da683" title="os_mousemove" alt="" coords="517,233,632,260"/><area shape="rect" id="node8" href="input_8c.html#abd38419ce56379559481f51d9491adeb" title="macromask" alt="" coords="529,81,620,108"/><area shape="rect" id="node9" href="notify_8c.html#ac2411c0997dfdbefdebd45f2584a5d04" title="nprintkey" alt="" coords="537,132,612,159"/><area shape="rect" id="node11" href="input_8h.html#af0d3401f317f3214dadad7d1a3378c58" title="os_keypress" alt="" coords="527,183,623,209"/><area shape="rect" id="node10" href="notify_8c.html#a7ac88f15243030290e4d57c3c9ac7c98" title="nprintf" alt="" coords="680,132,739,159"/><area shape="rect" id="node12" href="input__linux_8c.html#a14ff0fdf147e3702197db2cadb878460" title="isync" alt="" coords="683,208,736,235"/></map>
</div>
</p>

<p><div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a9e5784bfca2e4612f498ce67c7dab275_icgraph.png" border="0" usemap="#usb_8h_a9e5784bfca2e4612f498ce67c7dab275_icgraph" alt=""/></div>
<map name="usb_8h_a9e5784bfca2e4612f498ce67c7dab275_icgraph" id="usb_8h_a9e5784bfca2e4612f498ce67c7dab275_icgraph">
<area shape="rect" id="node2" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . " alt="" coords="152,31,235,57"/><area shape="rect" id="node3" href="usb_8h.html#a1ab9d61dd894466125283465201161cd" title="setupusb starts a thread with kb as parameter and _setupusb() as entrypoint. " alt="" coords="283,31,357,57"/><area shape="rect" id="node4" href="usb__linux_8c.html#a3185d6da36c8b0f8b862a8479ae82034" title="usbadd" alt="" coords="405,31,469,57"/><area shape="rect" id="node5" href="usb__linux_8c.html#a50efc8ee0ffcb6f201735d1a3bb08779" title="Add a udev device. Returns 0 if device was recognized/added. " alt="" coords="518,31,634,57"/><area shape="rect" id="node6" href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea" title="udev_enum use the udev_enumerate_add_match_subsystem() to get all you need but only that..." alt="" coords="683,5,773,32"/><area shape="rect" id="node7" href="usb__linux_8c.html#a0859efad3739abe2ec61af4f3bb983ff" title="usbmain" alt="" coords="822,31,893,57"/><area shape="rect" id="node8" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="941,31,992,57"/><area shape="rect" id="node9" href="notify_8c.html#ae246359e104d63520158c26329caac80" title="restart" alt="" coords="1040,31,1099,57"/><area shape="rect" id="node10" href="notify_8h.html#a700b520b9eb9a3698af8f8ebf547a9ab" title="cmd_restart" alt="" coords="1147,31,1237,57"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0fd9533617cdae390dc65aa4594e33d2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int os_resetusb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
    <tr><td class="paramname">file</td><td>filename for error messages </td></tr>
    <tr><td class="paramname">line</td><td>line where it is called for error messages </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns 0 on success, -2 if device should be removed and -1 if reset should by tried again</dd></dl>
<p>os_resetusb is the os specific implementation for resetting usb</p>
<p>Try to reset an usb device in a linux user space driver.</p>
<ol type="1">
<li>unclaim the device, but do not reconnect the system driver (second param resetting = true)</li>
<li>reset the device via USBDEVFS_RESET command</li>
<li>claim the device again. Returns 0 on success, -2 if device should be removed and -1 if reset should by tried again</li>
</ol>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000014">Todo:</a></b></dt><dd>it seems that no one wants to try the reset again. But I'v seen it somewhere... </dd></dl>

<p>Definition at line <a class="el" href="usb__linux_8c_source.html#l00490">490</a> of file <a class="el" href="usb__linux_8c_source.html">usb_linux.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00187">usbdevice::handle</a>, <a class="el" href="usb__linux_8c_source.html#l00472">TEST_RESET</a>, <a class="el" href="usb__linux_8c_source.html#l00452">usbclaim()</a>, and <a class="el" href="usb__linux_8c_source.html#l00399">usbunclaim()</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00426">_resetusb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                                                           {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <a class="code" href="usb__linux_8c.html#a023dc730b8ef35b7918272df90d04c9b">TEST_RESET</a>(<a class="code" href="usb__linux_8c.html#afe1111f494da4776633be32fecaba44b">usbunclaim</a>(kb, 1));</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <a class="code" href="usb__linux_8c.html#a023dc730b8ef35b7918272df90d04c9b">TEST_RESET</a>(ioctl(kb-&gt;<a class="code" href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">handle</a> - 1, USBDEVFS_RESET));</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <a class="code" href="usb__linux_8c.html#a023dc730b8ef35b7918272df90d04c9b">TEST_RESET</a>(<a class="code" href="usb__linux_8c.html#a309cab8bf65221b01dc320f247abf626">usbclaim</a>(kb));</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">// Success!</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;}</div>
<div class="ttc" id="usb__linux_8c_html_a023dc730b8ef35b7918272df90d04c9b"><div class="ttname"><a href="usb__linux_8c.html#a023dc730b8ef35b7918272df90d04c9b">TEST_RESET</a></div><div class="ttdeci">#define TEST_RESET(op)</div><div class="ttdoc">TEST_RESET doesa &quot;try / catch&quot; for resetting the usb interface. </div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00472">usb_linux.c:472</a></div></div>
<div class="ttc" id="usb__linux_8c_html_afe1111f494da4776633be32fecaba44b"><div class="ttname"><a href="usb__linux_8c.html#afe1111f494da4776633be32fecaba44b">usbunclaim</a></div><div class="ttdeci">static int usbunclaim(usbdevice *kb, int resetting)</div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00399">usb_linux.c:399</a></div></div>
<div class="ttc" id="usb__linux_8c_html_a309cab8bf65221b01dc320f247abf626"><div class="ttname"><a href="usb__linux_8c.html#a309cab8bf65221b01dc320f247abf626">usbclaim</a></div><div class="ttdeci">static int usbclaim(usbdevice *kb)</div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00452">usb_linux.c:452</a></div></div>
<div class="ttc" id="structures_8h_html_a1e1d8c37298aa076d30ba95dd97465ef"><div class="ttname"><a href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">usbdevice::handle</a></div><div class="ttdeci">int handle</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00187">structures.h:187</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a0fd9533617cdae390dc65aa4594e33d2_cgraph.png" border="0" usemap="#usb_8h_a0fd9533617cdae390dc65aa4594e33d2_cgraph" alt=""/></div>
<map name="usb_8h_a0fd9533617cdae390dc65aa4594e33d2_cgraph" id="usb_8h_a0fd9533617cdae390dc65aa4594e33d2_cgraph">
<area shape="rect" id="node2" href="usb__linux_8c.html#a309cab8bf65221b01dc320f247abf626" title="usbclaim" alt="" coords="153,5,228,32"/><area shape="rect" id="node3" href="usb__linux_8c.html#afe1111f494da4776633be32fecaba44b" title="usbunclaim" alt="" coords="147,56,235,83"/></map>
</div>
</p>

<p><div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a0fd9533617cdae390dc65aa4594e33d2_icgraph.png" border="0" usemap="#usb_8h_a0fd9533617cdae390dc65aa4594e33d2_icgraph" alt=""/></div>
<map name="usb_8h_a0fd9533617cdae390dc65aa4594e33d2_icgraph" id="usb_8h_a0fd9533617cdae390dc65aa4594e33d2_icgraph">
<area shape="rect" id="node2" href="usb_8h.html#a9ea008b77417f82b177117dce9a50b48" title="_resetusb Reset a USB device. " alt="" coords="147,5,226,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afa51c505c8f442f49ea2d712c61faea2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void os_sendindicators </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice*</td></tr>
  </table>
  </dd>
</dl>
<p>os_sendindicators update the indicators for the special keys (Numlock, Capslock and what else?)</p>
<p>os_sendindicators update the indicators for the special keys (Numlock, Capslock and what else?)</p>
<p>Read the data from kb-&gt;ileds ans send them via ioctl() to the keyboard.</p>
<table class="doxtable">
<tr>
<th>bRequestType </th><th>bRequest </th><th>wValue </th><th>EP </th><th>size </th><th>Timeout </th><th>data  </th></tr>
<tr>
<td>0x21 </td><td>0x09 </td><td>0x0200 </td><td>Interface 0 </td><td>MSG_SIZE 1 Byte </td><td>timeout 0,5ms </td><td>the message buffer pointer </td></tr>
<tr>
<td>Host to Device, Type=Class, Recipient=Interface (why not endpoint?) </td><td>9 = SEND? </td><td>specific </td><td>0 </td><td>1 </td><td>500 </td><td>struct* kb-&gt;ileds </td></tr>
</table>
<p><br/>
 The ioctl command is USBDEVFS_CONTROL. </p>

<p>Definition at line <a class="el" href="usb__linux_8c_source.html#l00214">214</a> of file <a class="el" href="usb__linux_8c_source.html">usb_linux.c</a>.</p>

<p>References <a class="el" href="includes_8h_source.html#l00050">ckb_err</a>, <a class="el" href="structures_8h_source.html#l00187">usbdevice::handle</a>, and <a class="el" href="structures_8h_source.html#l00247">usbdevice::ileds</a>.</p>

<p>Referenced by <a class="el" href="input_8c_source.html#l00152">updateindicators_kb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                     {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keyword">struct </span>usbdevfs_ctrltransfer transfer = { 0x21, 0x09, 0x0200, 0x00, 1, 500, &amp;kb-&gt;<a class="code" href="structures_8h.html#ab972e12c3a761c070ec6e15cf45908f6">ileds</a> };</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordtype">int</span> res = ioctl(kb-&gt;<a class="code" href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">handle</a> - 1, USBDEVFS_CONTROL, &amp;transfer);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordflow">if</span>(res &lt;= 0)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <a class="code" href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, res ? strerror(errno) : <span class="stringliteral">&quot;No data written&quot;</span>);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div>
<div class="ttc" id="includes_8h_html_a8312a1a42e03986afb7c76557f4d3e25"><div class="ttname"><a href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a></div><div class="ttdeci">#define ckb_err(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00050">includes.h:50</a></div></div>
<div class="ttc" id="structures_8h_html_ab972e12c3a761c070ec6e15cf45908f6"><div class="ttname"><a href="structures_8h.html#ab972e12c3a761c070ec6e15cf45908f6">usbdevice::ileds</a></div><div class="ttdeci">uchar ileds</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00247">structures.h:247</a></div></div>
<div class="ttc" id="structures_8h_html_a1e1d8c37298aa076d30ba95dd97465ef"><div class="ttname"><a href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">usbdevice::handle</a></div><div class="ttdeci">int handle</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00187">structures.h:187</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_afa51c505c8f442f49ea2d712c61faea2_icgraph.png" border="0" usemap="#usb_8h_afa51c505c8f442f49ea2d712c61faea2_icgraph" alt=""/></div>
<map name="usb_8h_afa51c505c8f442f49ea2d712c61faea2_icgraph" id="usb_8h_afa51c505c8f442f49ea2d712c61faea2_icgraph">
<area shape="rect" id="node2" href="input_8h.html#a1126a054e3319ba8cbd74bfbd39099eb" title="updateindicators_kb" alt="" coords="181,5,320,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a39442715182933b93172de60cdb66e8f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int os_setupusb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 otherwise.</dd></dl>
<p>os_setupusb OS-specific setup for a specific usb device.</p>
<p>Perform the operating system-specific opening of the interface in <a class="el" href="usb_8h.html#a39442715182933b93172de60cdb66e8f" title="os_setupusb OS-specific setup for a specific usb device. ">os_setupusb()</a>. As a result, some parameters should be set in kb (name, serial, fwversion, epcount = number of usb endpoints), and all endpoints should be claimed with <a class="el" href="usb__linux_8c.html#a309cab8bf65221b01dc320f247abf626">usbclaim()</a>. Claiming is the only point where <a class="el" href="usb_8h.html#a39442715182933b93172de60cdb66e8f" title="os_setupusb OS-specific setup for a specific usb device. ">os_setupusb()</a> can produce an error (-1). </p>
<ul>
<li>Copy device description and serial</li>
<li>Copy firmware version (needed to determine USB protocol)</li>
<li>Do some output about connecting interfaces</li>
<li>Claim the USB interfaces</li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000015">Todo:</a></b></dt><dd>in these modules a pullrequest is outstanding </dd></dl>

<p>Definition at line <a class="el" href="usb__linux_8c_source.html#l00528">528</a> of file <a class="el" href="usb__linux_8c_source.html">usb_linux.c</a>.</p>

<p>References <a class="el" href="includes_8h_source.html#l00050">ckb_err</a>, <a class="el" href="includes_8h_source.html#l00056">ckb_info</a>, <a class="el" href="devnode_8c_source.html#l00011">devpath</a>, <a class="el" href="structures_8h_source.html#l00215">usbdevice::epcount</a>, <a class="el" href="structures_8h_source.html#l00239">usbdevice::fwversion</a>, <a class="el" href="includes_8h_source.html#l00028">INDEX_OF</a>, <a class="el" href="structures_8h_source.html#l00174">KB_NAME_LEN</a>, <a class="el" href="device_8c_source.html#l00010">keyboard</a>, <a class="el" href="structures_8h_source.html#l00233">usbdevice::name</a>, <a class="el" href="structures_8h_source.html#l00235">usbdevice::serial</a>, <a class="el" href="structures_8h_source.html#l00175">SERIAL_LEN</a>, <a class="el" href="usb__linux_8c_source.html#l00503">strtrim()</a>, <a class="el" href="structures_8h_source.html#l00186">usbdevice::udev</a>, and <a class="el" href="usb__linux_8c_source.html#l00452">usbclaim()</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                               {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keyword">struct </span>udev_device* dev = kb-&gt;<a class="code" href="structures_8h.html#a050b6c1c162175c0e9abe16141770460">udev</a>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* name = udev_device_get_sysattr_value(dev, <span class="stringliteral">&quot;product&quot;</span>);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">if</span>(name)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        strncpy(kb-&gt;<a class="code" href="structures_8h.html#afe60cc96ef4f77b69f3d15bc9bfb7f58">name</a>, name, <a class="code" href="structures_8h.html#a32d661966379fef9590d62fcb70a384f">KB_NAME_LEN</a>);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <a class="code" href="usb__linux_8c.html#ab694a2ac859b16b5af802b4484f5ba0b">strtrim</a>(kb-&gt;<a class="code" href="structures_8h.html#afe60cc96ef4f77b69f3d15bc9bfb7f58">name</a>);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* serial = udev_device_get_sysattr_value(dev, <span class="stringliteral">&quot;serial&quot;</span>);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">if</span>(serial)</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        strncpy(kb-&gt;<a class="code" href="structures_8h.html#a7f4ea697639b052e632ccc590f3c6ba6">serial</a>, serial, <a class="code" href="structures_8h.html#a1633179052fb1ef8df0dd803037b890e">SERIAL_LEN</a>);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <a class="code" href="usb__linux_8c.html#ab694a2ac859b16b5af802b4484f5ba0b">strtrim</a>(kb-&gt;<a class="code" href="structures_8h.html#a7f4ea697639b052e632ccc590f3c6ba6">serial</a>);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* firmware = udev_device_get_sysattr_value(dev, <span class="stringliteral">&quot;bcdDevice&quot;</span>);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">if</span>(firmware)</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        sscanf(firmware, <span class="stringliteral">&quot;%hx&quot;</span>, &amp;kb-&gt;<a class="code" href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">fwversion</a>);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        kb-&gt;<a class="code" href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">fwversion</a> = 0;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordtype">int</span> index = <a class="code" href="includes_8h.html#ac114b913ed9d0b7cab3b83188f111530">INDEX_OF</a>(kb, <a class="code" href="device_8c.html#a5f2ad0f3998226c000c52c5c375c2661">keyboard</a>);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <a class="code" href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a>(<span class="stringliteral">&quot;Connecting %s at %s%d\n&quot;</span>, kb-&gt;<a class="code" href="structures_8h.html#afe60cc96ef4f77b69f3d15bc9bfb7f58">name</a>, <a class="code" href="devnode_8c.html#a6bb60389c0bd8be714f8fe2459205c89">devpath</a>, index);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* ep_str = udev_device_get_sysattr_value(dev, <span class="stringliteral">&quot;bNumInterfaces&quot;</span>);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="preprocessor"></span>    <a class="code" href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a>(<span class="stringliteral">&quot;Connecting %s at %s%d\n&quot;</span>, kb-&gt;<a class="code" href="structures_8h.html#afe60cc96ef4f77b69f3d15bc9bfb7f58">name</a>, <a class="code" href="devnode_8c.html#a6bb60389c0bd8be714f8fe2459205c89">devpath</a>, index);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <a class="code" href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a>(<span class="stringliteral">&quot;claiming interfaces. name=%s, serial=%s, firmware=%s; Got &gt;&gt;%s&lt;&lt; as ep_str\n&quot;</span>, name, serial, firmware, ep_str);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="preprocessor">#endif //DEBUG</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="preprocessor"></span>    kb-&gt;<a class="code" href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">epcount</a> = 0;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">if</span>(ep_str)</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        sscanf(ep_str, <span class="stringliteral">&quot;%d&quot;</span>, &amp;kb-&gt;<a class="code" href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">epcount</a>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">if</span>(kb-&gt;<a class="code" href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">epcount</a> &lt; 2){</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="comment">// IF we have an RGB KB with 0 or 1 endpoints, it will be in BIOS mode.</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <a class="code" href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a>(<span class="stringliteral">&quot;Possibly unable to read endpoint count from udev, assuming %d and reading &gt;&gt;%s&lt;&lt;...\n&quot;</span>, kb-&gt;<a class="code" href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">epcount</a>, ep_str);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="comment">// ToDo are there special versions we have to detect? If there are, that was the old code to handle it:</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="comment">// This shouldn&#39;t happen, but if it does, assume EP count based onckb_warn what the device is supposed to have</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="comment">// kb-&gt;epcount = (HAS_FEATURES(kb, FEAT_RGB) ? 4 : 3);</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="comment">// ckb_warn(&quot;Unable to read endpoint count from udev, assuming %d and reading &gt;&gt;%s&lt;&lt;...\n&quot;, kb-&gt;epcount, ep_str);</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="usb__linux_8c.html#a309cab8bf65221b01dc320f247abf626">usbclaim</a>(kb)){</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <a class="code" href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a>(<span class="stringliteral">&quot;Failed to claim interfaces: %s\n&quot;</span>, strerror(errno));</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_a32d661966379fef9590d62fcb70a384f"><div class="ttname"><a href="structures_8h.html#a32d661966379fef9590d62fcb70a384f">KB_NAME_LEN</a></div><div class="ttdeci">#define KB_NAME_LEN</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00174">structures.h:174</a></div></div>
<div class="ttc" id="structures_8h_html_afe60cc96ef4f77b69f3d15bc9bfb7f58"><div class="ttname"><a href="structures_8h.html#afe60cc96ef4f77b69f3d15bc9bfb7f58">usbdevice::name</a></div><div class="ttdeci">char name[40+1]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00233">structures.h:233</a></div></div>
<div class="ttc" id="includes_8h_html_a8312a1a42e03986afb7c76557f4d3e25"><div class="ttname"><a href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a></div><div class="ttdeci">#define ckb_err(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00050">includes.h:50</a></div></div>
<div class="ttc" id="structures_8h_html_a47e0bd130899bcf5acdef059f2970ac7"><div class="ttname"><a href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">usbdevice::fwversion</a></div><div class="ttdeci">ushort fwversion</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00239">structures.h:239</a></div></div>
<div class="ttc" id="device_8c_html_a5f2ad0f3998226c000c52c5c375c2661"><div class="ttname"><a href="device_8c.html#a5f2ad0f3998226c000c52c5c375c2661">keyboard</a></div><div class="ttdeci">usbdevice keyboard[9]</div><div class="ttdoc">remember all usb devices. Needed for closeusb(). </div><div class="ttdef"><b>Definition:</b> <a href="device_8c_source.html#l00010">device.c:10</a></div></div>
<div class="ttc" id="structures_8h_html_a050b6c1c162175c0e9abe16141770460"><div class="ttname"><a href="structures_8h.html#a050b6c1c162175c0e9abe16141770460">usbdevice::udev</a></div><div class="ttdeci">struct udev_device * udev</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00186">structures.h:186</a></div></div>
<div class="ttc" id="usb__linux_8c_html_a309cab8bf65221b01dc320f247abf626"><div class="ttname"><a href="usb__linux_8c.html#a309cab8bf65221b01dc320f247abf626">usbclaim</a></div><div class="ttdeci">static int usbclaim(usbdevice *kb)</div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00452">usb_linux.c:452</a></div></div>
<div class="ttc" id="structures_8h_html_a8d667681cbb0b3741476bf54c01e79b9"><div class="ttname"><a href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">usbdevice::epcount</a></div><div class="ttdeci">int epcount</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00215">structures.h:215</a></div></div>
<div class="ttc" id="devnode_8c_html_a6bb60389c0bd8be714f8fe2459205c89"><div class="ttname"><a href="devnode_8c.html#a6bb60389c0bd8be714f8fe2459205c89">devpath</a></div><div class="ttdeci">const char *const devpath</div><div class="ttdef"><b>Definition:</b> <a href="devnode_8c_source.html#l00011">devnode.c:11</a></div></div>
<div class="ttc" id="includes_8h_html_af3b6c3fbbe2da20e4058fd83084329a6"><div class="ttname"><a href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a></div><div class="ttdeci">#define ckb_info(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00056">includes.h:56</a></div></div>
<div class="ttc" id="includes_8h_html_ac114b913ed9d0b7cab3b83188f111530"><div class="ttname"><a href="includes_8h.html#ac114b913ed9d0b7cab3b83188f111530">INDEX_OF</a></div><div class="ttdeci">#define INDEX_OF(entry, array)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00028">includes.h:28</a></div></div>
<div class="ttc" id="usb__linux_8c_html_ab694a2ac859b16b5af802b4484f5ba0b"><div class="ttname"><a href="usb__linux_8c.html#ab694a2ac859b16b5af802b4484f5ba0b">strtrim</a></div><div class="ttdeci">void strtrim(char *string)</div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00503">usb_linux.c:503</a></div></div>
<div class="ttc" id="structures_8h_html_a7f4ea697639b052e632ccc590f3c6ba6"><div class="ttname"><a href="structures_8h.html#a7f4ea697639b052e632ccc590f3c6ba6">usbdevice::serial</a></div><div class="ttdeci">char serial[34]</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00235">structures.h:235</a></div></div>
<div class="ttc" id="structures_8h_html_a1633179052fb1ef8df0dd803037b890e"><div class="ttname"><a href="structures_8h.html#a1633179052fb1ef8df0dd803037b890e">SERIAL_LEN</a></div><div class="ttdeci">#define SERIAL_LEN</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00175">structures.h:175</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a39442715182933b93172de60cdb66e8f_cgraph.png" border="0" usemap="#usb_8h_a39442715182933b93172de60cdb66e8f_cgraph" alt=""/></div>
<map name="usb_8h_a39442715182933b93172de60cdb66e8f_cgraph" id="usb_8h_a39442715182933b93172de60cdb66e8f_cgraph">
<area shape="rect" id="node2" href="usb__linux_8c.html#ab694a2ac859b16b5af802b4484f5ba0b" title="strtrim" alt="" coords="157,5,216,32"/><area shape="rect" id="node3" href="usb__linux_8c.html#a309cab8bf65221b01dc320f247abf626" title="usbclaim" alt="" coords="149,56,224,83"/></map>
</div>
</p>

<p><div id="dynsection-15" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a39442715182933b93172de60cdb66e8f_icgraph.png" border="0" usemap="#usb_8h_a39442715182933b93172de60cdb66e8f_icgraph" alt=""/></div>
<map name="usb_8h_a39442715182933b93172de60cdb66e8f_icgraph" id="usb_8h_a39442715182933b93172de60cdb66e8f_icgraph">
<area shape="rect" id="node2" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . " alt="" coords="149,31,232,57"/><area shape="rect" id="node3" href="usb_8h.html#a1ab9d61dd894466125283465201161cd" title="setupusb starts a thread with kb as parameter and _setupusb() as entrypoint. " alt="" coords="280,31,355,57"/><area shape="rect" id="node4" href="usb__linux_8c.html#a3185d6da36c8b0f8b862a8479ae82034" title="usbadd" alt="" coords="403,31,467,57"/><area shape="rect" id="node5" href="usb__linux_8c.html#a50efc8ee0ffcb6f201735d1a3bb08779" title="Add a udev device. Returns 0 if device was recognized/added. " alt="" coords="515,31,631,57"/><area shape="rect" id="node6" href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea" title="udev_enum use the udev_enumerate_add_match_subsystem() to get all you need but only that..." alt="" coords="681,5,770,32"/><area shape="rect" id="node7" href="usb__linux_8c.html#a0859efad3739abe2ec61af4f3bb983ff" title="usbmain" alt="" coords="819,31,890,57"/><area shape="rect" id="node8" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="939,31,989,57"/><area shape="rect" id="node9" href="notify_8c.html#ae246359e104d63520158c26329caac80" title="restart" alt="" coords="1037,31,1096,57"/><area shape="rect" id="node10" href="notify_8h.html#a700b520b9eb9a3698af8f8ebf547a9ab" title="cmd_restart" alt="" coords="1144,31,1235,57"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5694446920cfae8c887163847312a8f8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int os_usbrecv </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>in_msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
    <tr><td class="paramname">in_msg</td><td>the buffer to fill with the message received </td></tr>
    <tr><td class="paramname">file</td><td>for debugging </td></tr>
    <tr><td class="paramname">line</td><td>for debugging </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>-1 on timeout, 0 on hard error, numer of bytes received otherwise</dd></dl>
<p>os_usbrecv does what its name says:</p>
<p>The comment at the beginning of the procedure causes the suspicion that the firmware versionspecific distinction is missing for receiving from usb endpoint 3 or 4. The commented code contains only the reception from EP4, but this may be wrong for a software version 2.0 or higher (see the code for os-usbsend ()).</p>
<p><br/>
 So all the receiving is done via an ioctl() like in os_usbsend. The ioctl() is given a struct usbdevfs_ctrltransfer, in which the relevant parameters are entered:</p>
<table class="doxtable">
<tr>
<th>bRequestType </th><th>bRequest </th><th>wValue </th><th>EP </th><th>size </th><th>Timeout </th><th>data  </th></tr>
<tr>
<td>0xA1 </td><td>0x01 </td><td>0x0200 </td><td>endpoint to be addressed from epcount - 1 </td><td>MSG_SIZE </td><td>5ms </td><td>the message buffer pointer </td></tr>
<tr>
<td>Device to Host, Type=Class, Recipient=Interface </td><td>1 = RECEIVE? </td><td>specific </td><td>Interface # </td><td>64 </td><td>5000 </td><td>in_msg </td></tr>
</table>
<p>The ioctl() returns the number of bytes received. Here is the usual check again:</p>
<ul>
<li>If the return value is -1 AND the error is a timeout (ETIMEOUT), <a class="el" href="usb__linux_8c.html#a5694446920cfae8c887163847312a8f8" title="os_usbrecv receives a max MSGSIZE long buffer from usb device ">os_usbrecv()</a> will return -1 to indicate that it is probably a recoverable problem and a retry is recommended.</li>
<li>For another negative value or other error identifier OR 0 bytes are received, 0 is returned as an identifier for a heavy error.</li>
<li>In all other cases, the function returns the number of bytes received.</li>
</ul>
<p>If this is not the entire blocksize (MSG_SIZE bytes), an error message is issued on the standard error channel [warning "Read YY bytes (expected 64)"]. </p>

<p>Definition at line <a class="el" href="usb__linux_8c_source.html#l00129">129</a> of file <a class="el" href="usb__linux_8c_source.html">usb_linux.c</a>.</p>

<p>References <a class="el" href="includes_8h_source.html#l00049">ckb_err_fn</a>, <a class="el" href="includes_8h_source.html#l00052">ckb_warn_fn</a>, <a class="el" href="structures_8h_source.html#l00215">usbdevice::epcount</a>, <a class="el" href="structures_8h_source.html#l00187">usbdevice::handle</a>, and <a class="el" href="structures_8h_source.html#l00176">MSG_SIZE</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00601">_usbrecv()</a>.</p>
<div class="fragment"><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                                                                        {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordtype">int</span> res;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// This is what CUE does, but it doesn&#39;t seem to work on linux.</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">/*if(kb-&gt;fwversion &gt;= 0x130){</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">        struct usbdevfs_bulktransfer transfer;</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">        memset(&amp;transfer, 0, sizeof(transfer));</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">        transfer.ep = 0x84;</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">        transfer.len = MSG_SIZE;</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">        transfer.timeout = 5000;</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">        transfer.data = in_msg;</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">        res = ioctl(kb-&gt;handle - 1, USBDEVFS_BULK, &amp;transfer);</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">    } else {*/</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keyword">struct </span>usbdevfs_ctrltransfer transfer = { 0xa1, 0x01, 0x0300, kb-&gt;<a class="code" href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">epcount</a> - 1, <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>, 5000, in_msg };</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        res = ioctl(kb-&gt;<a class="code" href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">handle</a> - 1, USBDEVFS_CONTROL, &amp;transfer);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">if</span>(res &lt;= 0){</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <a class="code" href="includes_8h.html#a31d8dc974fcd529cb912ca80f05db462">ckb_err_fn</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, file, line, res ? strerror(errno) : <span class="stringliteral">&quot;No data read&quot;</span>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordflow">if</span>(res == -1 &amp;&amp; errno == ETIMEDOUT)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(res != <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>)</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <a class="code" href="includes_8h.html#a1e1f9c51b62903b645e69191280cfbab">ckb_warn_fn</a>(<span class="stringliteral">&quot;Read %d bytes (expected %d)\n&quot;</span>, file, line, res, <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#ifdef DEBUG_USB_RECV</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">char</span> converted[<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>*3 + 1];</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>;i++)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        sprintf(&amp;converted[i*3], <span class="stringliteral">&quot;%02x &quot;</span>, in_msg[i]);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="includes_8h.html#a1e1f9c51b62903b645e69191280cfbab">ckb_warn_fn</a>(<span class="stringliteral">&quot;Recv %s\n&quot;</span>, file, line, converted);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_ad4d025ecf1bdbf8b244ca688df8e478d"><div class="ttname"><a href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a></div><div class="ttdeci">#define MSG_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00176">structures.h:176</a></div></div>
<div class="ttc" id="structures_8h_html_a8d667681cbb0b3741476bf54c01e79b9"><div class="ttname"><a href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">usbdevice::epcount</a></div><div class="ttdeci">int epcount</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00215">structures.h:215</a></div></div>
<div class="ttc" id="includes_8h_html_a1e1f9c51b62903b645e69191280cfbab"><div class="ttname"><a href="includes_8h.html#a1e1f9c51b62903b645e69191280cfbab">ckb_warn_fn</a></div><div class="ttdeci">#define ckb_warn_fn(fmt, file, line, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00052">includes.h:52</a></div></div>
<div class="ttc" id="structures_8h_html_a1e1d8c37298aa076d30ba95dd97465ef"><div class="ttname"><a href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">usbdevice::handle</a></div><div class="ttdeci">int handle</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00187">structures.h:187</a></div></div>
<div class="ttc" id="includes_8h_html_a31d8dc974fcd529cb912ca80f05db462"><div class="ttname"><a href="includes_8h.html#a31d8dc974fcd529cb912ca80f05db462">ckb_err_fn</a></div><div class="ttdeci">#define ckb_err_fn(fmt, file, line, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00049">includes.h:49</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-16" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a5694446920cfae8c887163847312a8f8_icgraph.png" border="0" usemap="#usb_8h_a5694446920cfae8c887163847312a8f8_icgraph" alt=""/></div>
<map name="usb_8h_a5694446920cfae8c887163847312a8f8_icgraph" id="usb_8h_a5694446920cfae8c887163847312a8f8_icgraph">
<area shape="rect" id="node2" href="usb_8h.html#a5a548f93d4c1c56910b840cebe88d0c2" title="_usbrecv Request data from a USB device by first sending an output packet and then reading the respon..." alt="" coords="144,5,219,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9e813287cd0ee9c7b665002a929d2894"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int os_usbsend </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="includes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>out_msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>is_recv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
    <tr><td class="paramname">out_msg</td><td>the MSGSIZE char long buffer to send </td></tr>
    <tr><td class="paramname">is_recv</td><td>if true, just send an ioctl for further reading packets. If false, send the data at <b>out_msg</b>. </td></tr>
    <tr><td class="paramname">file</td><td>for debugging </td></tr>
    <tr><td class="paramname">line</td><td>for debugging </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>-1 on timeout (try again), 0 on hard error, numer of bytes sent otherwise</dd></dl>
<p>os_usbsend has two functions:</p>
<ul>
<li>if is_recv == false, it tries to send a given MSG_SIZE buffer via the usb interface given with kb.</li>
<li>otherwise a request is sent via the usb device to initiate the receiving of a message from the remote device.</li>
</ul>
<p>The functionality for sending distinguishes two cases, depending on the version number of the firmware of the connected device: <br/>
 If the firmware is less or equal 1.2, the transmission is done via an ioctl(). The ioctl() is given a struct usbdevfs_ctrltransfer, in which the relevant parameters are entered:</p>
<table class="doxtable">
<tr>
<th>bRequestType </th><th>bRequest </th><th>wValue </th><th>EP </th><th>size </th><th>Timeout </th><th>data  </th></tr>
<tr>
<td>0x21 </td><td>0x09 </td><td>0x0200 </td><td>endpoint / IF to be addressed from epcount-1 </td><td>MSG_SIZE </td><td>5000 (=5ms) </td><td>the message buffer pointer </td></tr>
<tr>
<td>Host to Device, Type=Class, Recipient=Interface </td><td>9 = Send data? </td><td>specific </td><td>last or pre-last device # </td><td>64 </td><td>5000 </td><td>out_msg </td></tr>
</table>
<p><br/>
 The ioctl command is USBDEVFS_CONTROL.</p>
<p>The same constellation is used if the device is requested to send its data (is_recv = true).</p>
<p>For a more recent firmware and is_recv = false, the ioctl command USBDEVFS_CONTROL is not used (this tells the bus to enter the control mode), but the bulk method is used: USBDEVFS_BULK. This is astonishing, because all of the endpoints are type Interrupt, not bulk.</p>
<p>Anyhow, forthis purpose a different structure is used for the ioctl() (struct <b>usbdevfs_bulktransfer</b>) and this is also initialized differently: <br/>
 The length and timeout parameters are given the same values as above. The formal parameter out_msg is also passed as a buffer pointer. For the endpoints, the firmware version is differentiated again: <br/>
 For a firmware version between 1.3 and &lt;2.0 endpoint 4 is used, otherwise (it can only be &gt;=2.0) endpoint 3 is used.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000012">Todo:</a></b></dt><dd>Since the handling of endpoints has already led to problems elsewhere, this implementation is extremely hardware-dependent and critical! <br/>
 Eg. the new keyboard K95PLATINUMRGB has a version number significantly less than 2.0 - will it run with this implementation?</dd></dl>
<p>The ioctl() - no matter what type - returns the number of bytes sent. Now comes the usual check:</p>
<ul>
<li>If the return value is -1 AND the error is a timeout (ETIMEOUT), <a class="el" href="usb__linux_8c.html#a9e813287cd0ee9c7b665002a929d2894" title="os_usbsend sends a data packet (MSG_SIZE = 64) Bytes long ">os_usbsend()</a> will return -1 to indicate that it is probably a recoverable problem and a retry is recommended.</li>
<li>For another negative value or other error identifier OR 0 bytes sent, 0 is returned as a heavy error identifier.</li>
<li>In all other cases, the function returns the number of bytes sent.</li>
</ul>
<p>If this is not the entire blocksize (MSG_SIZE bytes), an error message is issued on the standard error channel [warning "Wrote YY bytes (expected 64)"].</p>
<p>If DEBUG_USB is set during compilation, the number of bytes sent and their representation are logged to the error channel. </p>

<p>Definition at line <a class="el" href="usb__linux_8c_source.html#l00068">68</a> of file <a class="el" href="usb__linux_8c_source.html">usb_linux.c</a>.</p>

<p>References <a class="el" href="includes_8h_source.html#l00049">ckb_err_fn</a>, <a class="el" href="includes_8h_source.html#l00052">ckb_warn_fn</a>, <a class="el" href="structures_8h_source.html#l00215">usbdevice::epcount</a>, <a class="el" href="structures_8h_source.html#l00239">usbdevice::fwversion</a>, <a class="el" href="structures_8h_source.html#l00187">usbdevice::handle</a>, and <a class="el" href="structures_8h_source.html#l00176">MSG_SIZE</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00601">_usbrecv()</a>, and <a class="el" href="usb_8c_source.html#l00532">_usbsend()</a>.</p>
<div class="fragment"><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                                                                                            {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordtype">int</span> res;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">if</span>(kb-&gt;<a class="code" href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">fwversion</a> &gt;= 0x120 &amp;&amp; !is_recv){</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keyword">struct </span>usbdevfs_bulktransfer transfer;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        memset(&amp;transfer, 0, <span class="keyword">sizeof</span>(transfer));</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        transfer.ep = (kb-&gt;<a class="code" href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">fwversion</a> &gt;= 0x130 &amp;&amp; kb-&gt;<a class="code" href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">fwversion</a> &lt; 0x200) ? 4 : 3;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        transfer.len = <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        transfer.timeout = 5000;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        transfer.data = (<span class="keywordtype">void</span>*)out_msg;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        res = ioctl(kb-&gt;<a class="code" href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">handle</a> - 1, USBDEVFS_BULK, &amp;transfer);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keyword">struct </span>usbdevfs_ctrltransfer transfer = { 0x21, 0x09, 0x0200, kb-&gt;<a class="code" href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">epcount</a> - 1, <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>, 5000, (<span class="keywordtype">void</span>*)out_msg };</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        res = ioctl(kb-&gt;<a class="code" href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">handle</a> - 1, USBDEVFS_CONTROL, &amp;transfer);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span>(res &lt;= 0){</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <a class="code" href="includes_8h.html#a31d8dc974fcd529cb912ca80f05db462">ckb_err_fn</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, file, line, res ? strerror(errno) : <span class="stringliteral">&quot;No data written&quot;</span>);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">if</span>(res == -1 &amp;&amp; errno == ETIMEDOUT)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(res != <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <a class="code" href="includes_8h.html#a1e1f9c51b62903b645e69191280cfbab">ckb_warn_fn</a>(<span class="stringliteral">&quot;Wrote %d bytes (expected %d)\n&quot;</span>, file, line, res, <a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#ifdef DEBUG_USB</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">char</span> converted[<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>*3 + 1];</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a>;i++)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        sprintf(&amp;converted[i*3], <span class="stringliteral">&quot;%02x &quot;</span>, out_msg[i]);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="includes_8h.html#a1e1f9c51b62903b645e69191280cfbab">ckb_warn_fn</a>(<span class="stringliteral">&quot;Sent %s\n&quot;</span>, file, line, converted);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div>
<div class="ttc" id="structures_8h_html_ad4d025ecf1bdbf8b244ca688df8e478d"><div class="ttname"><a href="structures_8h.html#ad4d025ecf1bdbf8b244ca688df8e478d">MSG_SIZE</a></div><div class="ttdeci">#define MSG_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00176">structures.h:176</a></div></div>
<div class="ttc" id="structures_8h_html_a47e0bd130899bcf5acdef059f2970ac7"><div class="ttname"><a href="structures_8h.html#a47e0bd130899bcf5acdef059f2970ac7">usbdevice::fwversion</a></div><div class="ttdeci">ushort fwversion</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00239">structures.h:239</a></div></div>
<div class="ttc" id="structures_8h_html_a8d667681cbb0b3741476bf54c01e79b9"><div class="ttname"><a href="structures_8h.html#a8d667681cbb0b3741476bf54c01e79b9">usbdevice::epcount</a></div><div class="ttdeci">int epcount</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00215">structures.h:215</a></div></div>
<div class="ttc" id="includes_8h_html_a1e1f9c51b62903b645e69191280cfbab"><div class="ttname"><a href="includes_8h.html#a1e1f9c51b62903b645e69191280cfbab">ckb_warn_fn</a></div><div class="ttdeci">#define ckb_warn_fn(fmt, file, line, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00052">includes.h:52</a></div></div>
<div class="ttc" id="structures_8h_html_a1e1d8c37298aa076d30ba95dd97465ef"><div class="ttname"><a href="structures_8h.html#a1e1d8c37298aa076d30ba95dd97465ef">usbdevice::handle</a></div><div class="ttdeci">int handle</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00187">structures.h:187</a></div></div>
<div class="ttc" id="includes_8h_html_a31d8dc974fcd529cb912ca80f05db462"><div class="ttname"><a href="includes_8h.html#a31d8dc974fcd529cb912ca80f05db462">ckb_err_fn</a></div><div class="ttdeci">#define ckb_err_fn(fmt, file, line, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00049">includes.h:49</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-17" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a9e813287cd0ee9c7b665002a929d2894_icgraph.png" border="0" usemap="#usb_8h_a9e813287cd0ee9c7b665002a929d2894_icgraph" alt=""/></div>
<map name="usb_8h_a9e813287cd0ee9c7b665002a929d2894_icgraph" id="usb_8h_a9e813287cd0ee9c7b665002a929d2894_icgraph">
<area shape="rect" id="node2" href="usb_8h.html#a5a548f93d4c1c56910b840cebe88d0c2" title="_usbrecv Request data from a USB device by first sending an output packet and then reading the respon..." alt="" coords="149,5,224,32"/><area shape="rect" id="node3" href="usb_8h.html#a992cce1d173047466101113bfff5d7a1" title="_usbsend send a logical message completely to the given device " alt="" coords="147,56,226,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af87f830e031d8f63d2d1c3fc14fdad20"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* product_str </td>
          <td>(</td>
          <td class="paramtype">short&#160;</td>
          <td class="paramname"><em>product</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">product</td><td>is the <em>short</em> USB device product ID </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string to identify a type of device (see below)</dd></dl>
<p>product_str returns a condensed view on what type of device we have.</p>
<p>At present, various models and their properties are known from corsair products. Some models differ in principle (mice and keyboards), others differ in the way they function (for example, RGB and non RGB), but they are very similar.</p>
<p>Here, only the first point is taken into consideration and we return a unified model string. If the model is not known with its number, <em>product_str</em> returns an empty string.</p>
<p>The model numbers and corresponding strings wwith the numbers in hex-string are defined in <code><a class="el" href="usb_8h.html" title="Definitions for using USB interface. ">usb.h</a></code> </p>
<p>At present, this function is used to initialize <code>kb-&gt;name</code> and to give information in debug strings.</p>
<dl class="section attention"><dt>Attention</dt><dd>The combinations below have to fit to the combinations in the macros mentioned above. So if you add a device with a new number, change both.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>There are macros defined in <a class="el" href="usb_8h.html" title="Definitions for using USB interface. ">usb.h</a> to detect all the combinations below. the only difference is the parameter: The macros need the <em>kb*</em>, <a class="el" href="usb_8h.html#af87f830e031d8f63d2d1c3fc14fdad20" title="product_str returns a condensed view on what type of device we have. ">product_str()</a> needs the <em>product</em> <em>ID</em> </dd></dl>

<p>Definition at line <a class="el" href="usb_8c_source.html#l00070">70</a> of file <a class="el" href="usb_8c_source.html">usb.c</a>.</p>

<p>References <a class="el" href="usb_8h_source.html#l00041">P_K65</a>, <a class="el" href="usb_8h_source.html#l00045">P_K65_LUX</a>, <a class="el" href="usb_8h_source.html#l00043">P_K65_NRGB</a>, <a class="el" href="usb_8h_source.html#l00047">P_K65_RFIRE</a>, <a class="el" href="usb_8h_source.html#l00051">P_K70</a>, <a class="el" href="usb_8h_source.html#l00055">P_K70_LUX</a>, <a class="el" href="usb_8h_source.html#l00057">P_K70_LUX_NRGB</a>, <a class="el" href="usb_8h_source.html#l00053">P_K70_NRGB</a>, <a class="el" href="usb_8h_source.html#l00059">P_K70_RFIRE</a>, <a class="el" href="usb_8h_source.html#l00061">P_K70_RFIRE_NRGB</a>, <a class="el" href="usb_8h_source.html#l00065">P_K95</a>, <a class="el" href="usb_8h_source.html#l00067">P_K95_NRGB</a>, <a class="el" href="usb_8h_source.html#l00069">P_K95_PLATINUM</a>, <a class="el" href="usb_8h_source.html#l00079">P_M65</a>, <a class="el" href="usb_8h_source.html#l00081">P_M65_PRO</a>, <a class="el" href="usb_8h_source.html#l00087">P_SABRE_L</a>, <a class="el" href="usb_8h_source.html#l00089">P_SABRE_N</a>, <a class="el" href="usb_8h_source.html#l00085">P_SABRE_O</a>, <a class="el" href="usb_8h_source.html#l00091">P_SABRE_O2</a>, <a class="el" href="usb_8h_source.html#l00095">P_SCIMITAR</a>, <a class="el" href="usb_8h_source.html#l00097">P_SCIMITAR_PRO</a>, <a class="el" href="usb_8h_source.html#l00073">P_STRAFE</a>, and <a class="el" href="usb_8h_source.html#l00075">P_STRAFE_NRGB</a>.</p>

<p>Referenced by <a class="el" href="devnode_8c_source.html#l00136">_mkdevpath()</a>, and <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                                      {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">if</span>(product == <a class="code" href="usb_8h.html#a5f5e9b029c7eec8f6c491d73f0499bb5">P_K95</a> || product == <a class="code" href="usb_8h.html#ae8d1cf4b55023aae2b72ee607e214f84">P_K95_NRGB</a> || product == <a class="code" href="usb_8h.html#ab034dbd57f7ab5666729ce7e27d3e0b9">P_K95_PLATINUM</a>)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;k95&quot;</span>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">if</span>(product == <a class="code" href="usb_8h.html#a3133fa57f7b2d7c888ffafeadc4476ab">P_K70</a> || product == <a class="code" href="usb_8h.html#a7fea7ba58b4bb6a7def7c380ab695110">P_K70_NRGB</a> || product == <a class="code" href="usb_8h.html#a3fc42f14fec81381ff8251ca6a85b363">P_K70_LUX</a> || product == <a class="code" href="usb_8h.html#aa0f89f20ca96ad159330a8d071a45352">P_K70_LUX_NRGB</a> || product == <a class="code" href="usb_8h.html#a07e80868f8a95b9f8a2e85636833d45d">P_K70_RFIRE</a> || product == <a class="code" href="usb_8h.html#abb58ca12d172afdf2b5469266c0c9af8">P_K70_RFIRE_NRGB</a>)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;k70&quot;</span>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">if</span>(product == <a class="code" href="usb_8h.html#affc75c5e028c467b9a294360b8a66a17">P_K65</a> || product == <a class="code" href="usb_8h.html#a300ce7bf9091c9da9ebcb83600f13faa">P_K65_NRGB</a> || product == <a class="code" href="usb_8h.html#a976d0683dbfa2225bf40016d151f70d3">P_K65_LUX</a> || product == <a class="code" href="usb_8h.html#ae6a26ad33235021f82ada9c503e5661a">P_K65_RFIRE</a>)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;k65&quot;</span>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">if</span>(product == <a class="code" href="usb_8h.html#a26adb1ffc39cb46e583a236b14af9ace">P_STRAFE</a> || product == <a class="code" href="usb_8h.html#a3e6f75a59f49265384d17e5d65b054e0">P_STRAFE_NRGB</a>)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;strafe&quot;</span>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">if</span>(product == <a class="code" href="usb_8h.html#a26cd43fb89a7329b7043cb962a12383b">P_M65</a> || product == <a class="code" href="usb_8h.html#a427ec77ae3e03646e7ac0a66516d39cb">P_M65_PRO</a>)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;m65&quot;</span>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span>(product == <a class="code" href="usb_8h.html#a0aa0f45f25df01bcee4abc96455e1138">P_SABRE_O</a> || product == <a class="code" href="usb_8h.html#a73e75008beef075e40fa5195d9c70bfe">P_SABRE_L</a> || product == <a class="code" href="usb_8h.html#a5b8bcefef6848c2e7889ecda124c8192">P_SABRE_N</a> || product == <a class="code" href="usb_8h.html#a294da39a7f6b6d23ff74b170b9423b4e">P_SABRE_O2</a>)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;sabre&quot;</span>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span>(product == <a class="code" href="usb_8h.html#af8ce90b65c8c9756870acd26a24054fc">P_SCIMITAR</a> || product == <a class="code" href="usb_8h.html#ab76215820c9c39d5438ed28b4e8d8110">P_SCIMITAR_PRO</a>)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;scimitar&quot;</span>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;}</div>
<div class="ttc" id="usb_8h_html_abb58ca12d172afdf2b5469266c0c9af8"><div class="ttname"><a href="usb_8h.html#abb58ca12d172afdf2b5469266c0c9af8">P_K70_RFIRE_NRGB</a></div><div class="ttdeci">#define P_K70_RFIRE_NRGB</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00061">usb.h:61</a></div></div>
<div class="ttc" id="usb_8h_html_ab034dbd57f7ab5666729ce7e27d3e0b9"><div class="ttname"><a href="usb_8h.html#ab034dbd57f7ab5666729ce7e27d3e0b9">P_K95_PLATINUM</a></div><div class="ttdeci">#define P_K95_PLATINUM</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00069">usb.h:69</a></div></div>
<div class="ttc" id="usb_8h_html_a976d0683dbfa2225bf40016d151f70d3"><div class="ttname"><a href="usb_8h.html#a976d0683dbfa2225bf40016d151f70d3">P_K65_LUX</a></div><div class="ttdeci">#define P_K65_LUX</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00045">usb.h:45</a></div></div>
<div class="ttc" id="usb_8h_html_a5f5e9b029c7eec8f6c491d73f0499bb5"><div class="ttname"><a href="usb_8h.html#a5f5e9b029c7eec8f6c491d73f0499bb5">P_K95</a></div><div class="ttdeci">#define P_K95</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00065">usb.h:65</a></div></div>
<div class="ttc" id="usb_8h_html_a5b8bcefef6848c2e7889ecda124c8192"><div class="ttname"><a href="usb_8h.html#a5b8bcefef6848c2e7889ecda124c8192">P_SABRE_N</a></div><div class="ttdeci">#define P_SABRE_N</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00089">usb.h:89</a></div></div>
<div class="ttc" id="usb_8h_html_a0aa0f45f25df01bcee4abc96455e1138"><div class="ttname"><a href="usb_8h.html#a0aa0f45f25df01bcee4abc96455e1138">P_SABRE_O</a></div><div class="ttdeci">#define P_SABRE_O</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00085">usb.h:85</a></div></div>
<div class="ttc" id="usb_8h_html_affc75c5e028c467b9a294360b8a66a17"><div class="ttname"><a href="usb_8h.html#affc75c5e028c467b9a294360b8a66a17">P_K65</a></div><div class="ttdeci">#define P_K65</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00041">usb.h:41</a></div></div>
<div class="ttc" id="usb_8h_html_a7fea7ba58b4bb6a7def7c380ab695110"><div class="ttname"><a href="usb_8h.html#a7fea7ba58b4bb6a7def7c380ab695110">P_K70_NRGB</a></div><div class="ttdeci">#define P_K70_NRGB</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00053">usb.h:53</a></div></div>
<div class="ttc" id="usb_8h_html_a26cd43fb89a7329b7043cb962a12383b"><div class="ttname"><a href="usb_8h.html#a26cd43fb89a7329b7043cb962a12383b">P_M65</a></div><div class="ttdeci">#define P_M65</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00079">usb.h:79</a></div></div>
<div class="ttc" id="usb_8h_html_a26adb1ffc39cb46e583a236b14af9ace"><div class="ttname"><a href="usb_8h.html#a26adb1ffc39cb46e583a236b14af9ace">P_STRAFE</a></div><div class="ttdeci">#define P_STRAFE</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00073">usb.h:73</a></div></div>
<div class="ttc" id="usb_8h_html_a73e75008beef075e40fa5195d9c70bfe"><div class="ttname"><a href="usb_8h.html#a73e75008beef075e40fa5195d9c70bfe">P_SABRE_L</a></div><div class="ttdeci">#define P_SABRE_L</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00087">usb.h:87</a></div></div>
<div class="ttc" id="usb_8h_html_a427ec77ae3e03646e7ac0a66516d39cb"><div class="ttname"><a href="usb_8h.html#a427ec77ae3e03646e7ac0a66516d39cb">P_M65_PRO</a></div><div class="ttdeci">#define P_M65_PRO</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00081">usb.h:81</a></div></div>
<div class="ttc" id="usb_8h_html_a07e80868f8a95b9f8a2e85636833d45d"><div class="ttname"><a href="usb_8h.html#a07e80868f8a95b9f8a2e85636833d45d">P_K70_RFIRE</a></div><div class="ttdeci">#define P_K70_RFIRE</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00059">usb.h:59</a></div></div>
<div class="ttc" id="usb_8h_html_a300ce7bf9091c9da9ebcb83600f13faa"><div class="ttname"><a href="usb_8h.html#a300ce7bf9091c9da9ebcb83600f13faa">P_K65_NRGB</a></div><div class="ttdeci">#define P_K65_NRGB</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00043">usb.h:43</a></div></div>
<div class="ttc" id="usb_8h_html_ab76215820c9c39d5438ed28b4e8d8110"><div class="ttname"><a href="usb_8h.html#ab76215820c9c39d5438ed28b4e8d8110">P_SCIMITAR_PRO</a></div><div class="ttdeci">#define P_SCIMITAR_PRO</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00097">usb.h:97</a></div></div>
<div class="ttc" id="usb_8h_html_a3133fa57f7b2d7c888ffafeadc4476ab"><div class="ttname"><a href="usb_8h.html#a3133fa57f7b2d7c888ffafeadc4476ab">P_K70</a></div><div class="ttdeci">#define P_K70</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00051">usb.h:51</a></div></div>
<div class="ttc" id="usb_8h_html_ae8d1cf4b55023aae2b72ee607e214f84"><div class="ttname"><a href="usb_8h.html#ae8d1cf4b55023aae2b72ee607e214f84">P_K95_NRGB</a></div><div class="ttdeci">#define P_K95_NRGB</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00067">usb.h:67</a></div></div>
<div class="ttc" id="usb_8h_html_a294da39a7f6b6d23ff74b170b9423b4e"><div class="ttname"><a href="usb_8h.html#a294da39a7f6b6d23ff74b170b9423b4e">P_SABRE_O2</a></div><div class="ttdeci">#define P_SABRE_O2</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00091">usb.h:91</a></div></div>
<div class="ttc" id="usb_8h_html_a3e6f75a59f49265384d17e5d65b054e0"><div class="ttname"><a href="usb_8h.html#a3e6f75a59f49265384d17e5d65b054e0">P_STRAFE_NRGB</a></div><div class="ttdeci">#define P_STRAFE_NRGB</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00075">usb.h:75</a></div></div>
<div class="ttc" id="usb_8h_html_a3fc42f14fec81381ff8251ca6a85b363"><div class="ttname"><a href="usb_8h.html#a3fc42f14fec81381ff8251ca6a85b363">P_K70_LUX</a></div><div class="ttdeci">#define P_K70_LUX</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00055">usb.h:55</a></div></div>
<div class="ttc" id="usb_8h_html_aa0f89f20ca96ad159330a8d071a45352"><div class="ttname"><a href="usb_8h.html#aa0f89f20ca96ad159330a8d071a45352">P_K70_LUX_NRGB</a></div><div class="ttdeci">#define P_K70_LUX_NRGB</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00057">usb.h:57</a></div></div>
<div class="ttc" id="usb_8h_html_af8ce90b65c8c9756870acd26a24054fc"><div class="ttname"><a href="usb_8h.html#af8ce90b65c8c9756870acd26a24054fc">P_SCIMITAR</a></div><div class="ttdeci">#define P_SCIMITAR</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00095">usb.h:95</a></div></div>
<div class="ttc" id="usb_8h_html_ae6a26ad33235021f82ada9c503e5661a"><div class="ttname"><a href="usb_8h.html#ae6a26ad33235021f82ada9c503e5661a">P_K65_RFIRE</a></div><div class="ttdeci">#define P_K65_RFIRE</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00047">usb.h:47</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-18" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_af87f830e031d8f63d2d1c3fc14fdad20_icgraph.png" border="0" usemap="#usb_8h_af87f830e031d8f63d2d1c3fc14fdad20_icgraph" alt=""/></div>
<map name="usb_8h_af87f830e031d8f63d2d1c3fc14fdad20_icgraph" id="usb_8h_af87f830e031d8f63d2d1c3fc14fdad20_icgraph">
<area shape="rect" id="node2" href="devnode_8c.html#a81c81014b2dfa89e326dd61769842953" title="_mkdevpath" alt="" coords="141,5,235,32"/><area shape="rect" id="node4" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . " alt="" coords="419,56,501,83"/><area shape="rect" id="node3" href="devnode_8h.html#a0c3d1e3cd90f43a9b5ee0793f4a75041" title="Create a dev path for the keyboard at index. Returns 0 on success. " alt="" coords="283,5,370,32"/><area shape="rect" id="node10" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1208,31,1259,57"/><area shape="rect" id="node5" href="usb_8h.html#a1ab9d61dd894466125283465201161cd" title="setupusb starts a thread with kb as parameter and _setupusb() as entrypoint. " alt="" coords="549,56,624,83"/><area shape="rect" id="node6" href="usb__linux_8c.html#a3185d6da36c8b0f8b862a8479ae82034" title="usbadd" alt="" coords="672,56,736,83"/><area shape="rect" id="node7" href="usb__linux_8c.html#a50efc8ee0ffcb6f201735d1a3bb08779" title="Add a udev device. Returns 0 if device was recognized/added. " alt="" coords="785,56,901,83"/><area shape="rect" id="node8" href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea" title="udev_enum use the udev_enumerate_add_match_subsystem() to get all you need but only that..." alt="" coords="950,56,1039,83"/><area shape="rect" id="node9" href="usb__linux_8c.html#a0859efad3739abe2ec61af4f3bb983ff" title="usbmain" alt="" coords="1089,56,1159,83"/><area shape="rect" id="node11" href="notify_8c.html#ae246359e104d63520158c26329caac80" title="restart" alt="" coords="1307,31,1365,57"/><area shape="rect" id="node12" href="notify_8h.html#a700b520b9eb9a3698af8f8ebf547a9ab" title="cmd_restart" alt="" coords="1413,31,1504,57"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae30a52968bb209e98461f48ffb2ee82f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int revertusb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success or if device needs firmware upgrade, -1 otherwise</dd></dl>
<p>revertusb sets a given device to inactive (hardware controlled) mode if not a fw-ugrade is indicated</p>
<p>First is checked, whether a firmware-upgrade is indicated for the device. If so, <a class="el" href="usb_8h.html#ae30a52968bb209e98461f48ffb2ee82f" title="revertusb sets a given device to inactive (hardware controlled) mode if not a fw-ugrade is indicated ...">revertusb()</a> returns 0. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>Why is this useful? Are there problems seen with deactivating a device with older fw-version??? Why isn't this an error indicating reason and we return success (0)?</dd></dl>
<p>Anyway, the following steps are similar to some other procs, dealing with low level usb handling:</p>
<ul>
<li>If we do not have an RGB device, a simple setting to Hardware-mode (NK95_HWON) is sent to the device via n95cmd(). <dl class="todo"><dt><b><a class="el" href="todo.html#_todo000007">Todo:</a></b></dt><dd>The return value of <a class="el" href="usb_8h.html#aefc95e6120686dff0e06bba32ca21ad1" title="nk95cmd() macro is used to wrap _nk95cmd() with debugging information (file and lineno). the command structure is different:   Just the bits 23..16 are used as bits 7..0 for bRequest   Bits 15..0 are used as wValue ">nk95cmd()</a> is ignored (but sending the ioctl may produce an error and _nk95_cmd will indicate this), instead <a class="el" href="usb_8h.html#ae30a52968bb209e98461f48ffb2ee82f" title="revertusb sets a given device to inactive (hardware controlled) mode if not a fw-ugrade is indicated ...">revertusb()</a> returns success in any case.</dd></dl>
</li>
<li>If we have an RGB device, <a class="el" href="device_8h.html#afc841d1137ff44e8a225208262d97fae" title="setactive() calls via the corresponding kb-&gt;vtable either the active() or the idle() function...">setactive()</a> is called with second param active = false. That function will have a look on differences between keyboards and mice. <br/>
 More precisely <a class="el" href="device_8h.html#afc841d1137ff44e8a225208262d97fae" title="setactive() calls via the corresponding kb-&gt;vtable either the active() or the idle() function...">setactive()</a> is just a macro to call via the kb-&gt;vtable enties either the active() or the idle() function where the vtable points to. <a class="el" href="device_8h.html#afc841d1137ff44e8a225208262d97fae" title="setactive() calls via the corresponding kb-&gt;vtable either the active() or the idle() function...">setactive()</a> may return error indications. If so, <a class="el" href="usb_8h.html#ae30a52968bb209e98461f48ffb2ee82f" title="revertusb sets a given device to inactive (hardware controlled) mode if not a fw-ugrade is indicated ...">revertusb()</a> returns -1, otherwise 0 in any other case. </li>
</ul>

<p>Definition at line <a class="el" href="usb_8c_source.html#l00407">407</a> of file <a class="el" href="usb_8c_source.html">usb.c</a>.</p>

<p>References <a class="el" href="structures_8h_source.html#l00136">FEAT_RGB</a>, <a class="el" href="structures_8h_source.html#l00157">HAS_FEATURES</a>, <a class="el" href="structures_8h_source.html#l00161">NEEDS_FW_UPDATE</a>, <a class="el" href="usb_8h_source.html#l00302">NK95_HWON</a>, <a class="el" href="usb_8h_source.html#l00294">nk95cmd</a>, and <a class="el" href="device_8h_source.html#l00040">setactive</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00040">quitWithLock()</a>.</p>
<div class="fragment"><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                            {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structures_8h.html#ac041871a5605e5dbcd73c3671ef2a8bc">NEEDS_FW_UPDATE</a>(kb))</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="structures_8h.html#ac5ce9f3f886e327076d6fa5393e7aa69">HAS_FEATURES</a>(kb, <a class="code" href="structures_8h.html#ae84210929bc758f0da372e723d002f8e">FEAT_RGB</a>)){</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <a class="code" href="usb_8h.html#aefc95e6120686dff0e06bba32ca21ad1">nk95cmd</a>(kb, <a class="code" href="usb_8h.html#af4d21ffe463251f15ed249be2531d8c7">NK95_HWON</a>);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="device_8h.html#afc841d1137ff44e8a225208262d97fae">setactive</a>(kb, 0))</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;}</div>
<div class="ttc" id="usb_8h_html_aefc95e6120686dff0e06bba32ca21ad1"><div class="ttname"><a href="usb_8h.html#aefc95e6120686dff0e06bba32ca21ad1">nk95cmd</a></div><div class="ttdeci">#define nk95cmd(kb, command)</div><div class="ttdoc">nk95cmd() macro is used to wrap _nk95cmd() with debugging information (file and lineno). the command structure is different:   Just the bits 23..16 are used as bits 7..0 for bRequest   Bits 15..0 are used as wValue </div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00294">usb.h:294</a></div></div>
<div class="ttc" id="structures_8h_html_ae84210929bc758f0da372e723d002f8e"><div class="ttname"><a href="structures_8h.html#ae84210929bc758f0da372e723d002f8e">FEAT_RGB</a></div><div class="ttdeci">#define FEAT_RGB</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00136">structures.h:136</a></div></div>
<div class="ttc" id="usb_8h_html_af4d21ffe463251f15ed249be2531d8c7"><div class="ttname"><a href="usb_8h.html#af4d21ffe463251f15ed249be2531d8c7">NK95_HWON</a></div><div class="ttdeci">#define NK95_HWON</div><div class="ttdoc">Hardware playback on. </div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00302">usb.h:302</a></div></div>
<div class="ttc" id="structures_8h_html_ac041871a5605e5dbcd73c3671ef2a8bc"><div class="ttname"><a href="structures_8h.html#ac041871a5605e5dbcd73c3671ef2a8bc">NEEDS_FW_UPDATE</a></div><div class="ttdeci">#define NEEDS_FW_UPDATE(kb)</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00161">structures.h:161</a></div></div>
<div class="ttc" id="structures_8h_html_ac5ce9f3f886e327076d6fa5393e7aa69"><div class="ttname"><a href="structures_8h.html#ac5ce9f3f886e327076d6fa5393e7aa69">HAS_FEATURES</a></div><div class="ttdeci">#define HAS_FEATURES(kb, feat)</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00157">structures.h:157</a></div></div>
<div class="ttc" id="device_8h_html_afc841d1137ff44e8a225208262d97fae"><div class="ttname"><a href="device_8h.html#afc841d1137ff44e8a225208262d97fae">setactive</a></div><div class="ttdeci">#define setactive(kb, makeactive)</div><div class="ttdoc">setactive() calls via the corresponding kb-&gt;vtable either the active() or the idle() function...</div><div class="ttdef"><b>Definition:</b> <a href="device_8h_source.html#l00040">device.h:40</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-19" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-19-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_ae30a52968bb209e98461f48ffb2ee82f_icgraph.png" border="0" usemap="#usb_8h_ae30a52968bb209e98461f48ffb2ee82f_icgraph" alt=""/></div>
<map name="usb_8h_ae30a52968bb209e98461f48ffb2ee82f_icgraph" id="usb_8h_ae30a52968bb209e98461f48ffb2ee82f_icgraph">
<area shape="rect" id="node2" href="main_8c.html#a24a012c29e291fef5fa13f4a07fffd33" title="quitWithLock " alt="" coords="131,47,229,74"/><area shape="rect" id="node3" href="main_8c.html#acd1527386a48875050e637e4bb872f11" title="quit Stop working the daemon. function is called if the daemon received a sigterm In this case..." alt="" coords="277,22,320,49"/><area shape="rect" id="node5" href="notify_8c.html#ae246359e104d63520158c26329caac80" title="restart" alt="" coords="597,22,656,49"/><area shape="rect" id="node4" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="499,22,549,49"/><area shape="rect" id="node7" href="main_8c.html#a05f9b9989842b986a26caf9e4c66a4c7" title="sighandler" alt="" coords="369,22,450,49"/><area shape="rect" id="node6" href="notify_8h.html#a700b520b9eb9a3698af8f8ebf547a9ab" title="cmd_restart" alt="" coords="704,22,795,49"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1ab9d61dd894466125283465201161cd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setupusb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section attention"><dt>Attention</dt><dd>Lock a device's dmutex (see <a class="el" href="device_8h.html">device.h</a>) before accessing the USB interface.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kb</td><td>THE usbdevice* used everywhere </td></tr>
    <tr><td class="paramname">OUT]</td><td>kb-&gt;thread is used to store the thread ID of the fresh created thread.</td></tr>
  </table>
  </dd>
</dl>
<p>setupusb starts a thread with kb as parameter and <a class="el" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . ">_setupusb()</a> as entrypoint.</p>
<p>Set up a USB device after its handle is open. Spawns a new thread <a class="el" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . ">_setupusb()</a> with standard parameter kb. dmutex must be locked prior to calling this function. The function will unlock it when finished. In kb-&gt;thread the thread id is mentioned, because <a class="el" href="usb_8h.html#a8732b3ade76da4ae362996232ef95431" title="closeusb Close a USB device and remove device entry. ">closeusb()</a> needs this info for joining that thread again. </p>

<p>Definition at line <a class="el" href="usb_8c_source.html#l00386">386</a> of file <a class="el" href="usb_8c_source.html">usb.c</a>.</p>

<p>References <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>, <a class="el" href="includes_8h_source.html#l00050">ckb_err</a>, <a class="el" href="device_8h_source.html#l00022">imutex</a>, and <a class="el" href="structures_8h_source.html#l00217">usbdevice::thread</a>.</p>

<p>Referenced by <a class="el" href="usb__linux_8c_source.html#l00581">usbadd()</a>.</p>
<div class="fragment"><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                            {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    pthread_mutex_lock(<a class="code" href="device_8h.html#aa87bd893f7d4bd0700cb699c88dd860b">imutex</a>(kb));</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">if</span>(pthread_create(&amp;kb-&gt;<a class="code" href="structures_8h.html#a66ae3ceabd662fd1b7ee8352f303202c">thread</a>, 0, <a class="code" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac">_setupusb</a>, kb))</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <a class="code" href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a>(<span class="stringliteral">&quot;Failed to create USB thread\n&quot;</span>);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;}</div>
<div class="ttc" id="includes_8h_html_a8312a1a42e03986afb7c76557f4d3e25"><div class="ttname"><a href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a></div><div class="ttdeci">#define ckb_err(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00050">includes.h:50</a></div></div>
<div class="ttc" id="usb_8c_html_a10ad381abfe51e67e341c882c92bb9ac"><div class="ttname"><a href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac">_setupusb</a></div><div class="ttdeci">static void * _setupusb(void *context)</div><div class="ttdoc">brief . </div><div class="ttdef"><b>Definition:</b> <a href="usb_8c_source.html#l00214">usb.c:214</a></div></div>
<div class="ttc" id="device_8h_html_aa87bd893f7d4bd0700cb699c88dd860b"><div class="ttname"><a href="device_8h.html#aa87bd893f7d4bd0700cb699c88dd860b">imutex</a></div><div class="ttdeci">#define imutex(kb)</div><div class="ttdef"><b>Definition:</b> <a href="device_8h_source.html#l00022">device.h:22</a></div></div>
<div class="ttc" id="structures_8h_html_a66ae3ceabd662fd1b7ee8352f303202c"><div class="ttname"><a href="structures_8h.html#a66ae3ceabd662fd1b7ee8352f303202c">usbdevice::thread</a></div><div class="ttdeci">pthread_t thread</div><div class="ttdef"><b>Definition:</b> <a href="structures_8h_source.html#l00217">structures.h:217</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-20" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-20-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-20-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-20-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a1ab9d61dd894466125283465201161cd_cgraph.png" border="0" usemap="#usb_8h_a1ab9d61dd894466125283465201161cd_cgraph" alt=""/></div>
<map name="usb_8h_a1ab9d61dd894466125283465201161cd_cgraph" id="usb_8h_a1ab9d61dd894466125283465201161cd_cgraph">
<area shape="rect" id="node2" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . " alt="" coords="128,537,211,564"/><area shape="rect" id="node3" href="usb_8c.html#a8732b3ade76da4ae362996232ef95431" title="closeusb" alt="" coords="472,107,547,133"/><area shape="rect" id="node10" href="devnode_8c.html#a4f2642e0c38280a1516fbe153c9fa18f" title="Update the list of connected devices. " alt="" coords="631,259,753,285"/><area shape="rect" id="node12" href="usb_8c.html#ab8c22b4f7012c6d9fe1a0d5e2a93df65" title="brief . " alt="" coords="289,233,359,260"/><area shape="rect" id="node20" href="usb_8c.html#a25ded61622ec9349905b5aa2ed2cb48b" title="brief . " alt="" coords="283,563,365,589"/><area shape="rect" id="node21" href="devnode_8c.html#a0c3d1e3cd90f43a9b5ee0793f4a75041" title="Create a dev path for the keyboard at index. Returns 0 on success. " alt="" coords="281,411,367,437"/><area shape="rect" id="node24" href="usb_8c.html#af87f830e031d8f63d2d1c3fc14fdad20" title="brief . " alt="" coords="649,512,735,539"/><area shape="rect" id="node25" href="usb_8c.html#a8e6389e8183a834fedb6ed317dd26f94" title="brief . " alt="" coords="651,563,733,589"/><area shape="rect" id="node26" href="usb_8h.html#a9e5784bfca2e4612f498ce67c7dab275" title="os_inputmain is run in a separate thread and will be detached from the main thread, so it needs to clean up its own resources. " alt="" coords="275,639,373,665"/><area shape="rect" id="node39" href="input_8h.html#ac73b3c2c38b916b901b4cca6b350a863" title="os_inputopen " alt="" coords="275,752,373,779"/><area shape="rect" id="node41" href="input_8h.html#a081bbacaa312d4a1a63bc1cab5d3520f" title="os_setupindicators" alt="" coords="259,835,389,861"/><area shape="rect" id="node43" href="usb_8h.html#a39442715182933b93172de60cdb66e8f" title="os_setupusb OS&#45;specific setup for a specific usb device. " alt="" coords="276,901,372,928"/><area shape="rect" id="node46" href="usb_8c.html#a8a1c88df5e127732cb63f1a8be180926" title="usb_tryreset" alt="" coords="277,952,371,979"/><area shape="rect" id="node4" href="usb_8h.html#a6a62575e9073fae15efb58f24fbfe5b8" title="os_closeusb unclaim it, destroy the udev device and clear data structures at kb " alt="" coords="645,56,739,83"/><area shape="rect" id="node6" href="input_8h.html#a44df5105a6a3f2eda5bc39a88201bd1a" title="os_inputclose" alt="" coords="641,5,743,32"/><area shape="rect" id="node7" href="devnode_8c.html#a8d0aeeebb364608943b78573adb85c7f" title="Remove the dev path for the keyboard at index. Returns 0 on success. " alt="" coords="651,107,733,133"/><area shape="rect" id="node5" href="usb__linux_8c.html#afe1111f494da4776633be32fecaba44b" title="usbunclaim" alt="" coords="823,56,911,83"/><area shape="rect" id="node8" href="devnode_8c.html#a9d97ede033e4f6c6bdd1c66fc82aa15e" title="_rmnotifynode" alt="" coords="815,132,919,159"/><area shape="rect" id="node9" href="devnode_8c.html#aac8f6f936a0ff6c16adc677622b226c4" title="rm_recursive" alt="" coords="818,233,915,260"/><area shape="rect" id="node11" href="devnode_8c.html#acc36eaba5eb854461ab3c0a4d146e9c9" title="_updateconnected Update the list of connected devices. " alt="" coords="803,417,931,444"/><area shape="rect" id="node13" href="command_8c.html#ad7239680e0942b0b85a6cd3e9fff25a9" title="readcmd" alt="" coords="473,157,545,184"/><area shape="rect" id="node17" href="devnode_8c.html#a1062ed70d4ea0310fbf5eeee928b58b7" title="readlines" alt="" coords="472,309,547,336"/><area shape="rect" id="node18" href="devnode_8c.html#a588ab2c69fcb283a5beb90c49a165979" title="readlines_ctx_free" alt="" coords="445,208,573,235"/><area shape="rect" id="node19" href="devnode_8c.html#ac118005c75badc2028b4921be8d9bdd0" title="readlines_ctx_init" alt="" coords="448,259,571,285"/><area shape="rect" id="node14" href="devnode_8c.html#a981305884de053a41d337efac23900ec" title="Creates a notification node for the specified keyboard. " alt="" coords="642,208,742,235"/><area shape="rect" id="node16" href="devnode_8c.html#a40e40a8ea3edccbfd8fdfefc44a76206" title="Removes a notification node for the specified keyboard. " alt="" coords="643,157,741,184"/><area shape="rect" id="node15" href="devnode_8c.html#a38fcf6ff044f9249ae04234340ee8e7b" title="_mknotifynode" alt="" coords="813,323,920,349"/><area shape="rect" id="node22" href="devnode_8c.html#a81c81014b2dfa89e326dd61769842953" title="_mkdevpath" alt="" coords="463,411,556,437"/><area shape="rect" id="node23" href="devnode_8c.html#ad130425a617cf973b28603a72607a057" title="Writes a keyboard&#39;s firmware version and poll rate to its device node. " alt="" coords="651,411,733,437"/><area shape="rect" id="node27" href="keymap_8c.html#ad39ede76abd657f5123fa331853db017" title="corsair_kbcopy" alt="" coords="454,765,565,792"/><area shape="rect" id="node28" href="keymap_8c.html#a0dc9a16564cc51b35a35d28af1a96fb0" title="corsair_mousecopy" alt="" coords="442,563,577,589"/><area shape="rect" id="node29" href="keymap_8c.html#a6f4afd134546237416b271d9cefd2889" title="hid_kb_translate" alt="" coords="451,613,568,640"/><area shape="rect" id="node30" href="keymap_8c.html#a092f675ff366b5823c73b25f83d513f9" title="hid_mouse_translate" alt="" coords="438,664,581,691"/><area shape="rect" id="node31" href="input_8c.html#ae360d0b9a764a1d38c5be5464be8b70a" title="inputupdate" alt="" coords="465,715,554,741"/><area shape="rect" id="node32" href="input_8c.html#aed8e9842ed5750c1d328c5dc4c1ba2bd" title="inputupdate_keys" alt="" coords="630,689,754,716"/><area shape="rect" id="node38" href="input_8h.html#a9f2cfb2d883ae4a3732047fe3f3da683" title="os_mousemove" alt="" coords="809,740,924,767"/><area shape="rect" id="node33" href="input_8c.html#abd38419ce56379559481f51d9491adeb" title="macromask" alt="" coords="821,588,912,615"/><area shape="rect" id="node34" href="notify_8c.html#ac2411c0997dfdbefdebd45f2584a5d04" title="nprintkey" alt="" coords="829,639,904,665"/><area shape="rect" id="node36" href="input_8h.html#af0d3401f317f3214dadad7d1a3378c58" title="os_keypress" alt="" coords="819,689,915,716"/><area shape="rect" id="node35" href="notify_8c.html#a7ac88f15243030290e4d57c3c9ac7c98" title="nprintf" alt="" coords="979,639,1037,665"/><area shape="rect" id="node37" href="input__linux_8c.html#a14ff0fdf147e3702197db2cadb878460" title="isync" alt="" coords="981,715,1035,741"/><area shape="rect" id="node40" href="input__linux_8c.html#a5f050529d49f8cb5e8dda4617c5984b7" title="uinputopen" alt="" coords="467,816,552,843"/><area shape="rect" id="node42" href="input__linux_8c.html#a5d40cc9137eaefbc2d860fac76020460" title="_ledthread" alt="" coords="468,867,551,893"/><area shape="rect" id="node44" href="usb__linux_8c.html#ab694a2ac859b16b5af802b4484f5ba0b" title="strtrim" alt="" coords="480,917,539,944"/><area shape="rect" id="node45" href="usb__linux_8c.html#a309cab8bf65221b01dc320f247abf626" title="usbclaim" alt="" coords="472,968,547,995"/></map>
</div>
</p>

<p><div id="dynsection-21" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-21-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-21-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-21-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a1ab9d61dd894466125283465201161cd_icgraph.png" border="0" usemap="#usb_8h_a1ab9d61dd894466125283465201161cd_icgraph" alt=""/></div>
<map name="usb_8h_a1ab9d61dd894466125283465201161cd_icgraph" id="usb_8h_a1ab9d61dd894466125283465201161cd_icgraph">
<area shape="rect" id="node2" href="usb__linux_8c.html#a3185d6da36c8b0f8b862a8479ae82034" title="usbadd" alt="" coords="128,31,192,57"/><area shape="rect" id="node3" href="usb__linux_8c.html#a50efc8ee0ffcb6f201735d1a3bb08779" title="Add a udev device. Returns 0 if device was recognized/added. " alt="" coords="241,31,357,57"/><area shape="rect" id="node4" href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea" title="udev_enum use the udev_enumerate_add_match_subsystem() to get all you need but only that..." alt="" coords="406,5,495,32"/><area shape="rect" id="node5" href="usb__linux_8c.html#a0859efad3739abe2ec61af4f3bb983ff" title="usbmain" alt="" coords="545,31,615,57"/><area shape="rect" id="node6" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="664,31,715,57"/><area shape="rect" id="node7" href="notify_8c.html#ae246359e104d63520158c26329caac80" title="restart" alt="" coords="763,31,821,57"/><area shape="rect" id="node8" href="notify_8h.html#a700b520b9eb9a3698af8f8ebf547a9ab" title="cmd_restart" alt="" coords="869,31,960,57"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8a1c88df5e127732cb63f1a8be180926"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int usb_tryreset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#structusbdevice">usbdevice</a> *&#160;</td>
          <td class="paramname"><em>kb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">kb</td><td>THE usbdevice* </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reset_stop</td><td>global variable is read </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 otherwise</dd></dl>
<p>usb_tryreset does what the name means: Try to reset the usb via <a class="el" href="usb_8h.html#ae1550dc55de346b46df8c4b6930613e9" title="resetusb() is just a macro to call _resetusb() with debuggin constants (file, lineno) ...">resetusb()</a></p>
<p>This function is called if an usb command ran into an error in case of one of the following two situations:</p>
<ul>
<li>When setting up a new usb device and the start() function got an error (<dl class="section see"><dt>See Also</dt><dd><a class="el" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . ">_setupusb()</a>)</dd></dl>
</li>
<li>If upgrading to a new firmware gets an error (<dl class="section see"><dt>See Also</dt><dd><a class="el" href="firmware_8c.html#acf906b981c18cd97f25f7f00274f6026">cmd_fwupdate()</a>).</dd></dl>
The previous action which got the error will NOT be re-attempted.</li>
</ul>
<p>In an endless loop <a class="el" href="usb_8h.html#a8a1c88df5e127732cb63f1a8be180926" title="usb_tryreset does what the name means: Try to reset the usb via resetusb() ">usb_tryreset()</a> tries to reset the given usb device via the macro <a class="el" href="usb_8h.html#ae1550dc55de346b46df8c4b6930613e9" title="resetusb() is just a macro to call _resetusb() with debuggin constants (file, lineno) ...">resetusb()</a>. <br/>
 This macro calls <a class="el" href="usb_8h.html#a9ea008b77417f82b177117dce9a50b48" title="_resetusb Reset a USB device. ">_resetusb()</a> with debugging information. <br/>
 <a class="el" href="usb_8h.html#a9ea008b77417f82b177117dce9a50b48" title="_resetusb Reset a USB device. ">_resetusb()</a> sends a command via the operating system dependent function <a class="el" href="usb_8h.html#a0fd9533617cdae390dc65aa4594e33d2" title="os_resetusb is the os specific implementation for resetting usb ">os_resetusb()</a> and - if successful - reinitializes the device. <a class="el" href="usb_8h.html#a0fd9533617cdae390dc65aa4594e33d2" title="os_resetusb is the os specific implementation for resetting usb ">os_resetusb()</a> returns -2 to indicate a broken device and all structures should be removed for it. <br/>
 In that case, the loop is terminated, an error message is produced and <a class="el" href="usb_8h.html#a8a1c88df5e127732cb63f1a8be180926" title="usb_tryreset does what the name means: Try to reset the usb via resetusb() ">usb_tryreset()</a> returns -1.</p>
<p>In case <a class="el" href="usb_8h.html#ae1550dc55de346b46df8c4b6930613e9" title="resetusb() is just a macro to call _resetusb() with debuggin constants (file, lineno) ...">resetusb()</a> has success, the endless loop is left via a return 0 (success). <br/>
 If the return value from <a class="el" href="usb_8h.html#ae1550dc55de346b46df8c4b6930613e9" title="resetusb() is just a macro to call _resetusb() with debuggin constants (file, lineno) ...">resetusb()</a> is -1, the loop is continued with the next try.</p>
<p>If the global variable <b>reset_stop</b> is set directly when the function is called or after each try, <a class="el" href="usb_8h.html#a8a1c88df5e127732cb63f1a8be180926" title="usb_tryreset does what the name means: Try to reset the usb via resetusb() ">usb_tryreset()</a> stops working and returns -1.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000008">Todo:</a></b></dt><dd>Why does <a class="el" href="usb_8h.html#a8a1c88df5e127732cb63f1a8be180926" title="usb_tryreset does what the name means: Try to reset the usb via resetusb() ">usb_tryreset()</a> hide the information returned from <a class="el" href="usb_8h.html#ae1550dc55de346b46df8c4b6930613e9" title="resetusb() is just a macro to call _resetusb() with debuggin constants (file, lineno) ...">resetusb()</a>? Isn't it needed by the callers? </dd></dl>

<p>Definition at line <a class="el" href="usb_8c_source.html#l00465">465</a> of file <a class="el" href="usb_8c_source.html">usb.c</a>.</p>

<p>References <a class="el" href="includes_8h_source.html#l00050">ckb_err</a>, <a class="el" href="includes_8h_source.html#l00056">ckb_info</a>, <a class="el" href="usb_8c_source.html#l00025">reset_stop</a>, and <a class="el" href="usb_8h_source.html#l00212">resetusb</a>.</p>

<p>Referenced by <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>, and <a class="el" href="firmware_8c_source.html#l00154">cmd_fwupdate()</a>.</p>
<div class="fragment"><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                               {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="usb_8c.html#acfc08dcd9203a7489c1c43362e2ff138">reset_stop</a>)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <a class="code" href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a>(<span class="stringliteral">&quot;Attempting reset...\n&quot;</span>);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">while</span>(1){</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordtype">int</span> res = <a class="code" href="usb_8h.html#ae1550dc55de346b46df8c4b6930613e9">resetusb</a>(kb);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">if</span>(!res){</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <a class="code" href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a>(<span class="stringliteral">&quot;Reset success\n&quot;</span>);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">if</span>(res == -2 || <a class="code" href="usb_8c.html#acfc08dcd9203a7489c1c43362e2ff138">reset_stop</a>)</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a>(<span class="stringliteral">&quot;Reset failed. Disconnecting.\n&quot;</span>);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div>
<div class="ttc" id="includes_8h_html_a8312a1a42e03986afb7c76557f4d3e25"><div class="ttname"><a href="includes_8h.html#a8312a1a42e03986afb7c76557f4d3e25">ckb_err</a></div><div class="ttdeci">#define ckb_err(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00050">includes.h:50</a></div></div>
<div class="ttc" id="usb_8c_html_acfc08dcd9203a7489c1c43362e2ff138"><div class="ttname"><a href="usb_8c.html#acfc08dcd9203a7489c1c43362e2ff138">reset_stop</a></div><div class="ttdeci">volatile int reset_stop</div><div class="ttdoc">brief . </div><div class="ttdef"><b>Definition:</b> <a href="usb_8c_source.html#l00025">usb.c:25</a></div></div>
<div class="ttc" id="includes_8h_html_af3b6c3fbbe2da20e4058fd83084329a6"><div class="ttname"><a href="includes_8h.html#af3b6c3fbbe2da20e4058fd83084329a6">ckb_info</a></div><div class="ttdeci">#define ckb_info(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00056">includes.h:56</a></div></div>
<div class="ttc" id="usb_8h_html_ae1550dc55de346b46df8c4b6930613e9"><div class="ttname"><a href="usb_8h.html#ae1550dc55de346b46df8c4b6930613e9">resetusb</a></div><div class="ttdeci">#define resetusb(kb)</div><div class="ttdoc">resetusb() is just a macro to call _resetusb() with debuggin constants (file, lineno) ...</div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00212">usb.h:212</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-22" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-22-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-22-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-22-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a8a1c88df5e127732cb63f1a8be180926_icgraph.png" border="0" usemap="#usb_8h_a8a1c88df5e127732cb63f1a8be180926_icgraph" alt=""/></div>
<map name="usb_8h_a8a1c88df5e127732cb63f1a8be180926_icgraph" id="usb_8h_a8a1c88df5e127732cb63f1a8be180926_icgraph">
<area shape="rect" id="node2" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . " alt="" coords="161,31,244,57"/><area shape="rect" id="node11" href="firmware_8h.html#acf906b981c18cd97f25f7f00274f6026" title="cmd_fwupdate" alt="" coords="149,81,256,108"/><area shape="rect" id="node3" href="usb_8h.html#a1ab9d61dd894466125283465201161cd" title="setupusb starts a thread with kb as parameter and _setupusb() as entrypoint. " alt="" coords="304,31,379,57"/><area shape="rect" id="node4" href="usb__linux_8c.html#a3185d6da36c8b0f8b862a8479ae82034" title="usbadd" alt="" coords="427,31,491,57"/><area shape="rect" id="node5" href="usb__linux_8c.html#a50efc8ee0ffcb6f201735d1a3bb08779" title="Add a udev device. Returns 0 if device was recognized/added. " alt="" coords="539,31,655,57"/><area shape="rect" id="node6" href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea" title="udev_enum use the udev_enumerate_add_match_subsystem() to get all you need but only that..." alt="" coords="705,5,794,32"/><area shape="rect" id="node7" href="usb__linux_8c.html#a0859efad3739abe2ec61af4f3bb983ff" title="usbmain" alt="" coords="843,31,914,57"/><area shape="rect" id="node8" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="963,31,1013,57"/><area shape="rect" id="node9" href="notify_8c.html#ae246359e104d63520158c26329caac80" title="restart" alt="" coords="1061,31,1120,57"/><area shape="rect" id="node10" href="notify_8h.html#a700b520b9eb9a3698af8f8ebf547a9ab" title="cmd_restart" alt="" coords="1168,31,1259,57"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a41aa3e13beb593c91a5410200b4dd8d2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usbkill </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="usb__linux_8c_source.html#l00823">823</a> of file <a class="el" href="usb__linux_8c_source.html">usb_linux.c</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00040">quitWithLock()</a>.</p>
<div class="fragment"><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;              {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    udev_unref(<a class="code" href="usb__linux_8c.html#ad21f1896afa016837ab9b476f9e62450">udev</a>);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="usb__linux_8c.html#ad21f1896afa016837ab9b476f9e62450">udev</a> = 0;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;}</div>
<div class="ttc" id="usb__linux_8c_html_ad21f1896afa016837ab9b476f9e62450"><div class="ttname"><a href="usb__linux_8c.html#ad21f1896afa016837ab9b476f9e62450">udev</a></div><div class="ttdeci">static struct udev * udev</div><div class="ttdoc">struct udef is defined in /usr/include/libudev.h </div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00627">usb_linux.c:627</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-23" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-23-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-23-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-23-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a41aa3e13beb593c91a5410200b4dd8d2_icgraph.png" border="0" usemap="#usb_8h_a41aa3e13beb593c91a5410200b4dd8d2_icgraph" alt=""/></div>
<map name="usb_8h_a41aa3e13beb593c91a5410200b4dd8d2_icgraph" id="usb_8h_a41aa3e13beb593c91a5410200b4dd8d2_icgraph">
<area shape="rect" id="node2" href="main_8c.html#a24a012c29e291fef5fa13f4a07fffd33" title="quitWithLock " alt="" coords="112,47,211,74"/><area shape="rect" id="node3" href="main_8c.html#acd1527386a48875050e637e4bb872f11" title="quit Stop working the daemon. function is called if the daemon received a sigterm In this case..." alt="" coords="259,22,301,49"/><area shape="rect" id="node5" href="notify_8c.html#ae246359e104d63520158c26329caac80" title="restart" alt="" coords="579,22,637,49"/><area shape="rect" id="node4" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="480,22,531,49"/><area shape="rect" id="node7" href="main_8c.html#a05f9b9989842b986a26caf9e4c66a4c7" title="sighandler" alt="" coords="350,22,431,49"/><area shape="rect" id="node6" href="notify_8h.html#a700b520b9eb9a3698af8f8ebf547a9ab" title="cmd_restart" alt="" coords="685,22,776,49"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0859efad3739abe2ec61af4f3bb983ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int usbmain </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Start the USB main loop. Returns program exit code when finished.</p>
<p>usbmain is called by <a class="el" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main()</a> after setting up all other stuff. </p>
<dl class="section return"><dt>Returns</dt><dd>0 normally or -1 if fatal error occurs (up to now only if no new devices are available) </dd></dl>
<p>First check whether the uinput module is loaded by the kernel. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000018">Todo:</a></b></dt><dd>Why isn't missing of uinput a fatal error? </dd></dl>
<p>Create the udev object with udev_new() (is a function from libudev.h) terminate -1 if error</p>
<p>Enumerate all currently connected devices</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000019">Todo:</a></b></dt><dd>lae. here the work has to go on... </dd></dl>

<p>Definition at line <a class="el" href="usb__linux_8c_source.html#l00763">763</a> of file <a class="el" href="usb__linux_8c_source.html">usb_linux.c</a>.</p>

<p>References <a class="el" href="includes_8h_source.html#l00047">ckb_fatal</a>, <a class="el" href="includes_8h_source.html#l00053">ckb_warn</a>, <a class="el" href="usb__linux_8c_source.html#l00735">udev_enum()</a>, <a class="el" href="usb__linux_8c_source.html#l00683">usb_add_device()</a>, and <a class="el" href="usb__linux_8c_source.html#l00708">usb_rm_device()</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00088">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;             {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="comment">// Load the uinput module (if it&#39;s not loaded already)</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">if</span>(system(<span class="stringliteral">&quot;modprobe uinput&quot;</span>) != 0)</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <a class="code" href="includes_8h.html#a8e1e1ac7870420e38a04f30554ff2bbb">ckb_warn</a>(<span class="stringliteral">&quot;Failed to load uinput module\n&quot;</span>);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">if</span>(!(<a class="code" href="usb__linux_8c.html#ad21f1896afa016837ab9b476f9e62450">udev</a> = udev_new())) {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <a class="code" href="includes_8h.html#a52234aaaaba66b4a5f9a97724e8d84d7">ckb_fatal</a>(<span class="stringliteral">&quot;Failed to initialize udev in usbmain(), usb_linux.c\n&quot;</span>);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <a class="code" href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea">udev_enum</a>();</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">// Done scanning. Enter a loop to poll for device updates</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keyword">struct </span>udev_monitor* monitor = udev_monitor_new_from_netlink(<a class="code" href="usb__linux_8c.html#ad21f1896afa016837ab9b476f9e62450">udev</a>, <span class="stringliteral">&quot;udev&quot;</span>);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    udev_monitor_filter_add_match_subsystem_devtype(monitor, <span class="stringliteral">&quot;usb&quot;</span>, 0);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    udev_monitor_enable_receiving(monitor);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="comment">// Get an fd for the monitor</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordtype">int</span> fd = udev_monitor_get_fd(monitor);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    fd_set fds;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordflow">while</span>(<a class="code" href="usb__linux_8c.html#ad21f1896afa016837ab9b476f9e62450">udev</a>){</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        FD_ZERO(&amp;fds);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        FD_SET(fd, &amp;fds);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="comment">// Block until an event is read</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">if</span>(select(fd + 1, &amp;fds, 0, 0, 0) &gt; 0 &amp;&amp; FD_ISSET(fd, &amp;fds)){</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="keyword">struct </span>udev_device* dev = udev_monitor_receive_device(monitor);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            <span class="keywordflow">if</span>(!dev)</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span>* action = udev_device_get_action(dev);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            <span class="keywordflow">if</span>(!action){</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                udev_device_unref(dev);</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="comment">// Add/remove device</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <span class="keywordflow">if</span>(!strcmp(action, <span class="stringliteral">&quot;add&quot;</span>)){</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                <span class="keywordtype">int</span> res = <a class="code" href="usb__linux_8c.html#a50efc8ee0ffcb6f201735d1a3bb08779">usb_add_device</a>(dev);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                <span class="keywordflow">if</span>(res == 0)</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                <span class="comment">// If the device matched but the handle wasn&#39;t opened correctly, re-enumerate (this sometimes solves the problem)</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                <span class="keywordflow">if</span>(res == -1)</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                    <a class="code" href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea">udev_enum</a>();</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(action, <span class="stringliteral">&quot;remove&quot;</span>))</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                <a class="code" href="usb__linux_8c.html#adeffaa2b04d01b15c8623255719420ef">usb_rm_device</a>(dev);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            udev_device_unref(dev);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    }</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    udev_monitor_unref(monitor);</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;}</div>
<div class="ttc" id="includes_8h_html_a52234aaaaba66b4a5f9a97724e8d84d7"><div class="ttname"><a href="includes_8h.html#a52234aaaaba66b4a5f9a97724e8d84d7">ckb_fatal</a></div><div class="ttdeci">#define ckb_fatal(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00047">includes.h:47</a></div></div>
<div class="ttc" id="usb__linux_8c_html_adeffaa2b04d01b15c8623255719420ef"><div class="ttname"><a href="usb__linux_8c.html#adeffaa2b04d01b15c8623255719420ef">usb_rm_device</a></div><div class="ttdeci">static void usb_rm_device(struct udev_device *dev)</div><div class="ttdoc">usb_rm_device find the usb port to remove and close it via closeusb(). </div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00708">usb_linux.c:708</a></div></div>
<div class="ttc" id="includes_8h_html_a8e1e1ac7870420e38a04f30554ff2bbb"><div class="ttname"><a href="includes_8h.html#a8e1e1ac7870420e38a04f30554ff2bbb">ckb_warn</a></div><div class="ttdeci">#define ckb_warn(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="includes_8h_source.html#l00053">includes.h:53</a></div></div>
<div class="ttc" id="usb__linux_8c_html_ad56c1e4ec53bbd6b947cb535590328ea"><div class="ttname"><a href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea">udev_enum</a></div><div class="ttdeci">static void udev_enum()</div><div class="ttdoc">udev_enum use the udev_enumerate_add_match_subsystem() to get all you need but only that...</div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00735">usb_linux.c:735</a></div></div>
<div class="ttc" id="usb__linux_8c_html_a50efc8ee0ffcb6f201735d1a3bb08779"><div class="ttname"><a href="usb__linux_8c.html#a50efc8ee0ffcb6f201735d1a3bb08779">usb_add_device</a></div><div class="ttdeci">static int usb_add_device(struct udev_device *dev)</div><div class="ttdoc">Add a udev device. Returns 0 if device was recognized/added. </div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00683">usb_linux.c:683</a></div></div>
<div class="ttc" id="usb__linux_8c_html_ad21f1896afa016837ab9b476f9e62450"><div class="ttname"><a href="usb__linux_8c.html#ad21f1896afa016837ab9b476f9e62450">udev</a></div><div class="ttdeci">static struct udev * udev</div><div class="ttdoc">struct udef is defined in /usr/include/libudev.h </div><div class="ttdef"><b>Definition:</b> <a href="usb__linux_8c_source.html#l00627">usb_linux.c:627</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-24" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-24-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-24-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-24-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a0859efad3739abe2ec61af4f3bb983ff_cgraph.png" border="0" usemap="#usb_8h_a0859efad3739abe2ec61af4f3bb983ff_cgraph" alt=""/></div>
<map name="usb_8h_a0859efad3739abe2ec61af4f3bb983ff_cgraph" id="usb_8h_a0859efad3739abe2ec61af4f3bb983ff_cgraph">
<area shape="rect" id="node2" href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea" title="udev_enum use the udev_enumerate_add_match_subsystem() to get all you need but only that..." alt="" coords="126,384,215,411"/><area shape="rect" id="node3" href="usb__linux_8c.html#a50efc8ee0ffcb6f201735d1a3bb08779" title="Add a udev device. Returns 0 if device was recognized/added. " alt="" coords="265,384,381,411"/><area shape="rect" id="node50" href="usb__linux_8c.html#adeffaa2b04d01b15c8623255719420ef" title="usb_rm_device find the usb port to remove and close it via closeusb(). " alt="" coords="267,259,378,285"/><area shape="rect" id="node4" href="usb__linux_8c.html#a3185d6da36c8b0f8b862a8479ae82034" title="usbadd" alt="" coords="429,392,493,419"/><area shape="rect" id="node5" href="usb_8c.html#a1ab9d61dd894466125283465201161cd" title="setupusb" alt="" coords="541,455,616,481"/><area shape="rect" id="node6" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . " alt="" coords="664,487,747,513"/><area shape="rect" id="node7" href="usb_8c.html#a8732b3ade76da4ae362996232ef95431" title="closeusb" alt="" coords="1008,132,1083,159"/><area shape="rect" id="node14" href="devnode_8c.html#a4f2642e0c38280a1516fbe153c9fa18f" title="Update the list of connected devices. " alt="" coords="1167,208,1289,235"/><area shape="rect" id="node16" href="usb_8c.html#ab8c22b4f7012c6d9fe1a0d5e2a93df65" title="brief . " alt="" coords="825,284,895,311"/><area shape="rect" id="node24" href="usb_8c.html#a25ded61622ec9349905b5aa2ed2cb48b" title="brief . " alt="" coords="819,537,901,564"/><area shape="rect" id="node25" href="devnode_8c.html#a0c3d1e3cd90f43a9b5ee0793f4a75041" title="Create a dev path for the keyboard at index. Returns 0 on success. " alt="" coords="817,436,903,463"/><area shape="rect" id="node28" href="usb_8c.html#af87f830e031d8f63d2d1c3fc14fdad20" title="brief . " alt="" coords="1185,512,1271,539"/><area shape="rect" id="node29" href="usb_8c.html#a8e6389e8183a834fedb6ed317dd26f94" title="brief . " alt="" coords="1187,563,1269,589"/><area shape="rect" id="node30" href="usb_8h.html#a9e5784bfca2e4612f498ce67c7dab275" title="os_inputmain is run in a separate thread and will be detached from the main thread, so it needs to clean up its own resources. " alt="" coords="811,683,909,709"/><area shape="rect" id="node42" href="input_8h.html#ac73b3c2c38b916b901b4cca6b350a863" title="os_inputopen " alt="" coords="811,771,909,797"/><area shape="rect" id="node44" href="input_8h.html#a081bbacaa312d4a1a63bc1cab5d3520f" title="os_setupindicators" alt="" coords="795,897,925,924"/><area shape="rect" id="node46" href="usb_8h.html#a39442715182933b93172de60cdb66e8f" title="os_setupusb OS&#45;specific setup for a specific usb device. " alt="" coords="812,968,908,995"/><area shape="rect" id="node49" href="usb_8c.html#a8a1c88df5e127732cb63f1a8be180926" title="usb_tryreset" alt="" coords="813,183,907,209"/><area shape="rect" id="node8" href="usb_8h.html#a6a62575e9073fae15efb58f24fbfe5b8" title="os_closeusb unclaim it, destroy the udev device and clear data structures at kb " alt="" coords="1181,56,1275,83"/><area shape="rect" id="node10" href="input_8h.html#a44df5105a6a3f2eda5bc39a88201bd1a" title="os_inputclose" alt="" coords="1177,5,1279,32"/><area shape="rect" id="node11" href="devnode_8c.html#a8d0aeeebb364608943b78573adb85c7f" title="Remove the dev path for the keyboard at index. Returns 0 on success. " alt="" coords="1187,157,1269,184"/><area shape="rect" id="node9" href="usb__linux_8c.html#afe1111f494da4776633be32fecaba44b" title="usbunclaim" alt="" coords="1359,56,1447,83"/><area shape="rect" id="node12" href="devnode_8c.html#a9d97ede033e4f6c6bdd1c66fc82aa15e" title="_rmnotifynode" alt="" coords="1351,132,1455,159"/><area shape="rect" id="node13" href="devnode_8c.html#aac8f6f936a0ff6c16adc677622b226c4" title="rm_recursive" alt="" coords="1354,208,1451,235"/><area shape="rect" id="node15" href="devnode_8c.html#acc36eaba5eb854461ab3c0a4d146e9c9" title="_updateconnected Update the list of connected devices. " alt="" coords="1339,284,1467,311"/><area shape="rect" id="node17" href="command_8c.html#ad7239680e0942b0b85a6cd3e9fff25a9" title="readcmd" alt="" coords="1009,335,1081,361"/><area shape="rect" id="node21" href="devnode_8c.html#a1062ed70d4ea0310fbf5eeee928b58b7" title="readlines" alt="" coords="1008,183,1083,209"/><area shape="rect" id="node22" href="devnode_8c.html#a588ab2c69fcb283a5beb90c49a165979" title="readlines_ctx_free" alt="" coords="981,233,1109,260"/><area shape="rect" id="node23" href="devnode_8c.html#ac118005c75badc2028b4921be8d9bdd0" title="readlines_ctx_init" alt="" coords="984,284,1107,311"/><area shape="rect" id="node18" href="devnode_8c.html#a981305884de053a41d337efac23900ec" title="Creates a notification node for the specified keyboard. " alt="" coords="1178,360,1278,387"/><area shape="rect" id="node20" href="devnode_8c.html#a40e40a8ea3edccbfd8fdfefc44a76206" title="Removes a notification node for the specified keyboard. " alt="" coords="1179,107,1277,133"/><area shape="rect" id="node19" href="devnode_8c.html#a38fcf6ff044f9249ae04234340ee8e7b" title="_mknotifynode" alt="" coords="1349,411,1456,437"/><area shape="rect" id="node26" href="devnode_8c.html#a81c81014b2dfa89e326dd61769842953" title="_mkdevpath" alt="" coords="999,436,1092,463"/><area shape="rect" id="node27" href="devnode_8c.html#ad130425a617cf973b28603a72607a057" title="Writes a keyboard&#39;s firmware version and poll rate to its device node. " alt="" coords="1187,411,1269,437"/><area shape="rect" id="node31" href="keymap_8c.html#ad39ede76abd657f5123fa331853db017" title="corsair_kbcopy" alt="" coords="990,765,1101,792"/><area shape="rect" id="node32" href="keymap_8c.html#a0dc9a16564cc51b35a35d28af1a96fb0" title="corsair_mousecopy" alt="" coords="978,816,1113,843"/><area shape="rect" id="node33" href="keymap_8c.html#a6f4afd134546237416b271d9cefd2889" title="hid_kb_translate" alt="" coords="987,613,1104,640"/><area shape="rect" id="node34" href="keymap_8c.html#a092f675ff366b5823c73b25f83d513f9" title="hid_mouse_translate" alt="" coords="974,664,1117,691"/><area shape="rect" id="node35" href="input_8c.html#ae360d0b9a764a1d38c5be5464be8b70a" title="inputupdate" alt="" coords="1001,715,1090,741"/><area shape="rect" id="node36" href="input_8c.html#aed8e9842ed5750c1d328c5dc4c1ba2bd" title="inputupdate_keys" alt="" coords="1166,689,1290,716"/><area shape="rect" id="node41" href="input_8h.html#a9f2cfb2d883ae4a3732047fe3f3da683" title="os_mousemove" alt="" coords="1345,740,1460,767"/><area shape="rect" id="node37" href="input_8c.html#abd38419ce56379559481f51d9491adeb" title="macromask" alt="" coords="1357,588,1448,615"/><area shape="rect" id="node38" href="notify_8c.html#ac2411c0997dfdbefdebd45f2584a5d04" title="nprintkey" alt="" coords="1365,639,1440,665"/><area shape="rect" id="node39" href="input_8h.html#af0d3401f317f3214dadad7d1a3378c58" title="os_keypress" alt="" coords="1355,689,1451,716"/><area shape="rect" id="node40" href="input__linux_8c.html#a14ff0fdf147e3702197db2cadb878460" title="isync" alt="" coords="1515,715,1568,741"/><area shape="rect" id="node43" href="input__linux_8c.html#a5f050529d49f8cb5e8dda4617c5984b7" title="uinputopen" alt="" coords="1003,867,1088,893"/><area shape="rect" id="node45" href="input__linux_8c.html#a5d40cc9137eaefbc2d860fac76020460" title="_ledthread" alt="" coords="1004,917,1087,944"/><area shape="rect" id="node47" href="usb__linux_8c.html#ab694a2ac859b16b5af802b4484f5ba0b" title="strtrim" alt="" coords="1016,968,1075,995"/><area shape="rect" id="node48" href="usb__linux_8c.html#a309cab8bf65221b01dc320f247abf626" title="usbclaim" alt="" coords="1008,1019,1083,1045"/></map>
</div>
</p>

<p><div id="dynsection-25" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-25-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-25-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-25-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a0859efad3739abe2ec61af4f3bb983ff_icgraph.png" border="0" usemap="#usb_8h_a0859efad3739abe2ec61af4f3bb983ff_icgraph" alt=""/></div>
<map name="usb_8h_a0859efad3739abe2ec61af4f3bb983ff_icgraph" id="usb_8h_a0859efad3739abe2ec61af4f3bb983ff_icgraph">
<area shape="rect" id="node2" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="125,5,176,32"/><area shape="rect" id="node3" href="notify_8c.html#ae246359e104d63520158c26329caac80" title="restart" alt="" coords="224,5,283,32"/><area shape="rect" id="node4" href="notify_8h.html#a700b520b9eb9a3698af8f8ebf547a9ab" title="cmd_restart" alt="" coords="331,5,421,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8e6389e8183a834fedb6ed317dd26f94"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* vendor_str </td>
          <td>(</td>
          <td class="paramtype">short&#160;</td>
          <td class="paramname"><em>vendor</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>vendor_str Vendor/product string representations </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vendor</td><td><em>short</em> vendor ID </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a string: either "" or "corsair"</dd></dl>
<p>uncomment the following Define to see USB packets sent to the device</p>
<p>vendor_str returns "corsair" iff the given <em>vendor</em> argument is equal to <em>V_CORSAIR</em> <code></code>(0x1bc) else it returns ""</p>
<dl class="section attention"><dt>Attention</dt><dd>There is also a string defined V_CORSAIR_STR, which returns the device number as string in hex "1b1c". </dd></dl>

<p>Definition at line <a class="el" href="usb_8c_source.html#l00043">43</a> of file <a class="el" href="usb_8c_source.html">usb.c</a>.</p>

<p>References <a class="el" href="usb_8h_source.html#l00038">V_CORSAIR</a>.</p>

<p>Referenced by <a class="el" href="devnode_8c_source.html#l00136">_mkdevpath()</a>, and <a class="el" href="usb_8c_source.html#l00214">_setupusb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                    {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">if</span>(vendor == <a class="code" href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a>)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;corsair&quot;</span>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div>
<div class="ttc" id="usb_8h_html_a2aa27325e30aac7dcec6203d4f11e996"><div class="ttname"><a href="usb_8h.html#a2aa27325e30aac7dcec6203d4f11e996">V_CORSAIR</a></div><div class="ttdeci">#define V_CORSAIR</div><div class="ttdoc">For the following Defines please see &quot;Detailed Description&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="usb_8h_source.html#l00038">usb.h:38</a></div></div>
</div><!-- fragment -->
<p><div id="dynsection-26" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-26-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-26-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-26-content" class="dyncontent" style="display:none;">
<div class="center"><img src="usb_8h_a8e6389e8183a834fedb6ed317dd26f94_icgraph.png" border="0" usemap="#usb_8h_a8e6389e8183a834fedb6ed317dd26f94_icgraph" alt=""/></div>
<map name="usb_8h_a8e6389e8183a834fedb6ed317dd26f94_icgraph" id="usb_8h_a8e6389e8183a834fedb6ed317dd26f94_icgraph">
<area shape="rect" id="node2" href="devnode_8c.html#a81c81014b2dfa89e326dd61769842953" title="_mkdevpath" alt="" coords="136,5,229,32"/><area shape="rect" id="node4" href="usb_8c.html#a10ad381abfe51e67e341c882c92bb9ac" title="brief . " alt="" coords="413,56,496,83"/><area shape="rect" id="node3" href="devnode_8h.html#a0c3d1e3cd90f43a9b5ee0793f4a75041" title="Create a dev path for the keyboard at index. Returns 0 on success. " alt="" coords="278,5,365,32"/><area shape="rect" id="node10" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1203,31,1253,57"/><area shape="rect" id="node5" href="usb_8h.html#a1ab9d61dd894466125283465201161cd" title="setupusb starts a thread with kb as parameter and _setupusb() as entrypoint. " alt="" coords="544,56,619,83"/><area shape="rect" id="node6" href="usb__linux_8c.html#a3185d6da36c8b0f8b862a8479ae82034" title="usbadd" alt="" coords="667,56,731,83"/><area shape="rect" id="node7" href="usb__linux_8c.html#a50efc8ee0ffcb6f201735d1a3bb08779" title="Add a udev device. Returns 0 if device was recognized/added. " alt="" coords="779,56,895,83"/><area shape="rect" id="node8" href="usb__linux_8c.html#ad56c1e4ec53bbd6b947cb535590328ea" title="udev_enum use the udev_enumerate_add_match_subsystem() to get all you need but only that..." alt="" coords="945,56,1034,83"/><area shape="rect" id="node9" href="usb__linux_8c.html#a0859efad3739abe2ec61af4f3bb983ff" title="usbmain" alt="" coords="1083,56,1154,83"/><area shape="rect" id="node11" href="notify_8c.html#ae246359e104d63520158c26329caac80" title="restart" alt="" coords="1301,31,1360,57"/><area shape="rect" id="node12" href="notify_8h.html#a700b520b9eb9a3698af8f8ebf547a9ab" title="cmd_restart" alt="" coords="1408,31,1499,57"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c663af95b3406af676444e819a47854e.html">ckb-daemon</a></li><li class="navelem"><a class="el" href="usb_8h.html">usb.h</a></li>
    <li class="footer">Generated on Tue May 16 2017 21:15:22 for ckb-next by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
